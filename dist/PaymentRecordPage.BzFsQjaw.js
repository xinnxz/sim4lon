import{j as jsxRuntimeExports}from"./jsx-runtime.mvtouYz0.js";import{r as reactExports}from"./index.DcciWILN.js";import{S as SafeIcon,B as Button}from"./SafeIcon.C08LGL0m.js";import{c as Card,C as CardHeader,a as CardTitle,b as CardContent,d as CardDescription}from"./card.BWWJCoY0.js";import"./input.B0jSBU-X.js";import{L as Label}from"./label.CykMmJMJ.js";import{R as RadioGroup,a as RadioGroupItem}from"./radio-group.BQF-ExCF.js";import{T as Textarea}from"./textarea.kGDeskSO.js";import{f as formatCurrency}from"./currency.DQ9ceiwM.js";import{S as Separator}from"./separator.D_t_gK4i.js";import{t as toast}from"./index.fAd_ikgp.js";import{ordersApi,paymentApi}from"./api.B5PpFILw.js";import"./index.PIAPtHoh.js";import"./index.ubNQCTBn.js";import"./index.CmV6gt94.js";import"./index.DNfkKfAg.js";import"./index.CZLqkOjo.js";import"./index.CLV08RI1.js";import"./index.BB0xO63c.js";import"./index.Drh0kMGk.js";import"./index.Bcho8R2B.js";import"./index.BhA3i5Wo.js";import"./index.Ci_bviUJ.js";function PaymentRecordForm({order,onSubmit,isSubmitting,isPaymentSuccessful=!1}){const[paymentMethod,setPaymentMethod]=reactExports.useState("cash"),amount=order.totalAmount,[transferProof,setTransferProof]=reactExports.useState(null),[transferProofUrl,setTransferProofUrl]=reactExports.useState(""),[imagePreview,setImagePreview]=reactExports.useState(null),[showPreviewModal,setShowPreviewModal]=reactExports.useState(!1),[notes,setNotes]=reactExports.useState(""),[errors,setErrors]=reactExports.useState({}),handleFileChange=e=>{const file=e.target.files?.[0];if(file){if(!["image/jpeg","image/png","application/pdf"].includes(file.type)){setErrors(prev=>({...prev,transferProof:"Format file harus JPG, PNG, atau PDF"}));return}if(file.size>5*1024*1024){setErrors(prev=>({...prev,transferProof:"Ukuran file maksimal 5MB"}));return}if(setTransferProof(file),file.type.startsWith("image/")){const reader=new FileReader;reader.onload=e2=>{setImagePreview(e2.target?.result)},reader.readAsDataURL(file)}else setImagePreview(null);setErrors(prev=>{const newErrors={...prev};return delete newErrors.transferProof,newErrors})}},validateForm=()=>{const newErrors={};return paymentMethod==="transfer"&&!transferProof&&!transferProofUrl.trim()&&(newErrors.transferProof="Bukti transfer harus diunggah atau masukkan URL"),setErrors(newErrors),Object.keys(newErrors).length===0},handleSubmit=e=>{if(e.preventDefault(),!validateForm())return;const formData={orderId:order.id,paymentMethod,amount,transferProof:paymentMethod==="transfer"?transferProof:null,transferProofUrl:paymentMethod==="transfer"?transferProofUrl:void 0,notes,recordedAt:new Date().toISOString()};onSubmit(formData)};return jsxRuntimeExports.jsxs("form",{onSubmit:handleSubmit,className:"space-y-6",children:[isPaymentSuccessful&&jsxRuntimeExports.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0",children:jsxRuntimeExports.jsx(SafeIcon,{name:"CheckCircle",className:"h-6 w-6 text-green-600"})}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-green-900",children:"✔️ Sudah Dibayar"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-green-700",children:"Pembayaran telah berhasil dicatat dan aman tersimpan"})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx(Label,{className:"text-base font-semibold",children:"Metode Pembayaran"}),jsxRuntimeExports.jsxs(RadioGroup,{value:paymentMethod,onValueChange:setPaymentMethod,disabled:isPaymentSuccessful,children:[jsxRuntimeExports.jsxs("div",{className:`flex items-center space-x-2 p-3 border rounded-lg ${isPaymentSuccessful?"bg-muted/50 cursor-not-allowed":"hover:bg-secondary/50 cursor-pointer"}`,children:[jsxRuntimeExports.jsx(RadioGroupItem,{value:"cash",id:"cash",disabled:isPaymentSuccessful}),jsxRuntimeExports.jsxs(Label,{htmlFor:"cash",className:`flex-1 ${isPaymentSuccessful?"cursor-not-allowed opacity-60":"cursor-pointer"}`,children:[jsxRuntimeExports.jsx("div",{className:"font-medium",children:"Tunai"}),jsxRuntimeExports.jsx("div",{className:"text-sm text-muted-foreground",children:"Pembayaran langsung dengan uang tunai"})]})]}),jsxRuntimeExports.jsxs("div",{className:`flex items-center space-x-2 p-3 border rounded-lg ${isPaymentSuccessful?"bg-muted/50 cursor-not-allowed":"hover:bg-secondary/50 cursor-pointer"}`,children:[jsxRuntimeExports.jsx(RadioGroupItem,{value:"transfer",id:"transfer",disabled:isPaymentSuccessful}),jsxRuntimeExports.jsxs(Label,{htmlFor:"transfer",className:`flex-1 ${isPaymentSuccessful?"cursor-not-allowed opacity-60":"cursor-pointer"}`,children:[jsxRuntimeExports.jsx("div",{className:"font-medium",children:"Transfer Bank"}),jsxRuntimeExports.jsx("div",{className:"text-sm text-muted-foreground",children:"Pembayaran melalui transfer bank dengan bukti"})]})]})]})]}),jsxRuntimeExports.jsx("div",{className:"border-t pt-6"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label,{className:"font-semibold",children:"Nominal Pembayaran"}),jsxRuntimeExports.jsx("div",{className:"bg-gradient-to-r from-primary/5 to-primary/10 border border-primary/20 rounded-lg p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-primary",children:formatCurrency(amount)}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Sesuai total pesanan"})]}),jsxRuntimeExports.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-primary/10",children:jsxRuntimeExports.jsx(SafeIcon,{name:"CheckCircle",className:"h-5 w-5 text-primary"})})]})})]}),paymentMethod==="transfer"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"border-t pt-6"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label,{htmlFor:"transferProof",className:"font-semibold",children:"Bukti Transfer"}),jsxRuntimeExports.jsxs("div",{className:"border-2 border-dashed rounded-lg p-4 text-center hover:bg-secondary/50 transition-colors",children:[jsxRuntimeExports.jsx("input",{id:"transferProof",type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:handleFileChange,className:"hidden",disabled:isPaymentSuccessful}),jsxRuntimeExports.jsx("label",{htmlFor:"transferProof",className:isPaymentSuccessful?"cursor-not-allowed block":"cursor-pointer block",children:transferProof?jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[imagePreview&&jsxRuntimeExports.jsxs("div",{className:"relative mx-auto max-w-xs cursor-pointer group",onClick:e=>{e.preventDefault(),setShowPreviewModal(!0)},children:[jsxRuntimeExports.jsx("img",{src:imagePreview,alt:"Bukti transfer",className:"w-full max-h-40 object-contain rounded-lg border shadow-sm group-hover:opacity-90 transition-opacity"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black/20 rounded-lg",children:jsxRuntimeExports.jsx(SafeIcon,{name:"ZoomIn",className:"h-8 w-8 text-white"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"CheckCircle",className:"h-5 w-5 text-primary"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:transferProof.name})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Klik untuk ganti file"})]}):jsxRuntimeExports.jsxs("div",{className:`space-y-2 ${isPaymentSuccessful?"opacity-60":""}`,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Upload",className:"h-8 w-8 mx-auto text-muted-foreground"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium",children:"Klik untuk unggah bukti transfer"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"JPG, PNG, atau PDF (Max 5MB)"})]})]})})]}),errors.transferProof&&jsxRuntimeExports.jsxs("p",{className:"text-sm text-destructive flex items-center gap-1",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"AlertCircle",className:"h-4 w-4"}),errors.transferProof]})]}),showPreviewModal&&imagePreview&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4",onClick:()=>setShowPreviewModal(!1),children:jsxRuntimeExports.jsxs("div",{className:"relative max-w-3xl max-h-[90vh]",children:[jsxRuntimeExports.jsx("img",{src:imagePreview,alt:"Bukti transfer (full)",className:"max-w-full max-h-[85vh] object-contain rounded-lg"}),jsxRuntimeExports.jsx("button",{onClick:()=>setShowPreviewModal(!1),className:"absolute -top-4 -right-4 bg-white rounded-full p-2 shadow-lg hover:bg-gray-100",children:jsxRuntimeExports.jsx(SafeIcon,{name:"X",className:"h-5 w-5"})})]})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label,{htmlFor:"notes",className:"font-semibold",children:"Catatan (Opsional)"}),jsxRuntimeExports.jsx(Textarea,{id:"notes",placeholder:"Tambahkan catatan atau keterangan pembayaran...",value:notes,onChange:e=>setNotes(e.target.value),rows:3,disabled:isPaymentSuccessful})]}),jsxRuntimeExports.jsx("div",{className:"flex gap-3 pt-6 border-t",children:isPaymentSuccessful?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(Button,{type:"button",variant:"outline",onClick:()=>window.location.href="./detail-pesanan.html",className:"flex-1",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"ArrowLeft",className:"mr-2 h-4 w-4"}),"Kembali ke Pesanan"]}),jsxRuntimeExports.jsxs(Button,{type:"button",onClick:()=>{const params=new URLSearchParams(window.location.search),orderId=params.get("orderId")||params.get("id");window.location.href=`/nota-pembayaran?id=${orderId}`},className:"flex-1 bg-primary hover:bg-primary/90",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"FileText",className:"mr-2 h-4 w-4"}),"Lihat Invoice"]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Button,{type:"button",variant:"outline",onClick:()=>window.location.href="./detail-pesanan.html",disabled:isSubmitting,children:"Batal"}),jsxRuntimeExports.jsx(Button,{type:"submit",className:"flex-1 bg-primary hover:bg-primary/90",disabled:isSubmitting,children:isSubmitting?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"mr-2 h-4 w-4 animate-spin"}),"Menyimpan..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Save",className:"mr-2 h-4 w-4"}),"Simpan Pembayaran"]})})]})})]})}function PaymentSummary({order}){const hasItems=order.items&&order.items.length>0;return jsxRuntimeExports.jsxs(Card,{children:[jsxRuntimeExports.jsx(CardHeader,{className:"pb-3",children:jsxRuntimeExports.jsx(CardTitle,{className:"text-lg",children:"Ringkasan Pesanan"})}),jsxRuntimeExports.jsxs(CardContent,{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"ID Pesanan"}),jsxRuntimeExports.jsx("p",{className:"font-mono font-semibold text-sm",children:order.id})]}),jsxRuntimeExports.jsx(Separator,{}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Pangkalan"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-medium",children:order.baseStation})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Detail LPG"}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:hasItems?order.items.map((item,index)=>jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-secondary/30 rounded-lg px-3 py-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"h-2 w-2 rounded-full bg-primary"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:item.type})]}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-semibold",children:[item.quantity," unit"]})]},index)):jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[jsxRuntimeExports.jsx("div",{className:"h-2 w-2 rounded-full bg-primary"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:order.lpgType})]})})]}),jsxRuntimeExports.jsx("div",{className:"bg-secondary rounded-lg p-3 border",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:"Total Jumlah"}),jsxRuntimeExports.jsxs("span",{className:"text-lg font-bold text-primary",children:[order.quantity," ",jsxRuntimeExports.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:"unit"})]})]})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Tanggal Pesanan"}),jsxRuntimeExports.jsxs("p",{className:"text-sm font-medium flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Calendar",className:"h-4 w-4 text-muted-foreground"}),new Date(order.date).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),jsxRuntimeExports.jsx(Separator,{}),jsxRuntimeExports.jsxs("div",{className:"bg-gradient-to-r from-primary/5 to-primary/10 p-4 rounded-lg border border-primary/20",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total Pembayaran"}),jsxRuntimeExports.jsx("p",{className:"text-2xl font-bold text-primary",children:formatCurrency(order.totalAmount)})]})]})]})}function PaymentRecordPage(){const[order,setOrder]=reactExports.useState(null),[orderId,setOrderId]=reactExports.useState(null),[isLoading,setIsLoading]=reactExports.useState(!0),[isSubmitting,setIsSubmitting]=reactExports.useState(!1),[paymentSuccessful,setPaymentSuccessful]=reactExports.useState(!1),[error,setError]=reactExports.useState(null);reactExports.useEffect(()=>{const params=new URLSearchParams(window.location.search),id=params.get("orderId")||params.get("id");id?setOrderId(id):(setError("Order ID tidak ditemukan di URL"),setIsLoading(!1))},[]),reactExports.useEffect(()=>{if(!orderId)return;(async()=>{try{setIsLoading(!0);const apiOrder=await ordersApi.getById(orderId),totalQty=apiOrder.order_items.reduce((sum,item)=>sum+item.qty,0),lpgTypes=[...new Set(apiOrder.order_items.map(item=>item.label||item.lpg_type))].join(", "),items=apiOrder.order_items.map(item=>({type:item.label||item.lpg_type,quantity:item.qty}));setOrder({id:apiOrder.code||apiOrder.id.substring(0,12),baseStation:apiOrder.pangkalans?.name||"Unknown",lpgType:lpgTypes,quantity:totalQty,items,totalAmount:apiOrder.total_amount,status:apiOrder.current_status,date:apiOrder.created_at}),setError(null)}catch(err){console.error("Failed to fetch order:",err),setError(err.message||"Gagal memuat data pesanan")}finally{setIsLoading(!1)}})()},[orderId]);const handleSubmit=async data=>{if(!(!orderId||!order)){setIsSubmitting(!0);try{const paymentDto={order_id:orderId,method:data.paymentMethod==="cash"?"TUNAI":"TRANSFER",amount:data.amount,proof_url:data.transferProof?`uploaded/${data.transferProof.name}`:void 0,note:data.notes||void 0};await paymentApi.createRecord(paymentDto),await paymentApi.updateOrderPayment(orderId,{is_paid:!0,payment_method:paymentDto.method,amount_paid:data.amount,proof_url:paymentDto.proof_url}),order.status==="MENUNGGU_PEMBAYARAN"&&await ordersApi.updateStatus(orderId,{status:"DIPROSES",note:"Pembayaran diterima"}),setPaymentSuccessful(!0),toast.success("Pembayaran Berhasil!",{description:`Pembayaran sebesar ${formatCurrency(data.amount)} telah dicatat.`,action:{label:"Lihat Nota",onClick:()=>{window.location.href=`/nota-pembayaran?id=${orderId}`}},duration:5e3})}catch(err){console.error("Payment failed:",err),toast.error("Gagal mencatat pembayaran",{description:err.message||"Terjadi kesalahan saat menyimpan pembayaran"})}finally{setIsSubmitting(!1)}}};return isLoading?jsxRuntimeExports.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:jsxRuntimeExports.jsxs("div",{className:"text-center space-y-4",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"h-8 w-8 animate-spin mx-auto text-primary"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"Memuat data pesanan..."})]})}):error||!order?jsxRuntimeExports.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:jsxRuntimeExports.jsx(Card,{className:"max-w-md",children:jsxRuntimeExports.jsxs(CardContent,{className:"pt-6 text-center space-y-4",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"AlertCircle",className:"h-12 w-12 mx-auto text-destructive"}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold",children:"Gagal Memuat Pesanan"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:error||"Pesanan tidak ditemukan"}),jsxRuntimeExports.jsx(Button,{onClick:()=>window.location.href="/daftar-pesanan",children:"Kembali ke Daftar Pesanan"})]})})}):jsxRuntimeExports.jsxs("div",{className:"flex-1 space-y-6 p-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:()=>window.location.href=`/detail-pesanan?id=${orderId}`,children:jsxRuntimeExports.jsx(SafeIcon,{name:"ArrowLeft",className:"h-5 w-5"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold",children:"Catat Pembayaran"}),jsxRuntimeExports.jsxs("p",{className:"text-muted-foreground",children:["Pencatatan pembayaran untuk pesanan ",order.id]})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[jsxRuntimeExports.jsx("div",{className:"lg:col-span-2",children:jsxRuntimeExports.jsxs(Card,{children:[jsxRuntimeExports.jsxs(CardHeader,{children:[jsxRuntimeExports.jsx(CardTitle,{children:"Detail Pembayaran"}),jsxRuntimeExports.jsx(CardDescription,{children:"Pilih metode pembayaran dan masukkan informasi pembayaran"})]}),jsxRuntimeExports.jsx(CardContent,{children:jsxRuntimeExports.jsx(PaymentRecordForm,{order,onSubmit:handleSubmit,isSubmitting,isPaymentSuccessful:paymentSuccessful})})]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(PaymentSummary,{order}),jsxRuntimeExports.jsxs(Card,{className:"border-primary/20 bg-primary/5",children:[jsxRuntimeExports.jsx(CardHeader,{className:"pb-3",children:jsxRuntimeExports.jsxs(CardTitle,{className:"text-base flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Info",className:"h-4 w-4 text-primary"}),"Informasi Penting"]})}),jsxRuntimeExports.jsxs(CardContent,{className:"text-sm space-y-2 text-muted-foreground",children:[jsxRuntimeExports.jsx("p",{children:"• Pastikan nominal pembayaran sesuai dengan total pesanan"}),jsxRuntimeExports.jsx("p",{children:"• Untuk transfer bank, masukkan URL bukti transfer"}),jsxRuntimeExports.jsx("p",{children:'• Status pesanan akan otomatis diperbarui ke "Diproses"'}),jsxRuntimeExports.jsx("p",{children:"• Simpan informasi pembayaran untuk referensi"})]})]})]})]})]})}export{PaymentRecordPage as default};
