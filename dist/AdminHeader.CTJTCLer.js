import{S as SafeIcon,B as Button,_ as __vitePreload}from"./SafeIcon.C08LGL0m.js";import{j as jsxRuntimeExports}from"./jsx-runtime.mvtouYz0.js";import{r as reactExports}from"./index.DcciWILN.js";import{D as DropdownMenu,a as DropdownMenuTrigger,b as DropdownMenuContent,c as DropdownMenuLabel,d as DropdownMenuSeparator,e as DropdownMenuItem}from"./dropdown-menu.COVwx0ux.js";import{A as Avatar,a as AvatarImage,b as AvatarFallback}from"./avatar.DQITNWzQ.js";import{B as Badge}from"./badge.BFgaaq5n.js";import{D as Dialog,a as DialogContent,b as DialogHeader,c as DialogTitle,d as DialogDescription}from"./dialog.Deg6T-G2.js";import{S as ScrollArea}from"./scroll-area.85lfvw9b.js";import{S as Separator}from"./separator.D_t_gK4i.js";import{notificationApi,authApi,removeToken}from"./api.B5PpFILw.js";import{C as ConfirmationModal}from"./ConfirmationModal.BnFiX7YW.js";import{c as clearCachedProfile}from"./AuthGuard.BAZOsFzI.js";import"./index.CmV6gt94.js";import"./index.PIAPtHoh.js";import"./index.ubNQCTBn.js";import"./index.CLV08RI1.js";import"./index.BB0xO63c.js";import"./index.CZLqkOjo.js";import"./index.Drh0kMGk.js";import"./Combination.wteLWZ5f.js";import"./index.D7stNVgX.js";import"./index.Bcho8R2B.js";import"./index.Ci_bviUJ.js";import"./index.DNfkKfAg.js";import"./chevron-right.go_z-t67.js";import"./check.bOXrmBHo.js";import"./index.DYERl0li.js";import"./x.3YBaUzhJ.js";import"./index.DGt6JTY0.js";function NotificationModal({open,onOpenChange}){const[notifications,setNotifications]=reactExports.useState([]),[isLoading,setIsLoading]=reactExports.useState(!0);reactExports.useEffect(()=>{open&&fetchNotifications()},[open]);const fetchNotifications=async()=>{try{setIsLoading(!0);const response=await notificationApi.getNotifications(20);setNotifications(response.notifications)}catch(error){console.error("Failed to fetch notifications:",error)}finally{setIsLoading(!1)}},handleNotificationClick=notification=>{notification.link&&(window.location.href=notification.link)},getPriorityStyle=priority=>{switch(priority){case"critical":return"bg-red-100 text-red-600 border-red-300";case"high":return"bg-orange-100 text-orange-600 border-orange-300";default:return"bg-accent/10 text-accent-foreground border-accent/30"}},getIconStyle=priority=>{switch(priority){case"critical":return"bg-red-50 group-hover:bg-red-100";case"high":return"bg-orange-50 group-hover:bg-orange-100";case"medium":return"bg-primary/15 group-hover:bg-primary/20";default:return"bg-secondary group-hover:bg-secondary/70"}},getIconColor=priority=>{switch(priority){case"critical":return"text-red-600";case"high":return"text-orange-600";case"medium":return"text-primary";default:return"text-foreground"}};return jsxRuntimeExports.jsx(Dialog,{open,onOpenChange,children:jsxRuntimeExports.jsxs(DialogContent,{className:"sm:max-w-md",children:[jsxRuntimeExports.jsxs(DialogHeader,{children:[jsxRuntimeExports.jsx(DialogTitle,{children:"Notifikasi"}),jsxRuntimeExports.jsx(DialogDescription,{children:isLoading?"Memuat notifikasi...":`Anda memiliki ${notifications.length} notifikasi`})]}),jsxRuntimeExports.jsx(ScrollArea,{className:"h-[500px] pr-4",children:jsxRuntimeExports.jsx("div",{className:"space-y-2",children:isLoading?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-8",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"h-6 w-6 animate-spin text-muted-foreground"})}):notifications.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Bell",className:"h-12 w-12 mx-auto mb-2 opacity-50"}),jsxRuntimeExports.jsx("p",{children:"Tidak ada notifikasi"})]}):notifications.map((notification,index)=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{onClick:()=>handleNotificationClick(notification),className:"flex gap-3 p-3 rounded-lg cursor-pointer hover:bg-primary/5 active:bg-primary/10 transition-colors duration-200 group",children:[jsxRuntimeExports.jsx("div",{className:`flex h-10 w-10 shrink-0 items-center justify-center rounded-full ${getIconStyle(notification.priority)} transition-colors duration-200`,children:jsxRuntimeExports.jsx(SafeIcon,{name:notification.icon,className:`h-5 w-5 ${getIconColor(notification.priority)}`})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 space-y-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-2",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold leading-none text-foreground",children:notification.title}),(notification.priority==="critical"||notification.priority==="high")&&jsxRuntimeExports.jsx(Badge,{variant:"outline",className:`shrink-0 text-xs ${getPriorityStyle(notification.priority)}`,children:notification.priority==="critical"?"Kritis!":"Penting"})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground leading-snug",children:notification.message}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground/70",children:notification.time})]})]}),index<notifications.length-1&&jsxRuntimeExports.jsx(Separator,{className:"my-2"})]},notification.id))})}),jsxRuntimeExports.jsx(Button,{variant:"outline",className:"w-full mt-4 text-xs sm:text-sm hover:scale-105 active:scale-95 transition-all duration-300 ease-out",asChild:!0,children:jsxRuntimeExports.jsxs("a",{href:"/riwayat-aktivitas",children:["Lihat Semua Aktivitas",jsxRuntimeExports.jsx(SafeIcon,{name:"ArrowRight",className:"ml-2 h-4 w-4 transition-transform duration-300 group-hover:translate-x-1"})]})})]})})}const API_BASE_URL="http://localhost:3000",getAvatarUrl=url=>{if(url)return url.startsWith("http")?url:`${API_BASE_URL}/api${url}`};function AdminHeader({userName:initialUserName="Admin User",userRole:initialUserRole="Administrator",notificationCount:initialCount=0}){const[showNotifications,setShowNotifications]=reactExports.useState(!1),[showLogoutConfirm,setShowLogoutConfirm]=reactExports.useState(!1),[userName,setUserName]=reactExports.useState(initialUserName),[userRole,setUserRole]=reactExports.useState(initialUserRole),[avatarUrl,setAvatarUrl]=reactExports.useState(void 0),[notificationCount,setNotificationCount]=reactExports.useState(initialCount);reactExports.useEffect(()=>{(async()=>{try{const profile=await authApi.getProfile();setUserName(profile.name),setUserRole(profile.role==="ADMIN"?"Administrator":"Operator"),setAvatarUrl(getAvatarUrl(profile.avatar_url));const{notificationApi:notificationApi2}=await __vitePreload(async()=>{const{notificationApi:notificationApi3}=await import("./api.B5PpFILw.js");return{notificationApi:notificationApi3}},[],import.meta.url),notifData=await notificationApi2.getNotifications(20);setNotificationCount(notifData.unread_count)}catch(err){console.error("Failed to fetch data:",err)}})()},[]);const handleLogout=()=>{clearCachedProfile(),removeToken(),window.location.href="/login"},handleNotificationOpen=()=>{setShowNotifications(!0)},handleNotificationClose=async open=>{if(setShowNotifications(open),!open)try{const{notificationApi:notificationApi2}=await __vitePreload(async()=>{const{notificationApi:notificationApi3}=await import("./api.B5PpFILw.js");return{notificationApi:notificationApi3}},[],import.meta.url),notifData=await notificationApi2.getNotifications(20);setNotificationCount(notifData.unread_count)}catch(err){console.error("Failed to refresh notifications:",err)}};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-50 w-full border-b border-border bg-gradient-to-r from-background to-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 shadow-lg transition-all duration-300",id:"ijli",children:jsxRuntimeExports.jsxs("div",{className:"w-full flex h-16 items-center justify-between px-4 sm:px-6 lg:px-8",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-primary",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Flame",className:"h-6 w-6 text-primary-foreground"})}),jsxRuntimeExports.jsx("div",{className:"hidden sm:block",children:jsxRuntimeExports.jsx("h1",{className:"text-lg font-bold text-foreground",children:"SIM4LON"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs(Button,{variant:"ghost",size:"lg",className:"relative hover:bg-primary/10 transition-colors",onClick:handleNotificationOpen,"aria-label":"Notifikasi",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Bell",className:"h-6 w-6"}),notificationCount>0&&jsxRuntimeExports.jsx(Badge,{variant:"destructive",className:"absolute -right-1 -top-1 h-6 w-6 rounded-full p-0 text-xs flex items-center justify-center font-bold",children:notificationCount})]}),jsxRuntimeExports.jsxs(DropdownMenu,{children:[jsxRuntimeExports.jsx(DropdownMenuTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{variant:"ghost",className:"flex items-center gap-2 px-2",children:[jsxRuntimeExports.jsxs(Avatar,{className:"h-8 w-8",children:[jsxRuntimeExports.jsx(AvatarImage,{src:avatarUrl,alt:userName}),jsxRuntimeExports.jsx(AvatarFallback,{className:"bg-primary text-primary-foreground",children:userName.split(" ").map(n=>n[0]).join("").toUpperCase().slice(0,2)})]}),jsxRuntimeExports.jsxs("div",{className:"hidden md:block text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium",children:userName}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:userRole})]}),jsxRuntimeExports.jsx(SafeIcon,{name:"ChevronDown",className:"h-4 w-4 hidden md:block"})]})}),jsxRuntimeExports.jsxs(DropdownMenuContent,{align:"end",className:"w-56",children:[jsxRuntimeExports.jsx(DropdownMenuLabel,{children:"Akun Saya"}),jsxRuntimeExports.jsx(DropdownMenuSeparator,{}),jsxRuntimeExports.jsx(DropdownMenuItem,{asChild:!0,children:jsxRuntimeExports.jsxs("a",{href:"/profil-admin",className:"cursor-pointer",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"User",className:"mr-2 h-4 w-4"}),jsxRuntimeExports.jsx("span",{children:"Profil"})]})}),jsxRuntimeExports.jsx(DropdownMenuSeparator,{}),jsxRuntimeExports.jsxs(DropdownMenuItem,{onClick:()=>setShowLogoutConfirm(!0),className:"cursor-pointer text-destructive",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"LogOut",className:"mr-2 h-4 w-4"}),jsxRuntimeExports.jsx("span",{children:"Keluar"})]})]})]})]})]})}),jsxRuntimeExports.jsx(NotificationModal,{open:showNotifications,onOpenChange:handleNotificationClose}),jsxRuntimeExports.jsx(ConfirmationModal,{open:showLogoutConfirm,onOpenChange:setShowLogoutConfirm,title:"Konfirmasi Keluar",description:"Apakah Anda yakin ingin keluar dari sistem?",confirmText:"Ya, Keluar",cancelText:"Batal",icon:"LogOut",iconColor:"text-primary",isDangerous:!1,onConfirm:handleLogout})]})}export{AdminHeader as default};
