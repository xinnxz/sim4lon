import{r as reactExports}from"./index.DcciWILN.js";import{c as createContextScope,P as Primitive,a as composeEventHandlers}from"./index.CmV6gt94.js";import{c as createCollection}from"./index.CZLqkOjo.js";import{u as useComposedRefs}from"./SafeIcon.C08LGL0m.js";import{u as useId,a as useControllableState}from"./index.CLV08RI1.js";import{u as useCallbackRef}from"./index.BB0xO63c.js";import{u as useDirection}from"./index.Drh0kMGk.js";import{j as jsxRuntimeExports}from"./jsx-runtime.mvtouYz0.js";var ENTRY_FOCUS="rovingFocusGroup.onEntryFocus",EVENT_OPTIONS={bubbles:!1,cancelable:!0},GROUP_NAME="RovingFocusGroup",[Collection,useCollection,createCollectionScope]=createCollection(GROUP_NAME),[createRovingFocusGroupContext,createRovingFocusGroupScope]=createContextScope(GROUP_NAME,[createCollectionScope]),[RovingFocusProvider,useRovingFocusContext]=createRovingFocusGroupContext(GROUP_NAME),RovingFocusGroup=reactExports.forwardRef((props,forwardedRef)=>jsxRuntimeExports.jsx(Collection.Provider,{scope:props.__scopeRovingFocusGroup,children:jsxRuntimeExports.jsx(Collection.Slot,{scope:props.__scopeRovingFocusGroup,children:jsxRuntimeExports.jsx(RovingFocusGroupImpl,{...props,ref:forwardedRef})})}));RovingFocusGroup.displayName=GROUP_NAME;var RovingFocusGroupImpl=reactExports.forwardRef((props,forwardedRef)=>{const{__scopeRovingFocusGroup,orientation,loop=!1,dir,currentTabStopId:currentTabStopIdProp,defaultCurrentTabStopId,onCurrentTabStopIdChange,onEntryFocus,preventScrollOnEntryFocus=!1,...groupProps}=props,ref=reactExports.useRef(null),composedRefs=useComposedRefs(forwardedRef,ref),direction=useDirection(dir),[currentTabStopId,setCurrentTabStopId]=useControllableState({prop:currentTabStopIdProp,defaultProp:defaultCurrentTabStopId??null,onChange:onCurrentTabStopIdChange,caller:GROUP_NAME}),[isTabbingBackOut,setIsTabbingBackOut]=reactExports.useState(!1),handleEntryFocus=useCallbackRef(onEntryFocus),getItems=useCollection(__scopeRovingFocusGroup),isClickFocusRef=reactExports.useRef(!1),[focusableItemsCount,setFocusableItemsCount]=reactExports.useState(0);return reactExports.useEffect(()=>{const node=ref.current;if(node)return node.addEventListener(ENTRY_FOCUS,handleEntryFocus),()=>node.removeEventListener(ENTRY_FOCUS,handleEntryFocus)},[handleEntryFocus]),jsxRuntimeExports.jsx(RovingFocusProvider,{scope:__scopeRovingFocusGroup,orientation,dir:direction,loop,currentTabStopId,onItemFocus:reactExports.useCallback(tabStopId=>setCurrentTabStopId(tabStopId),[setCurrentTabStopId]),onItemShiftTab:reactExports.useCallback(()=>setIsTabbingBackOut(!0),[]),onFocusableItemAdd:reactExports.useCallback(()=>setFocusableItemsCount(prevCount=>prevCount+1),[]),onFocusableItemRemove:reactExports.useCallback(()=>setFocusableItemsCount(prevCount=>prevCount-1),[]),children:jsxRuntimeExports.jsx(Primitive.div,{tabIndex:isTabbingBackOut||focusableItemsCount===0?-1:0,"data-orientation":orientation,...groupProps,ref:composedRefs,style:{outline:"none",...props.style},onMouseDown:composeEventHandlers(props.onMouseDown,()=>{isClickFocusRef.current=!0}),onFocus:composeEventHandlers(props.onFocus,event=>{const isKeyboardFocus=!isClickFocusRef.current;if(event.target===event.currentTarget&&isKeyboardFocus&&!isTabbingBackOut){const entryFocusEvent=new CustomEvent(ENTRY_FOCUS,EVENT_OPTIONS);if(event.currentTarget.dispatchEvent(entryFocusEvent),!entryFocusEvent.defaultPrevented){const items=getItems().filter(item=>item.focusable),activeItem=items.find(item=>item.active),currentItem=items.find(item=>item.id===currentTabStopId),candidateNodes=[activeItem,currentItem,...items].filter(Boolean).map(item=>item.ref.current);focusFirst(candidateNodes,preventScrollOnEntryFocus)}}isClickFocusRef.current=!1}),onBlur:composeEventHandlers(props.onBlur,()=>setIsTabbingBackOut(!1))})})}),ITEM_NAME="RovingFocusGroupItem",RovingFocusGroupItem=reactExports.forwardRef((props,forwardedRef)=>{const{__scopeRovingFocusGroup,focusable=!0,active=!1,tabStopId,children,...itemProps}=props,autoId=useId(),id=tabStopId||autoId,context=useRovingFocusContext(ITEM_NAME,__scopeRovingFocusGroup),isCurrentTabStop=context.currentTabStopId===id,getItems=useCollection(__scopeRovingFocusGroup),{onFocusableItemAdd,onFocusableItemRemove,currentTabStopId}=context;return reactExports.useEffect(()=>{if(focusable)return onFocusableItemAdd(),()=>onFocusableItemRemove()},[focusable,onFocusableItemAdd,onFocusableItemRemove]),jsxRuntimeExports.jsx(Collection.ItemSlot,{scope:__scopeRovingFocusGroup,id,focusable,active,children:jsxRuntimeExports.jsx(Primitive.span,{tabIndex:isCurrentTabStop?0:-1,"data-orientation":context.orientation,...itemProps,ref:forwardedRef,onMouseDown:composeEventHandlers(props.onMouseDown,event=>{focusable?context.onItemFocus(id):event.preventDefault()}),onFocus:composeEventHandlers(props.onFocus,()=>context.onItemFocus(id)),onKeyDown:composeEventHandlers(props.onKeyDown,event=>{if(event.key==="Tab"&&event.shiftKey){context.onItemShiftTab();return}if(event.target!==event.currentTarget)return;const focusIntent=getFocusIntent(event,context.orientation,context.dir);if(focusIntent!==void 0){if(event.metaKey||event.ctrlKey||event.altKey||event.shiftKey)return;event.preventDefault();let candidateNodes=getItems().filter(item=>item.focusable).map(item=>item.ref.current);if(focusIntent==="last")candidateNodes.reverse();else if(focusIntent==="prev"||focusIntent==="next"){focusIntent==="prev"&&candidateNodes.reverse();const currentIndex=candidateNodes.indexOf(event.currentTarget);candidateNodes=context.loop?wrapArray(candidateNodes,currentIndex+1):candidateNodes.slice(currentIndex+1)}setTimeout(()=>focusFirst(candidateNodes))}}),children:typeof children=="function"?children({isCurrentTabStop,hasTabStop:currentTabStopId!=null}):children})})});RovingFocusGroupItem.displayName=ITEM_NAME;var MAP_KEY_TO_FOCUS_INTENT={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function getDirectionAwareKey(key,dir){return dir!=="rtl"?key:key==="ArrowLeft"?"ArrowRight":key==="ArrowRight"?"ArrowLeft":key}function getFocusIntent(event,orientation,dir){const key=getDirectionAwareKey(event.key,dir);if(!(orientation==="vertical"&&["ArrowLeft","ArrowRight"].includes(key))&&!(orientation==="horizontal"&&["ArrowUp","ArrowDown"].includes(key)))return MAP_KEY_TO_FOCUS_INTENT[key]}function focusFirst(candidates,preventScroll=!1){const PREVIOUSLY_FOCUSED_ELEMENT=document.activeElement;for(const candidate of candidates)if(candidate===PREVIOUSLY_FOCUSED_ELEMENT||(candidate.focus({preventScroll}),document.activeElement!==PREVIOUSLY_FOCUSED_ELEMENT))return}function wrapArray(array,startIndex){return array.map((_,index)=>array[(startIndex+index)%array.length])}var Root=RovingFocusGroup,Item=RovingFocusGroupItem;export{Item as I,Root as R,createRovingFocusGroupScope as c};
