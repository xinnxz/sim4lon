const API_BASE_URL="http://localhost:3000/api",TOKEN_KEY="sim4lon_token";function getToken(){return typeof window>"u"?null:localStorage.getItem(TOKEN_KEY)}function setToken(token){typeof window>"u"||localStorage.setItem(TOKEN_KEY,token)}function removeToken(){typeof window>"u"||localStorage.removeItem(TOKEN_KEY)}function isAuthenticated(){return!!getToken()}async function apiRequest(endpoint,options={}){const token=getToken(),headers={"Content-Type":"application/json",...options.headers};token&&(headers.Authorization=`Bearer ${token}`);const response=await fetch(`${API_BASE_URL}${endpoint}`,{...options,headers}),data=await response.json();if(!response.ok)throw response.status===401&&(removeToken(),typeof window<"u"&&!window.location.pathname.includes("/login")&&(window.location.href="/login")),new Error(data.message||"Request failed");return data}const authApi={async login(data){const response=await apiRequest("/auth/login",{method:"POST",body:JSON.stringify(data)});return setToken(response.access_token),response},async getProfile(){return apiRequest("/auth/profile")},async updateProfile(data){return apiRequest("/auth/profile",{method:"PUT",body:JSON.stringify(data)})},async changePassword(data){return apiRequest("/auth/change-password",{method:"PUT",body:JSON.stringify(data)})},logout(){removeToken(),typeof window<"u"&&(window.location.href="/login")}},uploadApi={async uploadAvatar(file){const token=getToken(),formData=new FormData;formData.append("file",file);const response=await fetch(`${API_BASE_URL}/upload/avatar`,{method:"POST",headers:{Authorization:`Bearer ${token}`},body:formData}),data=await response.json();if(!response.ok)throw new Error(data.message||"Upload gagal");return data}},notificationApi={async getNotifications(limit=10){return apiRequest(`/notifications?limit=${limit}`)}},activityApi={async getAll(page=1,limit=20,type){const params=new URLSearchParams;return params.append("page",page.toString()),params.append("limit",limit.toString()),type&&type!=="all"&&params.append("type",type),apiRequest(`/activities?${params.toString()}`)},async getRecent(limit=10){return apiRequest(`/activities/recent?limit=${limit}`)},async getByType(type,limit=20){return apiRequest(`/activities/by-type?type=${type}&limit=${limit}`)}},reportsApi={async getSalesReport(startDate,endDate){const params=new URLSearchParams;return startDate&&params.append("startDate",startDate),endDate&&params.append("endDate",endDate),apiRequest(`/reports/sales?${params.toString()}`)},async getPaymentsReport(startDate,endDate){const params=new URLSearchParams;return startDate&&params.append("startDate",startDate),endDate&&params.append("endDate",endDate),apiRequest(`/reports/payments?${params.toString()}`)},async getStockMovementReport(startDate,endDate,productId){const params=new URLSearchParams;return startDate&&params.append("startDate",startDate),endDate&&params.append("endDate",endDate),productId&&params.append("productId",productId),apiRequest(`/reports/stock-movement?${params.toString()}`)}},pangkalanApi={async getAll(page=1,limit=10,search,isActive){const params=new URLSearchParams;return params.append("page",page.toString()),params.append("limit",limit.toString()),search&&params.append("search",search),isActive!==void 0&&params.append("is_active",isActive.toString()),apiRequest(`/pangkalans?${params.toString()}`)},async getById(id){return apiRequest(`/pangkalans/${id}`)},async create(data){return apiRequest("/pangkalans",{method:"POST",body:JSON.stringify(data)})},async update(id,data){return apiRequest(`/pangkalans/${id}`,{method:"PUT",body:JSON.stringify(data)})},async delete(id){return apiRequest(`/pangkalans/${id}`,{method:"DELETE"})}},driversApi={async getAll(page=1,limit=10,search,isActive){const params=new URLSearchParams;return params.append("page",page.toString()),params.append("limit",limit.toString()),search&&params.append("search",search),isActive!==void 0&&params.append("is_active",isActive.toString()),apiRequest(`/drivers?${params.toString()}`)},async getById(id){return apiRequest(`/drivers/${id}`)},async create(data){return apiRequest("/drivers",{method:"POST",body:JSON.stringify(data)})},async update(id,data){return apiRequest(`/drivers/${id}`,{method:"PUT",body:JSON.stringify(data)})},async delete(id){return apiRequest(`/drivers/${id}`,{method:"DELETE"})}},lpgProductsApi={async getAll(includeInactive=!1){return apiRequest(`/lpg-products${includeInactive?"?includeInactive=true":""}`)},async getWithStock(){return apiRequest("/lpg-products/with-stock")},async getOne(id){return apiRequest(`/lpg-products/${id}`)},async create(data){return apiRequest("/lpg-products",{method:"POST",body:JSON.stringify(data)})},async update(id,data){return apiRequest(`/lpg-products/${id}`,{method:"PUT",body:JSON.stringify(data)})},async delete(id){return apiRequest(`/lpg-products/${id}`,{method:"DELETE"})},async addPrice(productId,data){return apiRequest(`/lpg-products/${productId}/prices`,{method:"POST",body:JSON.stringify(data)})},async updatePrice(priceId,data){return apiRequest(`/lpg-products/prices/${priceId}`,{method:"PUT",body:JSON.stringify(data)})},async deletePrice(priceId){return apiRequest(`/lpg-products/prices/${priceId}`,{method:"DELETE"})}},stockApi={async getSummary(){return apiRequest("/stocks/summary")},async getHistory(page=1,limit=10,lpgType,movementType){const params=new URLSearchParams;return params.append("page",page.toString()),params.append("limit",limit.toString()),lpgType&&params.append("lpg_type",lpgType),movementType&&params.append("movement_type",movementType),apiRequest(`/stocks/history?${params.toString()}`)},async getHistoryByType(lpgType,limit=20){return apiRequest(`/stocks/history/${lpgType}?limit=${limit}`)},async createMovement(data){return apiRequest("/stocks/movements",{method:"POST",body:JSON.stringify(data)})}},usersApi={async getAll(page=1,limit=10,search){const params=new URLSearchParams;return params.append("page",page.toString()),params.append("limit",limit.toString()),search&&params.append("search",search),apiRequest(`/users?${params.toString()}`)},async getById(id){return apiRequest(`/users/${id}`)},async create(data){return apiRequest("/users",{method:"POST",body:JSON.stringify(data)})},async update(id,data){return apiRequest(`/users/${id}`,{method:"PUT",body:JSON.stringify(data)})},async delete(id){return apiRequest(`/users/${id}`,{method:"DELETE"})},async resetPassword(id){return apiRequest(`/users/${id}/reset-password`,{method:"POST"})}},dashboardApi={async getStats(){return apiRequest("/dashboard/stats")},async getSalesChart(){return apiRequest("/dashboard/sales")},async getStockChart(){return apiRequest("/dashboard/stock")},async getProfitChart(){return apiRequest("/dashboard/profit")},async getTopPangkalan(){return apiRequest("/dashboard/top-pangkalan")},async getStockConsumption(){return apiRequest("/dashboard/stock-consumption")},async getRecentActivities(){return apiRequest("/dashboard/activities")}},ordersApi={async getAll(page=1,limit=10,status,pangkalanId,driverId){const params=new URLSearchParams({page:page.toString(),limit:limit.toString()});return status&&params.append("status",status),pangkalanId&&params.append("pangkalan_id",pangkalanId),driverId&&params.append("driver_id",driverId),apiRequest(`/orders?${params.toString()}`)},async getById(id){return apiRequest(`/orders/${id}`)},async create(dto){return apiRequest("/orders",{method:"POST",body:JSON.stringify(dto)})},async updateStatus(id,dto){return apiRequest(`/orders/${id}/status`,{method:"PATCH",body:JSON.stringify(dto)})},async update(id,dto){return apiRequest(`/orders/${id}`,{method:"PUT",body:JSON.stringify(dto)})},async delete(id){return apiRequest(`/orders/${id}`,{method:"DELETE"})},async getStats(todayOnly=!1){return apiRequest(`/orders/stats${todayOnly?"?today=true":""}`)}},paymentApi={async createRecord(dto){return apiRequest("/payments/records",{method:"POST",body:JSON.stringify(dto)})},async getRecords(page=1,limit=10,orderId,method){const params=new URLSearchParams({page:page.toString(),limit:limit.toString()});return orderId&&params.append("order_id",orderId),method&&params.append("method",method),apiRequest(`/payments/records?${params.toString()}`)},async getRecordById(id){return apiRequest(`/payments/records/${id}`)},async getOrderPayment(orderId){return apiRequest(`/payments/orders/${orderId}`)},async updateOrderPayment(orderId,dto){return apiRequest(`/payments/orders/${orderId}`,{method:"PUT",body:JSON.stringify(dto)})}};export{activityApi,authApi,dashboardApi,driversApi,getToken,isAuthenticated,lpgProductsApi,notificationApi,ordersApi,pangkalanApi,paymentApi,removeToken,reportsApi,setToken,stockApi,uploadApi,usersApi};
