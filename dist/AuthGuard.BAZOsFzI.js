import{j as jsxRuntimeExports}from"./jsx-runtime.mvtouYz0.js";import{r as reactExports}from"./index.DcciWILN.js";import{isAuthenticated,authApi,removeToken}from"./api.B5PpFILw.js";const PROFILE_CACHE_KEY="sim4lon_user_profile",PROFILE_CACHE_TIME_KEY="sim4lon_profile_cache_time",CACHE_DURATION_MS=300*1e3;function getCachedProfile(){if(typeof window>"u")return null;try{const cachedTime=sessionStorage.getItem(PROFILE_CACHE_TIME_KEY),cachedProfile=sessionStorage.getItem(PROFILE_CACHE_KEY);return!cachedTime||!cachedProfile?null:Date.now()-parseInt(cachedTime,10)>CACHE_DURATION_MS?(sessionStorage.removeItem(PROFILE_CACHE_KEY),sessionStorage.removeItem(PROFILE_CACHE_TIME_KEY),null):JSON.parse(cachedProfile)}catch{return null}}function setCachedProfile(profile){if(!(typeof window>"u"))try{sessionStorage.setItem(PROFILE_CACHE_KEY,JSON.stringify(profile)),sessionStorage.setItem(PROFILE_CACHE_TIME_KEY,Date.now().toString())}catch{}}function clearCachedProfile(){typeof window>"u"||(sessionStorage.removeItem(PROFILE_CACHE_KEY),sessionStorage.removeItem(PROFILE_CACHE_TIME_KEY))}function AuthGuard({children,allowedRoles=[],redirectTo="/login",forceRefresh=!1}){const cachedProfile=getCachedProfile(),hasValidCache=!forceRefresh&&cachedProfile!==null,[isChecking,setIsChecking]=reactExports.useState(!hasValidCache),[isAuthorized,setIsAuthorized]=reactExports.useState(hasValidCache),[user,setUser]=reactExports.useState(cachedProfile);return reactExports.useEffect(()=>{(async()=>{if(!isAuthenticated()){window.location.href=redirectTo;return}if(!forceRefresh&&cachedProfile){if(allowedRoles.length>0&&!allowedRoles.includes(cachedProfile.role)){const correctDashboard=cachedProfile.role==="ADMIN"?"/dashboard-admin":"/dashboard-operator";window.location.href=correctDashboard;return}return}try{const userProfile=await authApi.getProfile();if(setCachedProfile(userProfile),allowedRoles.length>0&&!allowedRoles.includes(userProfile.role)){const correctDashboard=userProfile.role==="ADMIN"?"/dashboard-admin":"/dashboard-operator";window.location.href=correctDashboard;return}setUser(userProfile),setIsAuthorized(!0)}catch{clearCachedProfile(),removeToken(),window.location.href=redirectTo}finally{setIsChecking(!1)}})()},[allowedRoles,redirectTo,forceRefresh]),hasValidCache&&isAuthorized?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children}):isChecking?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center min-h-screen bg-background",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground",children:"Memverifikasi akses..."})]})}):isAuthorized?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children}):null}export{AuthGuard as A,clearCachedProfile as c};
