import{r as reactExports}from"./index.DcciWILN.js";import{u as useComposedRefs}from"./SafeIcon.CAGsavDo.js";import{u as useLayoutEffect2}from"./index.Dovp0-D8.js";function useStateMachine(initialState,machine){return reactExports.useReducer((state,event)=>machine[state][event]??state,initialState)}var Presence=props=>{const{present,children}=props,presence=usePresence(present),child=typeof children=="function"?children({present:presence.isPresent}):reactExports.Children.only(children),ref=useComposedRefs(presence.ref,getElementRef(child));return typeof children=="function"||presence.isPresent?reactExports.cloneElement(child,{ref}):null};Presence.displayName="Presence";function usePresence(present){const[node,setNode]=reactExports.useState(),stylesRef=reactExports.useRef(null),prevPresentRef=reactExports.useRef(present),prevAnimationNameRef=reactExports.useRef("none"),initialState=present?"mounted":"unmounted",[state,send]=useStateMachine(initialState,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return reactExports.useEffect(()=>{const currentAnimationName=getAnimationName(stylesRef.current);prevAnimationNameRef.current=state==="mounted"?currentAnimationName:"none"},[state]),useLayoutEffect2(()=>{const styles=stylesRef.current,wasPresent=prevPresentRef.current;if(wasPresent!==present){const prevAnimationName=prevAnimationNameRef.current,currentAnimationName=getAnimationName(styles);present?send("MOUNT"):currentAnimationName==="none"||styles?.display==="none"?send("UNMOUNT"):send(wasPresent&&prevAnimationName!==currentAnimationName?"ANIMATION_OUT":"UNMOUNT"),prevPresentRef.current=present}},[present,send]),useLayoutEffect2(()=>{if(node){let timeoutId;const ownerWindow=node.ownerDocument.defaultView??window,handleAnimationEnd=event=>{const isCurrentAnimation=getAnimationName(stylesRef.current).includes(CSS.escape(event.animationName));if(event.target===node&&isCurrentAnimation&&(send("ANIMATION_END"),!prevPresentRef.current)){const currentFillMode=node.style.animationFillMode;node.style.animationFillMode="forwards",timeoutId=ownerWindow.setTimeout(()=>{node.style.animationFillMode==="forwards"&&(node.style.animationFillMode=currentFillMode)})}},handleAnimationStart=event=>{event.target===node&&(prevAnimationNameRef.current=getAnimationName(stylesRef.current))};return node.addEventListener("animationstart",handleAnimationStart),node.addEventListener("animationcancel",handleAnimationEnd),node.addEventListener("animationend",handleAnimationEnd),()=>{ownerWindow.clearTimeout(timeoutId),node.removeEventListener("animationstart",handleAnimationStart),node.removeEventListener("animationcancel",handleAnimationEnd),node.removeEventListener("animationend",handleAnimationEnd)}}else send("ANIMATION_END")},[node,send]),{isPresent:["mounted","unmountSuspended"].includes(state),ref:reactExports.useCallback(node2=>{stylesRef.current=node2?getComputedStyle(node2):null,setNode(node2)},[])}}function getAnimationName(styles){return styles?.animationName||"none"}function getElementRef(element){let getter=Object.getOwnPropertyDescriptor(element.props,"ref")?.get,mayWarn=getter&&"isReactWarning"in getter&&getter.isReactWarning;return mayWarn?element.ref:(getter=Object.getOwnPropertyDescriptor(element,"ref")?.get,mayWarn=getter&&"isReactWarning"in getter&&getter.isReactWarning,mayWarn?element.props.ref:element.props.ref||element.ref)}export{Presence as P};
