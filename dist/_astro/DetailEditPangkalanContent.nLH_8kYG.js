import{j as jsxRuntimeExports}from"./jsx-runtime.mvtouYz0.js";import{r as reactExports}from"./index.DcciWILN.js";import{S as SafeIcon,B as Button}from"./SafeIcon.CAGsavDo.js";import{S as Skeleton}from"./skeleton.CCqcM_wt.js";import{C as Card,b as CardHeader,c as CardTitle,a as CardContent,d as CardDescription}from"./card.D0gylVsf.js";import{B as Badge}from"./badge.DZiJ6zSB.js";import{T as Table,a as TableHeader,b as TableRow,c as TableHead,d as TableBody,e as TableCell}from"./table.DRds5X1g.js";import{D as Dialog,a as DialogContent,b as DialogHeader,c as DialogTitle,d as DialogDescription,f as DialogFooter}from"./dialog.CoJQQKDV.js";import{I as Input}from"./input.C9ryBhC0.js";import{o as object,i as boolean,s as string,u as useForm,a,g as getKecamatanByKabupaten,F as Form,b as FormField,c as FormItem,d as FormLabel,e as FormControl,h as FormMessage,f as FormDescription,K as KABUPATEN_DATA}from"./regions.CvY4fZka.js";import{T as Textarea}from"./textarea.CmILhP_C.js";import{S as Switch}from"./switch.C0Q8Ircf.js";import{S as Select,a as SelectTrigger,b as SelectValue,c as SelectContent,d as SelectItem}from"./select.Dd50uIHU.js";import{C as ConfirmationModal}from"./ConfirmationModal.Ck8mepRg.js";import{t as toast}from"./index.fAd_ikgp.js";import{pangkalanApi,ordersApi}from"./api.Dr7hS9Y8.js";import{f as formatCurrency}from"./currency.DQ9ceiwM.js";import"./index.zVS-qTD4.js";import"./index.BpQ989z7.js";import"./index.PIAPtHoh.js";import"./index.ubNQCTBn.js";import"./index.YpXgcoRz.js";import"./index.Dovp0-D8.js";import"./index.DZiLsHox.js";import"./index.CdmyERTi.js";import"./x.DUlMVzh7.js";import"./label.BFF1cpbq.js";import"./index.BhA3i5Wo.js";import"./index.9MihlNbL.js";import"./index.DGt6JTY0.js";import"./index.BStXkqMp.js";import"./index.Drh0kMGk.js";import"./index.BFpcrWlj.js";import"./index.BaF2FVWY.js";import"./chevron-up.BBBXIirx.js";import"./check.TUgVKQyo.js";function PangkalanInfoCard({pangkalan}){const formatDate=dateString=>new Date(dateString).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs(Card,{children:[jsxRuntimeExports.jsx(CardHeader,{children:jsxRuntimeExports.jsxs(CardTitle,{className:"text-lg flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Store",className:"h-5 w-5 text-primary"}),"Informasi Utama"]})}),jsxRuntimeExports.jsxs(CardContent,{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Nama Pangkalan"}),jsxRuntimeExports.jsx("p",{className:"text-base text-foreground mt-1 font-semibold",children:pangkalan.name})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Kode Pangkalan"}),jsxRuntimeExports.jsx("p",{className:"text-base text-foreground mt-1 font-mono",children:pangkalan.code})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Wilayah"}),jsxRuntimeExports.jsx("p",{className:"text-base text-foreground mt-1",children:pangkalan.region||"-"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),jsxRuntimeExports.jsx("div",{className:"mt-1",children:jsxRuntimeExports.jsx(Badge,{variant:"status",className:pangkalan.is_active?"bg-green-100 text-green-700":"bg-red-100 text-red-700",children:pangkalan.is_active?"Aktif":"Nonaktif"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Kapasitas"}),jsxRuntimeExports.jsx("p",{className:"text-base text-foreground mt-1",children:pangkalan.capacity?`${pangkalan.capacity} unit`:"-"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Alokasi Bulanan"}),jsxRuntimeExports.jsx("p",{className:"text-base text-foreground mt-1 font-semibold",children:pangkalan.alokasi_bulanan?`${pangkalan.alokasi_bulanan.toLocaleString()} tabung`:"-"})]})]})]})]}),jsxRuntimeExports.jsxs(Card,{children:[jsxRuntimeExports.jsx(CardHeader,{className:"pb-2",children:jsxRuntimeExports.jsxs(CardTitle,{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Users",className:"h-5 w-5 text-primary"}),"Kontak"]})}),jsxRuntimeExports.jsxs(CardContent,{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Nama PIC"}),jsxRuntimeExports.jsx("p",{className:"text-base text-foreground mt-1 font-semibold",children:pangkalan.pic_name||"-"})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Phone",className:"h-5 w-5 text-muted-foreground mt-0.5 shrink-0"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Nomor Telepon"}),jsxRuntimeExports.jsx("a",{href:`tel:${pangkalan.phone}`,className:"text-base text-primary mt-1 hover:underline",children:pangkalan.phone||"-"})]})]})}),jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Mail",className:"h-5 w-5 text-muted-foreground mt-0.5 shrink-0"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),pangkalan.email?jsxRuntimeExports.jsx("a",{href:`mailto:${pangkalan.email}`,className:"text-base text-primary mt-1 hover:underline",children:pangkalan.email}):jsxRuntimeExports.jsx("p",{className:"text-base text-muted-foreground mt-1 italic",children:"Tidak ada email"})]})]})})]})]})]}),jsxRuntimeExports.jsxs(Card,{children:[jsxRuntimeExports.jsx(CardHeader,{className:"pb-2",children:jsxRuntimeExports.jsxs(CardTitle,{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"MapPin",className:"h-5 w-5 text-primary"}),"Alamat Lengkap"]})}),jsxRuntimeExports.jsx(CardContent,{children:jsxRuntimeExports.jsx("p",{className:"text-base text-foreground",children:pangkalan.address})})]}),pangkalan.note&&jsxRuntimeExports.jsxs(Card,{children:[jsxRuntimeExports.jsx(CardHeader,{className:"pb-2",children:jsxRuntimeExports.jsxs(CardTitle,{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"FileText",className:"h-5 w-5 text-primary"}),"Catatan"]})}),jsxRuntimeExports.jsx(CardContent,{children:jsxRuntimeExports.jsx("p",{className:"text-base text-foreground",children:pangkalan.note})})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[jsxRuntimeExports.jsxs(Card,{children:[jsxRuntimeExports.jsx(CardHeader,{className:"pb-3",children:jsxRuntimeExports.jsx(CardTitle,{className:"text-base",children:"Dibuat"})}),jsxRuntimeExports.jsxs(CardContent,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Tanggal Pembuatan"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-foreground mt-1",children:formatDate(pangkalan.created_at)})]})]}),jsxRuntimeExports.jsxs(Card,{children:[jsxRuntimeExports.jsx(CardHeader,{className:"pb-3",children:jsxRuntimeExports.jsx(CardTitle,{className:"text-base",children:"Diperbarui"})}),jsxRuntimeExports.jsxs(CardContent,{children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground",children:"Terakhir Diperbarui"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-foreground mt-1",children:formatDate(pangkalan.updated_at)})]})]})]})]})}function parseRegion(region){if(!region)return{kabupaten:"",kecamatan:""};const parts=region.split(",");if(parts.length>=2){const kecamatan=parts[0].trim(),kabupatenName=parts[1].trim(),kabupaten=KABUPATEN_DATA.find(k=>k.name===kabupatenName||kabupatenName.includes(k.name.replace("Kabupaten ","")));if(kabupaten)return{kabupaten:kabupaten.id,kecamatan}}for(const kab of KABUPATEN_DATA)if(kab.kecamatan.includes(region))return{kabupaten:kab.id,kecamatan:region};return{kabupaten:"",kecamatan:region}}const pangkalanSchema=object({name:string().min(3,"Nama pangkalan minimal 3 karakter").max(100,"Nama pangkalan maksimal 100 karakter"),address:string().min(10,"Alamat minimal 10 karakter").max(255,"Alamat maksimal 255 karakter"),kabupaten:string().min(1,"Kabupaten harus dipilih"),kecamatan:string().min(1,"Kecamatan harus dipilih"),pic_name:string().min(2,"Nama PIC minimal 2 karakter").max(100,"Nama PIC maksimal 100 karakter"),phone:string().regex(/^(\+62|0)[0-9]{9,12}$/,"Nomor telepon tidak valid (contoh: 08xx atau +62xx)"),email:string().min(1,"Email wajib diisi").email("Format email tidak valid"),capacity:string().optional(),alokasi_bulanan:string().optional(),note:string().max(500,"Catatan maksimal 500 karakter").optional(),is_active:boolean()});function PangkalanEditForm({pangkalan,onSave,onCancel,isSaving}){const parsedRegion=parseRegion(pangkalan.region),[selectedKabupaten,setSelectedKabupaten]=reactExports.useState(parsedRegion.kabupaten),form=useForm({resolver:a(pangkalanSchema),defaultValues:{name:pangkalan.name||"",address:pangkalan.address||"",kabupaten:parsedRegion.kabupaten,kecamatan:parsedRegion.kecamatan,pic_name:pangkalan.pic_name||"",phone:pangkalan.phone||"",email:pangkalan.email||"",capacity:pangkalan.capacity?.toString()||"",alokasi_bulanan:pangkalan.alokasi_bulanan?.toString()||"",note:pangkalan.note||"",is_active:pangkalan.is_active}}),kecamatanList=getKecamatanByKabupaten(selectedKabupaten),onSubmit=async values=>{const kabupatenName=KABUPATEN_DATA.find(k=>k.id===values.kabupaten)?.name||values.kabupaten,region=`${values.kecamatan}, ${kabupatenName}`,data={name:values.name,address:values.address,region,pic_name:values.pic_name,phone:values.phone,is_active:values.is_active};values.email&&(data.email=values.email),values.capacity&&(data.capacity=parseInt(values.capacity,10)),values.alokasi_bulanan&&(data.alokasi_bulanan=parseInt(values.alokasi_bulanan,10)),values.note&&(data.note=values.note),await onSave(data)};return jsxRuntimeExports.jsxs(Card,{children:[jsxRuntimeExports.jsxs(CardHeader,{children:[jsxRuntimeExports.jsx(CardTitle,{children:"Edit Informasi Pangkalan"}),jsxRuntimeExports.jsx(CardDescription,{children:"Perbarui data pangkalan sesuai kebutuhan"})]}),jsxRuntimeExports.jsx(CardContent,{children:jsxRuntimeExports.jsx(Form,{...form,children:jsxRuntimeExports.jsxs("form",{onSubmit:form.handleSubmit(onSubmit),className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[jsxRuntimeExports.jsx(FormField,{control:form.control,name:"name",render:({field})=>jsxRuntimeExports.jsxs(FormItem,{children:[jsxRuntimeExports.jsx(FormLabel,{className:"text-base font-semibold",children:"Nama Pangkalan *"}),jsxRuntimeExports.jsx(FormControl,{children:jsxRuntimeExports.jsx(Input,{placeholder:"Contoh: Pangkalan Maju Jaya",...field,disabled:isSaving})}),jsxRuntimeExports.jsx(FormMessage,{})]})}),jsxRuntimeExports.jsx(FormField,{control:form.control,name:"email",render:({field})=>jsxRuntimeExports.jsxs(FormItem,{children:[jsxRuntimeExports.jsx(FormLabel,{className:"text-base font-semibold",children:"Email *"}),jsxRuntimeExports.jsx(FormControl,{children:jsxRuntimeExports.jsx(Input,{placeholder:"email@example.com",...field,disabled:isSaving,type:"email"})}),jsxRuntimeExports.jsx(FormDescription,{children:"Untuk kirim invoice/nota"}),jsxRuntimeExports.jsx(FormMessage,{})]})})]}),jsxRuntimeExports.jsx(FormField,{control:form.control,name:"address",render:({field})=>jsxRuntimeExports.jsxs(FormItem,{children:[jsxRuntimeExports.jsx(FormLabel,{className:"text-base font-semibold",children:"Alamat Lengkap *"}),jsxRuntimeExports.jsx(FormControl,{children:jsxRuntimeExports.jsx(Textarea,{placeholder:"Masukkan alamat lengkap...",...field,disabled:isSaving,rows:3})}),jsxRuntimeExports.jsx(FormDescription,{children:"Alamat lengkap pangkalan"}),jsxRuntimeExports.jsx(FormMessage,{})]})}),jsxRuntimeExports.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[jsxRuntimeExports.jsx(FormField,{control:form.control,name:"kabupaten",render:({field})=>jsxRuntimeExports.jsxs(FormItem,{children:[jsxRuntimeExports.jsx(FormLabel,{className:"text-base font-semibold",children:"Kabupaten *"}),jsxRuntimeExports.jsxs(Select,{onValueChange:value=>{field.onChange(value),setSelectedKabupaten(value),form.setValue("kecamatan","")},defaultValue:field.value,disabled:isSaving,children:[jsxRuntimeExports.jsx(FormControl,{children:jsxRuntimeExports.jsx(SelectTrigger,{children:jsxRuntimeExports.jsx(SelectValue,{placeholder:"Pilih Kabupaten"})})}),jsxRuntimeExports.jsx(SelectContent,{children:KABUPATEN_DATA.map(kab=>jsxRuntimeExports.jsx(SelectItem,{value:kab.id,children:kab.name},kab.id))})]}),jsxRuntimeExports.jsx(FormMessage,{})]})}),jsxRuntimeExports.jsx(FormField,{control:form.control,name:"kecamatan",render:({field})=>jsxRuntimeExports.jsxs(FormItem,{children:[jsxRuntimeExports.jsx(FormLabel,{className:"text-base font-semibold",children:"Kecamatan *"}),jsxRuntimeExports.jsxs(Select,{onValueChange:field.onChange,defaultValue:field.value,disabled:isSaving||!selectedKabupaten,children:[jsxRuntimeExports.jsx(FormControl,{children:jsxRuntimeExports.jsx(SelectTrigger,{children:jsxRuntimeExports.jsx(SelectValue,{placeholder:selectedKabupaten?"Pilih Kecamatan":"Pilih Kabupaten dulu"})})}),jsxRuntimeExports.jsx(SelectContent,{children:kecamatanList.map(kec=>jsxRuntimeExports.jsx(SelectItem,{value:kec,children:kec},kec))})]}),jsxRuntimeExports.jsx(FormMessage,{})]})})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[jsxRuntimeExports.jsx(FormField,{control:form.control,name:"pic_name",render:({field})=>jsxRuntimeExports.jsxs(FormItem,{children:[jsxRuntimeExports.jsx(FormLabel,{className:"text-base font-semibold",children:"Nama PIC *"}),jsxRuntimeExports.jsx(FormControl,{children:jsxRuntimeExports.jsx(Input,{placeholder:"Nama penanggung jawab",...field,disabled:isSaving})}),jsxRuntimeExports.jsx(FormMessage,{})]})}),jsxRuntimeExports.jsx(FormField,{control:form.control,name:"phone",render:({field})=>jsxRuntimeExports.jsxs(FormItem,{children:[jsxRuntimeExports.jsx(FormLabel,{className:"text-base font-semibold",children:"No. Telepon *"}),jsxRuntimeExports.jsx(FormControl,{children:jsxRuntimeExports.jsx(Input,{placeholder:"08xx atau +62xx",...field,disabled:isSaving,type:"tel"})}),jsxRuntimeExports.jsx(FormMessage,{})]})})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[jsxRuntimeExports.jsx(FormField,{control:form.control,name:"capacity",render:({field})=>jsxRuntimeExports.jsxs(FormItem,{children:[jsxRuntimeExports.jsx(FormLabel,{className:"text-base font-semibold",children:"Kapasitas"}),jsxRuntimeExports.jsx(FormControl,{children:jsxRuntimeExports.jsx(Input,{placeholder:"Contoh: 500",...field,disabled:isSaving,type:"number",onWheel:e=>e.target.blur()})}),jsxRuntimeExports.jsx(FormDescription,{children:"Kapasitas penyimpanan (unit)"}),jsxRuntimeExports.jsx(FormMessage,{})]})}),jsxRuntimeExports.jsx(FormField,{control:form.control,name:"alokasi_bulanan",render:({field})=>jsxRuntimeExports.jsxs(FormItem,{children:[jsxRuntimeExports.jsx(FormLabel,{className:"text-base font-semibold",children:"Alokasi Bulanan *"}),jsxRuntimeExports.jsx(FormControl,{children:jsxRuntimeExports.jsx(Input,{placeholder:"Contoh: 500",...field,disabled:isSaving,type:"number",min:0,onWheel:e=>e.target.blur()})}),jsxRuntimeExports.jsx(FormDescription,{children:"Tabung/bulan untuk auto-generate"}),jsxRuntimeExports.jsx(FormMessage,{})]})})]}),jsxRuntimeExports.jsx(FormField,{control:form.control,name:"note",render:({field})=>jsxRuntimeExports.jsxs(FormItem,{children:[jsxRuntimeExports.jsx(FormLabel,{className:"text-base font-semibold",children:"Catatan (Opsional)"}),jsxRuntimeExports.jsx(FormControl,{children:jsxRuntimeExports.jsx(Textarea,{placeholder:"Catatan tambahan...",...field,disabled:isSaving,rows:3})}),jsxRuntimeExports.jsx(FormMessage,{})]})}),jsxRuntimeExports.jsx(FormField,{control:form.control,name:"is_active",render:({field})=>jsxRuntimeExports.jsxs(FormItem,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-0.5",children:[jsxRuntimeExports.jsx(FormLabel,{className:"text-base font-semibold",children:"Status Aktif"}),jsxRuntimeExports.jsx(FormDescription,{children:"Pangkalan aktif dapat menerima pesanan"})]}),jsxRuntimeExports.jsx(FormControl,{children:jsxRuntimeExports.jsx(Switch,{checked:field.value,onCheckedChange:field.onChange,disabled:isSaving})})]})}),jsxRuntimeExports.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[jsxRuntimeExports.jsxs(Button,{type:"button",variant:"outline",onClick:onCancel,disabled:isSaving,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"X",className:"mr-2 h-4 w-4"}),"Batal"]}),jsxRuntimeExports.jsx(Button,{type:"submit",disabled:isSaving,className:"min-w-[140px]",children:isSaving?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"mr-2 h-4 w-4 animate-spin"}),"Menyimpan..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Save",className:"mr-2 h-4 w-4"}),"Simpan Perubahan"]})})]})]})})})]})}const statusLabels={DRAFT:"Draft",MENUNGGU_PEMBAYARAN:"Menunggu Pembayaran",DIPROSES:"Diproses",SIAP_KIRIM:"Siap Kirim",DIKIRIM:"Sedang Dikirim",SELESAI:"Selesai",BATAL:"Dibatalkan"},statusColors={DRAFT:"bg-gray-100 text-gray-700",MENUNGGU_PEMBAYARAN:"bg-amber-100 text-amber-700",DIPROSES:"bg-blue-100 text-blue-700",SIAP_KIRIM:"bg-purple-100 text-purple-700",DIKIRIM:"bg-indigo-100 text-indigo-700",SELESAI:"bg-green-100 text-green-700",BATAL:"bg-red-100 text-red-700"};function DetailEditPangkalanContent(){const[pangkalan,setPangkalan]=reactExports.useState(null),[orders,setOrders]=reactExports.useState([]),[isLoading,setIsLoading]=reactExports.useState(!0),[isEditing,setIsEditing]=reactExports.useState(!1),[isSaving,setIsSaving]=reactExports.useState(!1),[showDeleteModal,setShowDeleteModal]=reactExports.useState(!1),[isDeleting,setIsDeleting]=reactExports.useState(!1),[showResetPasswordModal,setShowResetPasswordModal]=reactExports.useState(!1),[isResettingPassword,setIsResettingPassword]=reactExports.useState(!1),[newPassword,setNewPassword]=reactExports.useState(null),getPangkalanId=()=>typeof window>"u"?null:new URLSearchParams(window.location.search).get("id");reactExports.useEffect(()=>{(async()=>{const id=getPangkalanId();if(!id){toast.error("ID Pangkalan tidak ditemukan"),setIsLoading(!1);return}try{const[pangkalanData,ordersData]=await Promise.all([pangkalanApi.getById(id),ordersApi.getAll(1,10,void 0,id)]);setPangkalan(pangkalanData),setOrders(ordersData.data||[])}catch(error){console.error("Failed to fetch data:",error),toast.error("Gagal memuat data pangkalan")}finally{setIsLoading(!1)}})()},[]);const handleSave=async formData=>{if(pangkalan){setIsSaving(!0);try{console.log("Updating pangkalan with data:",formData);const updated=await pangkalanApi.update(pangkalan.id,formData);console.log("Update response:",updated),setPangkalan(updated),setIsEditing(!1),toast.success("Data pangkalan berhasil diperbarui")}catch(error){console.error("Failed to update pangkalan:",error);const errorMessage=error?.message||error?.response?.data?.message||"Gagal memperbarui data pangkalan";toast.error(errorMessage)}finally{setIsSaving(!1)}}},handleCancel=()=>{setIsEditing(!1)},handleResetPassword=async()=>{if(!pangkalan||!pangkalan.users||pangkalan.users.length===0){toast.error("Pangkalan ini belum memiliki akun login");return}setIsResettingPassword(!0);try{const token=localStorage.getItem("sim4lon_token"),response=await fetch(`http://localhost:3000/api/users/${pangkalan.users[0].id}/reset-password`,{method:"POST",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}});if(!response.ok)throw new Error("Failed to reset password");const result=await response.json();setNewPassword(result.newPassword),toast.success("Password berhasil direset!")}catch(error){console.error("Failed to reset password:",error),toast.error("Gagal reset password")}finally{setIsResettingPassword(!1)}},handleDelete=async()=>{if(pangkalan){setIsDeleting(!0);try{await pangkalanApi.delete(pangkalan.id),toast.success("Pangkalan berhasil dihapus"),window.location.href="/daftar-pangkalan"}catch(error){console.error("Failed to delete pangkalan:",error);const errorMessage=error?.message||"Gagal menghapus pangkalan";toast.error(errorMessage),setShowDeleteModal(!1)}finally{setIsDeleting(!1)}}},formatDate=dateString=>new Date(dateString).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return isLoading?jsxRuntimeExports.jsxs("div",{className:"flex-1 space-y-6 p-4 sm:p-6 lg:p-8",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3",children:[jsxRuntimeExports.jsx(Skeleton,{className:"h-6 w-48"}),jsxRuntimeExports.jsx(Skeleton,{className:"h-10 w-64"})]}),jsxRuntimeExports.jsx(Skeleton,{className:"h-96 w-full"})]}):pangkalan?jsxRuntimeExports.jsxs("div",{className:"flex-1 space-y-6 p-4 sm:p-6 lg:p-8",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("a",{href:"/daftar-pangkalan",className:"text-muted-foreground hover:text-foreground transition-colors",children:"Pangkalan"}),jsxRuntimeExports.jsx(SafeIcon,{name:"ChevronRight",className:"h-4 w-4 text-muted-foreground"}),jsxRuntimeExports.jsx("span",{className:"text-foreground font-semibold text-lg",children:pangkalan.name})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Detail Pangkalan"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground font-mono text-sm",children:pangkalan.code})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("a",{href:"/daftar-pangkalan",children:jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",className:"gap-1 h-8 px-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"ArrowLeft",className:"h-3.5 w-3.5"}),"Kembali"]})}),jsxRuntimeExports.jsxs(Button,{variant:isEditing?"outline":"ghost",onClick:()=>setIsEditing(!isEditing),size:"sm",className:"gap-1 h-8 px-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:isEditing?"X":"Pencil",className:"h-3.5 w-3.5"}),isEditing?"Batal":"Edit"]}),pangkalan.users&&pangkalan.users.length>0&&jsxRuntimeExports.jsxs(Button,{variant:"ghost",size:"sm",className:"gap-1 h-8 px-2 text-amber-600 hover:text-amber-700 hover:bg-amber-50",onClick:()=>setShowResetPasswordModal(!0),title:"Reset password akun pangkalan",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"KeyRound",className:"h-3.5 w-3.5"}),"Reset Password"]}),jsxRuntimeExports.jsxs(Button,{variant:"ghost",size:"sm",className:"gap-1 h-8 px-2 text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>setShowDeleteModal(!0),title:"Hapus pangkalan (soft delete)",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Trash2",className:"h-3.5 w-3.5"}),"Hapus"]})]})]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-4",children:isEditing?jsxRuntimeExports.jsx(PangkalanEditForm,{pangkalan,onSave:handleSave,onCancel:handleCancel,isSaving}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(PangkalanInfoCard,{pangkalan}),jsxRuntimeExports.jsxs(Card,{children:[jsxRuntimeExports.jsxs(CardHeader,{className:"pb-2",children:[jsxRuntimeExports.jsxs(CardTitle,{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"History",className:"h-5 w-5 text-primary"}),"Riwayat Pesanan"]}),jsxRuntimeExports.jsx(CardDescription,{children:orders.length>0?`${orders.length} pesanan terakhir`:"Belum ada riwayat pesanan"})]}),jsxRuntimeExports.jsx(CardContent,{children:orders.length>0?jsxRuntimeExports.jsxs("div",{className:"w-full",children:[jsxRuntimeExports.jsx("div",{className:"overflow-auto max-h-[480px] border rounded-lg",children:jsxRuntimeExports.jsxs(Table,{children:[jsxRuntimeExports.jsx(TableHeader,{className:"sticky top-0 bg-background z-10",children:jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(TableHead,{className:"min-w-[100px]",children:"Kode"}),jsxRuntimeExports.jsx(TableHead,{className:"min-w-[110px]",children:"Tanggal"}),jsxRuntimeExports.jsx(TableHead,{className:"min-w-[150px]",children:"Item"}),jsxRuntimeExports.jsx(TableHead,{className:"min-w-[130px] text-right",children:"Total"}),jsxRuntimeExports.jsx(TableHead,{className:"min-w-[110px]",children:"Status"}),jsxRuntimeExports.jsx(TableHead,{className:"min-w-[80px]",children:"Aksi"})]})}),jsxRuntimeExports.jsx(TableBody,{children:orders.slice(0,10).map(order=>jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(TableCell,{className:"font-medium font-mono text-primary",children:order.code||`ORD-${order.id.slice(0,4).toUpperCase()}`}),jsxRuntimeExports.jsx(TableCell,{className:"text-foreground text-sm",children:formatDate(order.created_at)}),jsxRuntimeExports.jsx(TableCell,{className:"text-sm",children:order.order_items&&order.order_items.length>0?jsxRuntimeExports.jsx("div",{className:"space-y-0.5",children:order.order_items.map((item,idx)=>jsxRuntimeExports.jsxs("div",{className:"text-foreground",children:[item.label||item.lpg_type," × ",item.qty]},idx))}):"-"}),jsxRuntimeExports.jsx(TableCell,{className:"text-right font-semibold text-foreground",children:formatCurrency(order.total_amount)}),jsxRuntimeExports.jsx(TableCell,{children:jsxRuntimeExports.jsx(Badge,{variant:"status",className:statusColors[order.current_status]||"bg-gray-100 text-gray-700",children:statusLabels[order.current_status]||order.current_status})}),jsxRuntimeExports.jsx(TableCell,{children:jsxRuntimeExports.jsx("a",{href:`/detail-pesanan?id=${order.id}`,children:jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Eye",className:"h-4 w-4"})})})})]},order.id))})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mt-3",children:[jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:["Menampilkan ",Math.min(orders.length,10)," pesanan terbaru"]}),jsxRuntimeExports.jsx("a",{href:`/daftar-pesanan?pangkalan_id=${pangkalan.id}`,children:jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",className:"gap-1",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"List",className:"h-3.5 w-3.5"}),"Lihat Semua Pesanan"]})})]})]}):jsxRuntimeExports.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Package",className:"h-12 w-12 mx-auto mb-3 opacity-50"}),jsxRuntimeExports.jsx("p",{children:"Belum ada pesanan dari pangkalan ini"})]})})]})]})}),jsxRuntimeExports.jsx(ConfirmationModal,{open:showDeleteModal,onOpenChange:setShowDeleteModal,onConfirm:handleDelete,title:"Hapus Pangkalan",description:`Apakah Anda yakin ingin menghapus pangkalan "${pangkalan?.name}"? Tindakan ini tidak dapat dikembalikan!`,confirmText:"Ya, Hapus",cancelText:"Batal",isDangerous:!0,isLoading:isDeleting}),jsxRuntimeExports.jsx(Dialog,{open:showResetPasswordModal,onOpenChange:open=>{setShowResetPasswordModal(open),open||setNewPassword(null)},children:jsxRuntimeExports.jsxs(DialogContent,{className:"max-w-md",children:[jsxRuntimeExports.jsxs(DialogHeader,{children:[jsxRuntimeExports.jsxs(DialogTitle,{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"KeyRound",className:"h-5 w-5 text-amber-600"}),"Reset Password Akun Pangkalan"]}),jsxRuntimeExports.jsx(DialogDescription,{children:newPassword?"Password berhasil direset. Salin dan berikan ke pangkalan.":`Apakah Anda yakin ingin reset password untuk akun "${pangkalan?.users?.[0]?.email}"?`})]}),newPassword?jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-green-800 mb-2",children:"Password Baru:"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Input,{readOnly:!0,value:newPassword,className:"font-mono bg-white"}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",onClick:()=>{navigator.clipboard.writeText(newPassword),toast.success("Password disalin!")},children:jsxRuntimeExports.jsx(SafeIcon,{name:"Copy",className:"h-4 w-4"})})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-green-600 mt-2",children:"⚠️ Simpan password ini, tidak akan bisa dilihat lagi!"})]}),jsxRuntimeExports.jsx(DialogFooter,{children:jsxRuntimeExports.jsx(Button,{onClick:()=>{setShowResetPasswordModal(!1),setNewPassword(null)},children:"Tutup"})})]}):jsxRuntimeExports.jsxs(DialogFooter,{className:"gap-2",children:[jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:()=>setShowResetPasswordModal(!1),children:"Batal"}),jsxRuntimeExports.jsx(Button,{className:"bg-amber-600 hover:bg-amber-700",onClick:handleResetPassword,disabled:isResettingPassword,children:isResettingPassword?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"mr-2 h-4 w-4 animate-spin"}),"Mereset..."]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SafeIcon,{name:"KeyRound",className:"mr-2 h-4 w-4"}),"Reset Password"]})})]})]})})]}):jsxRuntimeExports.jsx("div",{className:"flex-1 p-4 sm:p-6 lg:p-8",children:jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"AlertCircle",className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Pangkalan Tidak Ditemukan"}),jsxRuntimeExports.jsx("p",{className:"text-muted-foreground mb-4",children:"Data pangkalan yang Anda cari tidak ditemukan."}),jsxRuntimeExports.jsx(Button,{asChild:!0,children:jsxRuntimeExports.jsx("a",{href:"/daftar-pangkalan",children:"Kembali ke Daftar Pangkalan"})})]})})}export{DetailEditPangkalanContent as default};
