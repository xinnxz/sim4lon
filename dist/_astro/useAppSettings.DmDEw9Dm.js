import{r as reactExports}from"./index.DcciWILN.js";import{companyProfileApi}from"./api.Dr7hS9Y8.js";const APP_SETTINGS_KEY="app_settings_cache",CACHE_DURATION=300*1e3,defaultSettings={ppnRate:12,criticalStockLimit:10,invoicePrefix:"INV-",orderCodePrefix:"ORD-"};function getCachedSettings(){try{const cached=localStorage.getItem(APP_SETTINGS_KEY);if(!cached)return null;const parsed=JSON.parse(cached);return Date.now()-parsed.timestamp>CACHE_DURATION?null:parsed.settings}catch{return null}}function setCachedSettings(settings){try{const cached={settings,timestamp:Date.now()};localStorage.setItem(APP_SETTINGS_KEY,JSON.stringify(cached))}catch{}}function useAppSettings(){const[settings,setSettings]=reactExports.useState(defaultSettings),[isLoading,setIsLoading]=reactExports.useState(!0),[error,setError]=reactExports.useState(null);return reactExports.useEffect(()=>{(async()=>{const cached=getCachedSettings();if(cached){setSettings(cached),setIsLoading(!1);return}try{setIsLoading(!0);const profile=await companyProfileApi.get(),newSettings={ppnRate:Number(profile.ppn_rate)||defaultSettings.ppnRate,criticalStockLimit:profile.critical_stock_limit||defaultSettings.criticalStockLimit,invoicePrefix:profile.invoice_prefix||defaultSettings.invoicePrefix,orderCodePrefix:profile.order_code_prefix||defaultSettings.orderCodePrefix};setSettings(newSettings),setCachedSettings(newSettings),setError(null)}catch(err){console.error("Failed to fetch app settings:",err),setError("Gagal memuat pengaturan aplikasi"),setSettings(defaultSettings)}finally{setIsLoading(!1)}})()},[]),{settings,isLoading,error,refreshSettings:async()=>{try{localStorage.removeItem(APP_SETTINGS_KEY),setIsLoading(!0);const profile=await companyProfileApi.get(),newSettings={ppnRate:Number(profile.ppn_rate)||defaultSettings.ppnRate,criticalStockLimit:profile.critical_stock_limit||defaultSettings.criticalStockLimit,invoicePrefix:profile.invoice_prefix||defaultSettings.invoicePrefix,orderCodePrefix:profile.order_code_prefix||defaultSettings.orderCodePrefix};setSettings(newSettings),setCachedSettings(newSettings),setError(null)}catch(err){console.error("Failed to refresh settings:",err),setError("Gagal memuat pengaturan")}finally{setIsLoading(!1)}}}}function clearAppSettingsCache(){localStorage.removeItem(APP_SETTINGS_KEY)}export{clearAppSettingsCache as c,useAppSettings as u};
