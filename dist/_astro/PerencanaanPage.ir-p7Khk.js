import{j as jsxRuntimeExports}from"./jsx-runtime.mvtouYz0.js";import{r as reactExports}from"./index.DcciWILN.js";import{C as Card,a as CardContent,b as CardHeader,c as CardTitle}from"./card.D0gylVsf.js";import{u as useComposedRefs,c as cn,g as buttonVariants,S as SafeIcon,B as Button}from"./SafeIcon.CAGsavDo.js";import{I as Input}from"./input.C9ryBhC0.js";import{S as Select,a as SelectTrigger,b as SelectValue,c as SelectContent,d as SelectItem}from"./select.Dd50uIHU.js";import{B as Badge}from"./badge.DZiJ6zSB.js";import{T as Tabs,a as TabsList,b as TabsTrigger,c as TabsContent}from"./tabs.BmAU3oNV.js";import{c as createContextScope,a as composeEventHandlers}from"./index.BpQ989z7.js";import{c as createDialogScope,O as Overlay,P as Portal,W as WarningProvider,C as Content,T as Title,D as Description,a as Close,R as Root,b as Trigger}from"./index.zVS-qTD4.js";import{D as DropdownMenu,a as DropdownMenuTrigger,b as DropdownMenuContent,c as DropdownMenuItem}from"./dropdown-menu.CyUKnKxT.js";import{D as Dialog,a as DialogContent,b as DialogHeader,c as DialogTitle,f as DialogFooter}from"./dialog.CoJQQKDV.js";import{L as Label}from"./label.BFF1cpbq.js";import{lpgProductsApi,perencanaanApi}from"./api.Dr7hS9Y8.js";import{t as toast}from"./index.fAd_ikgp.js";import{A as AnimatedNumber}from"./AnimatedNumber.DkDF6dXY.js";import{P as PageHeader}from"./PageHeader.ChFr_oMu.js";import{g as getAgenProfileFromAPI,e as exportPertaminaPDF,a as exportPertaminaExcel}from"./pertamina-export.CDr19N9R.js";import"./index.PIAPtHoh.js";import"./index.ubNQCTBn.js";import"./index.DGt6JTY0.js";import"./index.BStXkqMp.js";import"./index.Drh0kMGk.js";import"./index.DZiLsHox.js";import"./index.Dovp0-D8.js";import"./index.YpXgcoRz.js";import"./index.BFpcrWlj.js";import"./index.9MihlNbL.js";import"./index.BhA3i5Wo.js";import"./index.BaF2FVWY.js";import"./chevron-up.BBBXIirx.js";import"./check.TUgVKQyo.js";import"./index.DQDOfy24.js";import"./index.CdmyERTi.js";import"./chevron-right.oaN48PMp.js";import"./x.DUlMVzh7.js";import"./jspdf.plugin.autotable.tHrVzh7j.js";import"./logo-pertamina.CveLq9KN.js";var SLOTTABLE_IDENTIFIER=Symbol("radix.slottable");function createSlottable(ownerName){const Slottable2=({children})=>jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children});return Slottable2.displayName=`${ownerName}.Slottable`,Slottable2.__radixId=SLOTTABLE_IDENTIFIER,Slottable2}var ROOT_NAME="AlertDialog",[createAlertDialogContext]=createContextScope(ROOT_NAME,[createDialogScope]),useDialogScope=createDialogScope(),AlertDialog$1=props=>{const{__scopeAlertDialog,...alertDialogProps}=props,dialogScope=useDialogScope(__scopeAlertDialog);return jsxRuntimeExports.jsx(Root,{...dialogScope,...alertDialogProps,modal:!0})};AlertDialog$1.displayName=ROOT_NAME;var TRIGGER_NAME="AlertDialogTrigger",AlertDialogTrigger$1=reactExports.forwardRef((props,forwardedRef)=>{const{__scopeAlertDialog,...triggerProps}=props,dialogScope=useDialogScope(__scopeAlertDialog);return jsxRuntimeExports.jsx(Trigger,{...dialogScope,...triggerProps,ref:forwardedRef})});AlertDialogTrigger$1.displayName=TRIGGER_NAME;var PORTAL_NAME="AlertDialogPortal",AlertDialogPortal$1=props=>{const{__scopeAlertDialog,...portalProps}=props,dialogScope=useDialogScope(__scopeAlertDialog);return jsxRuntimeExports.jsx(Portal,{...dialogScope,...portalProps})};AlertDialogPortal$1.displayName=PORTAL_NAME;var OVERLAY_NAME="AlertDialogOverlay",AlertDialogOverlay$1=reactExports.forwardRef((props,forwardedRef)=>{const{__scopeAlertDialog,...overlayProps}=props,dialogScope=useDialogScope(__scopeAlertDialog);return jsxRuntimeExports.jsx(Overlay,{...dialogScope,...overlayProps,ref:forwardedRef})});AlertDialogOverlay$1.displayName=OVERLAY_NAME;var CONTENT_NAME="AlertDialogContent",[AlertDialogContentProvider,useAlertDialogContentContext]=createAlertDialogContext(CONTENT_NAME),Slottable=createSlottable("AlertDialogContent"),AlertDialogContent$1=reactExports.forwardRef((props,forwardedRef)=>{const{__scopeAlertDialog,children,...contentProps}=props,dialogScope=useDialogScope(__scopeAlertDialog),contentRef=reactExports.useRef(null),composedRefs=useComposedRefs(forwardedRef,contentRef),cancelRef=reactExports.useRef(null);return jsxRuntimeExports.jsx(WarningProvider,{contentName:CONTENT_NAME,titleName:TITLE_NAME,docsSlug:"alert-dialog",children:jsxRuntimeExports.jsx(AlertDialogContentProvider,{scope:__scopeAlertDialog,cancelRef,children:jsxRuntimeExports.jsxs(Content,{role:"alertdialog",...dialogScope,...contentProps,ref:composedRefs,onOpenAutoFocus:composeEventHandlers(contentProps.onOpenAutoFocus,event=>{event.preventDefault(),cancelRef.current?.focus({preventScroll:!0})}),onPointerDownOutside:event=>event.preventDefault(),onInteractOutside:event=>event.preventDefault(),children:[jsxRuntimeExports.jsx(Slottable,{children}),jsxRuntimeExports.jsx(DescriptionWarning,{contentRef})]})})})});AlertDialogContent$1.displayName=CONTENT_NAME;var TITLE_NAME="AlertDialogTitle",AlertDialogTitle$1=reactExports.forwardRef((props,forwardedRef)=>{const{__scopeAlertDialog,...titleProps}=props,dialogScope=useDialogScope(__scopeAlertDialog);return jsxRuntimeExports.jsx(Title,{...dialogScope,...titleProps,ref:forwardedRef})});AlertDialogTitle$1.displayName=TITLE_NAME;var DESCRIPTION_NAME="AlertDialogDescription",AlertDialogDescription$1=reactExports.forwardRef((props,forwardedRef)=>{const{__scopeAlertDialog,...descriptionProps}=props,dialogScope=useDialogScope(__scopeAlertDialog);return jsxRuntimeExports.jsx(Description,{...dialogScope,...descriptionProps,ref:forwardedRef})});AlertDialogDescription$1.displayName=DESCRIPTION_NAME;var ACTION_NAME="AlertDialogAction",AlertDialogAction$1=reactExports.forwardRef((props,forwardedRef)=>{const{__scopeAlertDialog,...actionProps}=props,dialogScope=useDialogScope(__scopeAlertDialog);return jsxRuntimeExports.jsx(Close,{...dialogScope,...actionProps,ref:forwardedRef})});AlertDialogAction$1.displayName=ACTION_NAME;var CANCEL_NAME="AlertDialogCancel",AlertDialogCancel$1=reactExports.forwardRef((props,forwardedRef)=>{const{__scopeAlertDialog,...cancelProps}=props,{cancelRef}=useAlertDialogContentContext(CANCEL_NAME,__scopeAlertDialog),dialogScope=useDialogScope(__scopeAlertDialog),ref=useComposedRefs(forwardedRef,cancelRef);return jsxRuntimeExports.jsx(Close,{...dialogScope,...cancelProps,ref})});AlertDialogCancel$1.displayName=CANCEL_NAME;var DescriptionWarning=({contentRef})=>{const MESSAGE=`\`${CONTENT_NAME}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${CONTENT_NAME}\` by passing a \`${DESCRIPTION_NAME}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${CONTENT_NAME}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return reactExports.useEffect(()=>{document.getElementById(contentRef.current?.getAttribute("aria-describedby"))||console.warn(MESSAGE)},[MESSAGE,contentRef]),null},Root2=AlertDialog$1,Trigger2=AlertDialogTrigger$1,Portal2=AlertDialogPortal$1,Overlay2=AlertDialogOverlay$1,Content2=AlertDialogContent$1,Action=AlertDialogAction$1,Cancel=AlertDialogCancel$1,Title2=AlertDialogTitle$1,Description2=AlertDialogDescription$1;const AlertDialog=Root2,AlertDialogTrigger=Trigger2,AlertDialogPortal=Portal2,AlertDialogOverlay=reactExports.forwardRef(({className,...props},ref)=>jsxRuntimeExports.jsx(Overlay2,{className:cn("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",className),...props,ref}));AlertDialogOverlay.displayName=Overlay2.displayName;const AlertDialogContent=reactExports.forwardRef(({className,...props},ref)=>jsxRuntimeExports.jsxs(AlertDialogPortal,{children:[jsxRuntimeExports.jsx(AlertDialogOverlay,{}),jsxRuntimeExports.jsx(Content2,{ref,className:cn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",className),...props})]}));AlertDialogContent.displayName=Content2.displayName;const AlertDialogHeader=({className,...props})=>jsxRuntimeExports.jsx("div",{className:cn("flex flex-col space-y-2 text-center sm:text-left",className),...props});AlertDialogHeader.displayName="AlertDialogHeader";const AlertDialogFooter=({className,...props})=>jsxRuntimeExports.jsx("div",{className:cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",className),...props});AlertDialogFooter.displayName="AlertDialogFooter";const AlertDialogTitle=reactExports.forwardRef(({className,...props},ref)=>jsxRuntimeExports.jsx(Title2,{ref,className:cn("text-lg font-semibold",className),...props}));AlertDialogTitle.displayName=Title2.displayName;const AlertDialogDescription=reactExports.forwardRef(({className,...props},ref)=>jsxRuntimeExports.jsx(Description2,{ref,className:cn("text-sm text-muted-foreground",className),...props}));AlertDialogDescription.displayName=Description2.displayName;const AlertDialogAction=reactExports.forwardRef(({className,...props},ref)=>jsxRuntimeExports.jsx(Action,{ref,className:cn(buttonVariants(),className),...props}));AlertDialogAction.displayName=Action.displayName;const AlertDialogCancel=reactExports.forwardRef(({className,...props},ref)=>jsxRuntimeExports.jsx(Cancel,{ref,className:cn(buttonVariants({variant:"outline"}),"mt-2 sm:mt-0",className),...props}));AlertDialogCancel.displayName=Cancel.displayName;function PerencanaanPage(){const getInitialTab=()=>{if(typeof window<"u"){const hash=window.location.hash.replace("#","");if(["form","rekapitulasi"].includes(hash))return hash}return"rekapitulasi"},[activeTab,setActiveTab]=reactExports.useState(getInitialTab),handleTabChange=value=>{setActiveTab(value),typeof window<"u"&&window.history.replaceState(null,"",`#${value}`)},[selectedMonth,setSelectedMonth]=reactExports.useState(()=>{const now=new Date;return`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,"0")}`}),[kondisi,setKondisi]=reactExports.useState("ALL"),[tipePembayaran,setTipePembayaran]=reactExports.useState("ALL"),[selectedLpgType,setSelectedLpgType]=reactExports.useState("kg3"),[rekapData,setRekapData]=reactExports.useState(null),[lpgProducts,setLpgProducts]=reactExports.useState([]),[isLoading,setIsLoading]=reactExports.useState(!1),[isGenerating,setIsGenerating]=reactExports.useState(!1),[showGenerateDialog,setShowGenerateDialog]=reactExports.useState(!1),[generateOverwrite,setGenerateOverwrite]=reactExports.useState(!1),[editedCells,setEditedCells]=reactExports.useState({}),[isSaving,setIsSaving]=reactExports.useState(!1),[showEditModal,setShowEditModal]=reactExports.useState(!1),[editModalData,setEditModalData]=reactExports.useState(null),fetchLpgProducts=async()=>{try{const products=await lpgProductsApi.getAll();setLpgProducts(products.filter(p=>p.is_active))}catch(error){console.error("Error fetching LPG products:",error),setLpgProducts([])}},lpgTypeOptions=reactExports.useMemo(()=>{const sizeToLpgType=size=>size===.22||size===.22?"gr220":size===3?"kg3":size===5.5?"kg5":size===12?"kg12":size===50?"kg50":`kg${Math.floor(size)}`;if(lpgProducts.length>0){const subsidiTypes=lpgProducts.filter(p=>p.category==="SUBSIDI").map(p=>({value:sizeToLpgType(Number(p.size_kg)),label:p.name,description:"Subsidi"}));return subsidiTypes.length>0?subsidiTypes:[{value:"kg3",label:"LPG 3 KG",description:"Subsidi"}]}return[{value:"kg3",label:"LPG 3 KG",description:"Subsidi"}]},[lpgProducts]);reactExports.useEffect(()=>{lpgTypeOptions.length>0&&!lpgTypeOptions.find(o=>o.value===selectedLpgType)&&setSelectedLpgType(lpgTypeOptions[0].value)},[lpgTypeOptions]);const fetchRekapitulasi=async()=>{setIsLoading(!0);try{const data=await perencanaanApi.getRekapitulasi(selectedMonth,kondisi!=="ALL"?kondisi:void 0,selectedLpgType);setRekapData(data)}catch(error){console.error("Error fetching rekapitulasi:",error),setRekapData({bulan:selectedMonth,days_in_month:new Date(parseInt(selectedMonth.split("-")[0]),parseInt(selectedMonth.split("-")[1]),0).getDate(),data:[]}),error instanceof Error&&!error.message.includes("404")&&toast.error("Gagal memuat data rekapitulasi")}finally{setIsLoading(!1)}},handleAutoGenerate=async()=>{setShowGenerateDialog(!1),setIsGenerating(!0);try{const result=await perencanaanApi.autoGenerate({bulan:selectedMonth,lpg_type:selectedLpgType,kondisi:kondisi!=="ALL"?kondisi:"NORMAL",overwrite:generateOverwrite});toast.success(result.message,{description:`${result.details.created_records} entries dibuat untuk ${result.details.total_pangkalan-result.details.skipped_no_alokasi} pangkalan`}),fetchRekapitulasi(),setGenerateOverwrite(!1)}catch{toast.error("Gagal generate perencanaan otomatis")}finally{setIsGenerating(!1)}};reactExports.useEffect(()=>{fetchLpgProducts()},[]);const openEditModal=(pangkalanId,pangkalanName,day,originalValue)=>{const[year,month]=selectedMonth.split("-").map(Number),tanggal=new Date(Date.UTC(year,month-1,day,12,0,0)).toISOString().split("T")[0],key=`${pangkalanId}_${tanggal}`,existing=editedCells[key];setEditModalData({pangkalanId,pangkalanName,day,tanggal,normal:existing?.normal??originalValue,fakultatif:existing?.fakultatif??0}),setShowEditModal(!0)},handleModalSave=()=>{if(!editModalData)return;const key=`${editModalData.pangkalanId}_${editModalData.tanggal}`;setEditedCells(prev=>({...prev,[key]:{normal:editModalData.normal,fakultatif:editModalData.fakultatif}})),setShowEditModal(!1),setEditModalData(null)},handleRemoveEdit=()=>{if(!editModalData)return;const key=`${editModalData.pangkalanId}_${editModalData.tanggal}`;setEditedCells(prev=>{const newCells={...prev};return delete newCells[key],newCells}),setShowEditModal(!1),setEditModalData(null)},isCellEdited=(pangkalanId,day)=>{const[year,month]=selectedMonth.split("-").map(Number),tanggal=new Date(Date.UTC(year,month-1,day,12,0,0)).toISOString().split("T")[0];return`${pangkalanId}_${tanggal}`in editedCells},getEditedValue=(pangkalanId,day,original)=>{const[year,month]=selectedMonth.split("-").map(Number),tanggal=new Date(Date.UTC(year,month-1,day,12,0,0)).toISOString().split("T")[0],key=`${pangkalanId}_${tanggal}`;return key in editedCells?editedCells[key].normal+editedCells[key].fakultatif:original},getEditedCell=(pangkalanId,day)=>{const[year,month]=selectedMonth.split("-").map(Number),tanggal=new Date(Date.UTC(year,month-1,day,12,0,0)).toISOString().split("T")[0],key=`${pangkalanId}_${tanggal}`;return editedCells[key]||null},handleSaveChanges=async()=>{const keys=Object.keys(editedCells);if(keys.length!==0){setIsSaving(!0);try{const updates={};for(const key of keys){const[pangkalanId,tanggal]=key.split("_");updates[pangkalanId]||(updates[pangkalanId]=[]);const cellData=editedCells[key];updates[pangkalanId].push({tanggal,jumlah:cellData.normal+cellData.fakultatif,jumlah_normal:cellData.normal,jumlah_fakultatif:cellData.fakultatif})}for(const[pangkalanId,data]of Object.entries(updates))await perencanaanApi.bulkUpdate({pangkalan_id:pangkalanId,tanggal_awal:data[0].tanggal,tanggal_akhir:data[data.length-1].tanggal,data:data.map(d=>({tanggal:d.tanggal,jumlah:d.jumlah,jumlah_normal:d.jumlah_normal,jumlah_fakultatif:d.jumlah_fakultatif}))});toast.success(`${keys.length} perubahan berhasil disimpan`),setEditedCells({}),fetchRekapitulasi()}catch(error){toast.error(error.message||"Gagal menyimpan perubahan")}finally{setIsSaving(!1)}}};reactExports.useEffect(()=>{fetchRekapitulasi()},[selectedMonth,kondisi,selectedLpgType]);const handleDownloadPDF=async()=>{if(!rekapData||rekapData.data.length===0){toast.error("Tidak ada data untuk di-download");return}try{toast.loading("Generating PDF...",{id:"pdf-export"});const exportData=(computedRekapData?.data||rekapData.data).map(row=>({id_registrasi:row.id_registrasi,nama_pangkalan:row.nama_pangkalan,alokasi:row.alokasi,daily:row.daily,total_normal:row.total_normal,total_fakultatif:row.total_fakultatif,sisa_alokasi:row.sisa_alokasi,grand_total:row.grand_total})),agenProfile=await getAgenProfileFromAPI();await exportPertaminaPDF({bulan:selectedMonth,data:exportData,daysInMonth,agenProfile,tipe:"perencanaan",lpgType:selectedLpgType,category:"SUBSIDI"}),toast.success("PDF berhasil di-download!",{id:"pdf-export"})}catch(error){console.error("PDF export error:",error),toast.error("Gagal export PDF",{id:"pdf-export"})}},handleDownloadExcel=async()=>{if(!rekapData||rekapData.data.length===0){toast.error("Tidak ada data untuk di-download");return}try{toast.loading("Generating Excel...",{id:"excel-export"});const exportData=(computedRekapData?.data||rekapData.data).map(row=>({id_registrasi:row.id_registrasi,nama_pangkalan:row.nama_pangkalan,alokasi:row.alokasi,daily:row.daily,total_normal:row.total_normal,total_fakultatif:row.total_fakultatif,sisa_alokasi:row.sisa_alokasi,grand_total:row.grand_total})),agenProfile=await getAgenProfileFromAPI();await exportPertaminaExcel({bulan:selectedMonth,data:exportData,daysInMonth,agenProfile,tipe:"perencanaan",lpgType:selectedLpgType,category:"SUBSIDI"}),toast.success("Excel berhasil di-download!",{id:"excel-export"})}catch(error){console.error("Excel export error:",error),toast.error("Gagal export Excel",{id:"excel-export"})}},{dayHeaders,isCurrentMonth,today,daysInMonth}=reactExports.useMemo(()=>{const[year,month]=selectedMonth.split("-").map(Number),_daysInMonth=new Date(year,month,0).getDate(),now=new Date,_isCurrentMonth=now.getFullYear()===year&&now.getMonth()===month-1,_today=now.getDate(),dayNames=["Min","Sen","Sel","Rab","Kam","Jum","Sab"],headers=[];for(let d=1;d<=_daysInMonth;d++){const dayOfWeek=new Date(year,month-1,d).getDay();headers.push({day:d,dayName:dayNames[dayOfWeek],isSunday:dayOfWeek===0})}return{dayHeaders:headers,isCurrentMonth:_isCurrentMonth,today:_today,daysInMonth:_daysInMonth}},[selectedMonth]),computedRekapData=reactExports.useMemo(()=>rekapData?{...rekapData,data:rekapData.data.map(row=>{let totalNormal=row.total_normal||0,totalFakultatif=row.total_fakultatif||0;for(const dayInfo of dayHeaders){const[year,month]=selectedMonth.split("-").map(Number),tanggal=new Date(Date.UTC(year,month-1,dayInfo.day,12,0,0)).toISOString().split("T")[0],key=`${row.pangkalan_id}_${tanggal}`,editedCell=editedCells[key];if(editedCell){const originalValue=row.daily[dayInfo.day]||0;totalNormal-=originalValue,totalNormal+=editedCell.normal,totalFakultatif+=editedCell.fakultatif}}const grandTotal=totalNormal+totalFakultatif,sisaAlokasi=row.alokasi-grandTotal;return{...row,total_normal:totalNormal,total_fakultatif:totalFakultatif,sisa_alokasi:sisaAlokasi,grand_total:grandTotal}})}:null,[rekapData,editedCells,dayHeaders,selectedMonth]),tableScrollRef=reactExports.useRef(null);reactExports.useEffect(()=>{const container=tableScrollRef.current;if(!container)return;const handleWheel=e=>{if(e.deltaY===0)return;const atLeftEdge=container.scrollLeft<=0,atRightEdge=container.scrollLeft>=container.scrollWidth-container.clientWidth-1,scrollingUp=e.deltaY<0,scrollingDown=e.deltaY>0;atLeftEdge&&scrollingUp||atRightEdge&&scrollingDown||(e.preventDefault(),e.stopPropagation(),container.scrollLeft+=e.deltaY)};return container.addEventListener("wheel",handleWheel,{passive:!1}),()=>container.removeEventListener("wheel",handleWheel)},[]);const monthOptions=reactExports.useMemo(()=>{const options=[],now=new Date;for(let i=0;i<12;i++){const date=new Date(now.getFullYear(),now.getMonth()-i,1),value=`${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,"0")}`,label=date.toLocaleDateString("id-ID",{month:"long",year:"numeric"});options.push({value,label})}return options},[]),summaryStats=reactExports.useMemo(()=>{const data=computedRekapData?.data||rekapData?.data||[];if(data.length===0)return{totalPangkalan:0,totalAlokasi:0,totalRealisasi:0,sisaAlokasi:0,overAlokasi:0,nearLimit:0};const overAlokasi=data.filter(r=>r.sisa_alokasi<0).length;return{totalPangkalan:data.length,totalAlokasi:data.reduce((sum,r)=>sum+r.alokasi,0),totalRealisasi:data.reduce((sum,r)=>sum+r.total_normal+r.total_fakultatif,0),sisaAlokasi:data.reduce((sum,r)=>sum+r.sisa_alokasi,0),overAlokasi,nearLimit:0}},[computedRekapData,rekapData]);return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx(PageHeader,{title:"Perencanaan",subtitle:"Kelola perencanaan distribusi LPG bulanan ke pangkalan"}),jsxRuntimeExports.jsxs(Tabs,{value:activeTab,onValueChange:handleTabChange,children:[jsxRuntimeExports.jsxs(TabsList,{className:"glass-card p-1 mb-4",children:[jsxRuntimeExports.jsxs(TabsTrigger,{value:"rekapitulasi",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-cyan-500 data-[state=active]:text-white",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Table",className:"w-4 h-4 mr-2"}),"Rekapitulasi"]}),jsxRuntimeExports.jsxs(TabsTrigger,{value:"form",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-cyan-500 data-[state=active]:text-white",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Edit",className:"w-4 h-4 mr-2"}),"Input Form"]})]}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:lpgTypeOptions.map(opt=>jsxRuntimeExports.jsxs(Button,{variant:selectedLpgType===opt.value?"default":"outline",size:"sm",className:selectedLpgType===opt.value?"bg-gradient-to-r from-emerald-500 to-teal-500 text-white border-0":"hover:bg-emerald-50 dark:hover:bg-emerald-900/20",onClick:()=>setSelectedLpgType(opt.value),children:[opt.label,jsxRuntimeExports.jsxs("span",{className:"ml-1 text-xs opacity-70",children:["(",opt.description,")"]})]},opt.value))}),jsxRuntimeExports.jsx(Card,{className:"glass-card mb-6",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Bulan:"}),jsxRuntimeExports.jsxs(Select,{value:selectedMonth,onValueChange:setSelectedMonth,children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"w-44",children:jsxRuntimeExports.jsx(SelectValue,{})}),jsxRuntimeExports.jsx(SelectContent,{children:monthOptions.map(opt=>jsxRuntimeExports.jsx(SelectItem,{value:opt.value,children:opt.label},opt.value))})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Kondisi:"}),jsxRuntimeExports.jsxs(Select,{value:kondisi,onValueChange:setKondisi,children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"w-32",children:jsxRuntimeExports.jsx(SelectValue,{})}),jsxRuntimeExports.jsxs(SelectContent,{children:[jsxRuntimeExports.jsx(SelectItem,{value:"ALL",children:"Semua"}),jsxRuntimeExports.jsx(SelectItem,{value:"NORMAL",children:"Normal"}),jsxRuntimeExports.jsx(SelectItem,{value:"FAKULTATIF",children:"Fakultatif"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Tipe:"}),jsxRuntimeExports.jsxs(Select,{value:tipePembayaran,onValueChange:setTipePembayaran,children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"w-28",children:jsxRuntimeExports.jsx(SelectValue,{})}),jsxRuntimeExports.jsxs(SelectContent,{children:[jsxRuntimeExports.jsx(SelectItem,{value:"ALL",children:"Semua"}),jsxRuntimeExports.jsx(SelectItem,{value:"CASHLESS",children:"Cashless"}),jsxRuntimeExports.jsx(SelectItem,{value:"CASH",children:"Cash"})]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 sm:ml-auto",children:[jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",onClick:fetchRekapitulasi,disabled:isLoading,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"RefreshCw",className:`w-4 h-4 mr-1 ${isLoading?"animate-spin":""}`}),"Refresh"]}),jsxRuntimeExports.jsxs(AlertDialog,{open:showGenerateDialog,onOpenChange:setShowGenerateDialog,children:[jsxRuntimeExports.jsx(AlertDialogTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{variant:"default",size:"sm",disabled:isGenerating,className:"bg-gradient-to-r from-blue-500 to-cyan-500 text-white",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Wand2",className:`w-4 h-4 mr-1 ${isGenerating?"animate-spin":""}`}),isGenerating?"Generating...":"Generate Otomatis"]})}),jsxRuntimeExports.jsxs(AlertDialogContent,{children:[jsxRuntimeExports.jsxs(AlertDialogHeader,{children:[jsxRuntimeExports.jsx(AlertDialogTitle,{children:"Generate Perencanaan Otomatis"}),jsxRuntimeExports.jsxs(AlertDialogDescription,{className:"space-y-3",children:[jsxRuntimeExports.jsxs("p",{children:["Generate perencanaan otomatis untuk bulan ",jsxRuntimeExports.jsx("strong",{children:selectedMonth}),"?"]}),jsxRuntimeExports.jsx("p",{children:"Ini akan membuat rencana harian berdasarkan alokasi bulanan setiap pangkalan."}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted rounded-lg",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",id:"overwrite-checkbox",checked:generateOverwrite,onChange:e=>setGenerateOverwrite(e.target.checked),className:"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),jsxRuntimeExports.jsx("label",{htmlFor:"overwrite-checkbox",className:"text-sm font-medium cursor-pointer",children:"Timpa data yang sudah ada"})]}),generateOverwrite?jsxRuntimeExports.jsx("p",{className:"text-red-500 text-sm",children:"⚠️ Data yang sudah ada AKAN DITIMPA. Data lama akan dihapus."}):jsxRuntimeExports.jsx("p",{className:"text-amber-500 text-sm",children:"ℹ️ Data yang sudah ada TIDAK akan ditimpa."})]})]}),jsxRuntimeExports.jsxs(AlertDialogFooter,{children:[jsxRuntimeExports.jsx(AlertDialogCancel,{onClick:()=>setGenerateOverwrite(!1),children:"Batal"}),jsxRuntimeExports.jsx(AlertDialogAction,{onClick:handleAutoGenerate,children:"Generate"})]})]})]}),jsxRuntimeExports.jsxs(DropdownMenu,{children:[jsxRuntimeExports.jsx(DropdownMenuTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Download",className:"w-4 h-4 mr-1"}),"Download",jsxRuntimeExports.jsx(SafeIcon,{name:"ChevronDown",className:"w-3 h-3 ml-1"})]})}),jsxRuntimeExports.jsxs(DropdownMenuContent,{align:"end",children:[jsxRuntimeExports.jsxs(DropdownMenuItem,{onClick:handleDownloadPDF,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"FileText",className:"w-4 h-4 mr-2"}),"Download PDF"]}),jsxRuntimeExports.jsxs(DropdownMenuItem,{onClick:handleDownloadExcel,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"FileSpreadsheet",className:"w-4 h-4 mr-2"}),"Download Excel"]})]})]})]})]})})}),jsxRuntimeExports.jsxs(TabsContent,{value:"rekapitulasi",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6",children:[jsxRuntimeExports.jsx(Card,{className:"glass-card",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"p-2 rounded-xl bg-blue-500/10",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Building2",className:"w-5 h-5 text-blue-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Pangkalan"}),jsxRuntimeExports.jsx("p",{className:"text-xl font-bold",children:jsxRuntimeExports.jsx(AnimatedNumber,{value:summaryStats.totalPangkalan,delay:100})})]})]})})}),jsxRuntimeExports.jsx(Card,{className:"glass-card",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"p-2 rounded-xl bg-green-500/10",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Target",className:"w-5 h-5 text-green-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Alokasi"}),jsxRuntimeExports.jsx("p",{className:"text-xl font-bold",children:jsxRuntimeExports.jsx(AnimatedNumber,{value:summaryStats.totalAlokasi,delay:200})})]})]})})}),jsxRuntimeExports.jsx(Card,{className:"glass-card",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"p-2 rounded-xl bg-purple-500/10",children:jsxRuntimeExports.jsx(SafeIcon,{name:"TrendingUp",className:"w-5 h-5 text-purple-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Realisasi"}),jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-purple-600",children:jsxRuntimeExports.jsx(AnimatedNumber,{value:summaryStats.totalRealisasi,delay:300})})]})]})})}),jsxRuntimeExports.jsx(Card,{className:"glass-card",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"p-2 rounded-xl bg-orange-500/10",children:jsxRuntimeExports.jsx(SafeIcon,{name:"AlertCircle",className:"w-5 h-5 text-orange-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Sisa Alokasi"}),jsxRuntimeExports.jsx("p",{className:`text-xl font-bold ${summaryStats.sisaAlokasi<0?"text-red-500":"text-orange-600"}`,children:jsxRuntimeExports.jsx(AnimatedNumber,{value:summaryStats.sisaAlokasi,delay:400})})]})]})})}),jsxRuntimeExports.jsx(Card,{className:`glass-card ${summaryStats.overAlokasi>0?"border-red-500/50 bg-red-500/5":summaryStats.nearLimit>0?"border-yellow-500/50 bg-yellow-500/5":""}`,children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`p-2 rounded-xl ${summaryStats.overAlokasi>0?"bg-red-500/20":"bg-yellow-500/10"}`,children:jsxRuntimeExports.jsx(SafeIcon,{name:"AlertTriangle",className:`w-5 h-5 ${summaryStats.overAlokasi>0?"text-red-500":"text-yellow-500"}`})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Status Alokasi"}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:summaryStats.overAlokasi>0?jsxRuntimeExports.jsxs("span",{className:"text-sm font-bold text-red-500",children:["⚠️ ",summaryStats.overAlokasi," Over"]}):jsxRuntimeExports.jsx("span",{className:"text-sm font-bold text-green-500",children:"✅ Aman"})})]})]})})})]}),jsxRuntimeExports.jsxs(Card,{className:"chart-card-premium",children:[jsxRuntimeExports.jsx(CardHeader,{className:"border-b border-border/50 pb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500 animate-pulse"}),jsxRuntimeExports.jsx(CardTitle,{className:"text-lg font-semibold",children:"Rekapitulasi Perencanaan"}),jsxRuntimeExports.jsxs(Badge,{variant:"outline",className:"ml-auto",children:[rekapData?.data.length||0," Pangkalan"]})]})}),jsxRuntimeExports.jsx(CardContent,{className:"p-0",children:jsxRuntimeExports.jsx("div",{ref:tableScrollRef,className:"overflow-x-auto scrollbar-thin-auto",style:{scrollBehavior:"auto"},children:jsxRuntimeExports.jsxs("table",{className:"w-full text-sm",children:[jsxRuntimeExports.jsx("thead",{className:"bg-muted/50 sticky top-0 z-20",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"sticky left-0 z-30 bg-muted px-3 py-3 text-left font-medium min-w-[120px] shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:"ID Registrasi"}),jsxRuntimeExports.jsx("th",{className:"sticky left-[120px] z-30 bg-muted px-3 py-3 text-left font-medium min-w-[180px] shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:"Nama Pangkalan"}),jsxRuntimeExports.jsx("th",{className:"px-3 py-3 text-center font-medium min-w-[60px]",children:"Status"}),jsxRuntimeExports.jsx("th",{className:"px-3 py-3 text-center font-medium min-w-[70px]",children:"Alokasi"}),dayHeaders.map(dayInfo=>{const weekClass=dayInfo.isSunday?"bg-red-100 dark:bg-red-900/30":"",todayClass=isCurrentMonth&&dayInfo.day===today?"bg-primary/20 text-primary font-bold":"";return jsxRuntimeExports.jsxs("th",{className:`px-2 py-2 text-center font-medium min-w-[45px] ${weekClass} ${todayClass}`,children:[jsxRuntimeExports.jsx("div",{className:"text-xs",children:String(dayInfo.day).padStart(2,"0")}),jsxRuntimeExports.jsx("div",{className:`text-[10px] ${dayInfo.isSunday?"text-red-500":"text-muted-foreground"}`,children:dayInfo.dayName})]},dayInfo.day)}),jsxRuntimeExports.jsx("th",{className:"px-3 py-3 text-center font-medium bg-green-500/10 min-w-[80px]",children:"Total Normal"}),jsxRuntimeExports.jsx("th",{className:"px-3 py-3 text-center font-medium bg-blue-500/10 min-w-[80px]",children:"Total Fakultatif"}),jsxRuntimeExports.jsx("th",{className:"px-3 py-3 text-center font-medium bg-orange-500/10 min-w-[80px]",children:"Sisa Alokasi"}),jsxRuntimeExports.jsx("th",{className:"px-3 py-3 text-center font-medium bg-purple-500/10 min-w-[80px]",children:"Grand Total"})]})}),jsxRuntimeExports.jsx("tbody",{children:isLoading?jsxRuntimeExports.jsx("tr",{children:jsxRuntimeExports.jsxs("td",{colSpan:dayHeaders.length+8,className:"text-center py-8",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"w-6 h-6 animate-spin mx-auto mb-2"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Memuat data..."})]})}):rekapData?.data.length===0?jsxRuntimeExports.jsx("tr",{children:jsxRuntimeExports.jsx("td",{colSpan:dayHeaders.length+8,className:"text-center py-8 text-muted-foreground",children:"Tidak ada data"})}):(computedRekapData?.data||[]).map((row,idx)=>jsxRuntimeExports.jsxs("tr",{className:"border-b border-border/30 hover:bg-muted/30 transition-colors",children:[jsxRuntimeExports.jsx("td",{className:"sticky left-0 z-10 bg-background px-3 py-2 font-mono text-xs shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:row.id_registrasi}),jsxRuntimeExports.jsx("td",{className:"sticky left-[120px] z-10 bg-background px-3 py-2 font-medium shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:row.nama_pangkalan}),jsxRuntimeExports.jsx("td",{className:"px-3 py-2 text-center",children:jsxRuntimeExports.jsx(Badge,{variant:"outline",className:"bg-green-500/10 text-green-600 border-green-500/30 text-xs",children:row.status})}),jsxRuntimeExports.jsx("td",{className:"px-3 py-2 text-center font-medium",children:row.alokasi.toLocaleString()}),dayHeaders.map(dayInfo=>{const value=getEditedValue(row.pangkalan_id,dayInfo.day,row.daily[dayInfo.day]||0),isEdited=isCellEdited(row.pangkalan_id,dayInfo.day),weekClass=dayInfo.isSunday?"bg-red-50 dark:bg-red-900/20":"",todayClass=isCurrentMonth&&dayInfo.day===today?"bg-primary/10":"",editedClass=isEdited?"bg-amber-500/20":"";return jsxRuntimeExports.jsx("td",{className:`px-2 py-2 text-center ${weekClass} ${todayClass} ${editedClass}`,children:value===0?jsxRuntimeExports.jsx("span",{className:"text-muted-foreground/40",children:"-"}):jsxRuntimeExports.jsx("span",{className:`font-medium ${isEdited?"text-amber-600":""}`,children:value})},dayInfo.day)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-2 text-center font-medium bg-green-500/5",children:row.total_normal.toLocaleString()}),jsxRuntimeExports.jsx("td",{className:"px-3 py-2 text-center font-medium bg-blue-500/5",children:row.total_fakultatif.toLocaleString()}),jsxRuntimeExports.jsxs("td",{className:`px-3 py-2 text-center font-bold ${row.sisa_alokasi<0?"bg-red-500/20 text-red-600 dark:text-red-400":row.sisa_alokasi<=row.alokasi*.2&&row.alokasi>0?"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400":"bg-orange-500/5"}`,children:[row.sisa_alokasi<0&&"⚠️ ",row.sisa_alokasi.toLocaleString()]}),jsxRuntimeExports.jsx("td",{className:"px-3 py-2 text-center font-bold bg-purple-500/5",children:row.grand_total.toLocaleString()})]},row.pangkalan_id))}),rekapData&&rekapData.data.length>0&&jsxRuntimeExports.jsx("tfoot",{className:"bg-muted/70 font-bold sticky bottom-0 z-20",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"sticky left-0 z-30 bg-muted px-3 py-3 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",colSpan:2,children:"Total"}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3"}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 text-center",children:rekapData.data.reduce((sum,r)=>sum+r.alokasi,0).toLocaleString()}),dayHeaders.map(dayInfo=>{const weekClass=dayInfo.isSunday?"bg-red-100 dark:bg-red-900/30":"",todayClass=isCurrentMonth&&dayInfo.day===today?"bg-primary/20":"",total=rekapData.data.reduce((sum,r)=>sum+(r.daily[dayInfo.day]||0),0);return jsxRuntimeExports.jsx("td",{className:`px-2 py-3 text-center ${weekClass} ${todayClass}`,children:total===0?jsxRuntimeExports.jsx("span",{className:"text-muted-foreground/40",children:"-"}):total.toLocaleString()},dayInfo.day)}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 text-center bg-green-500/10",children:rekapData.data.reduce((sum,r)=>sum+r.total_normal,0).toLocaleString()}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 text-center bg-blue-500/10",children:rekapData.data.reduce((sum,r)=>sum+r.total_fakultatif,0).toLocaleString()}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 text-center bg-orange-500/10",children:rekapData.data.reduce((sum,r)=>sum+r.sisa_alokasi,0).toLocaleString()}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 text-center bg-purple-500/10",children:rekapData.data.reduce((sum,r)=>sum+r.grand_total,0).toLocaleString()})]})})]})})})]})]}),jsxRuntimeExports.jsx(TabsContent,{value:"form",children:jsxRuntimeExports.jsxs(Card,{className:"chart-card-premium",children:[jsxRuntimeExports.jsxs(CardHeader,{className:"border-b border-border/50 pb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),jsxRuntimeExports.jsx(CardTitle,{className:"text-lg font-semibold",children:"Edit Perencanaan"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[Object.keys(editedCells).length>0&&jsxRuntimeExports.jsxs(Badge,{variant:"outline",className:"bg-amber-500/10 text-amber-500 border-amber-500/50",children:[Object.keys(editedCells).length," perubahan belum disimpan"]}),Object.keys(editedCells).length>0&&jsxRuntimeExports.jsxs(Button,{variant:"outline",onClick:()=>setEditedCells({}),disabled:isSaving,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"X",className:"w-4 h-4 mr-2"}),"Batal"]}),jsxRuntimeExports.jsxs(Button,{onClick:handleSaveChanges,disabled:isSaving||Object.keys(editedCells).length===0,className:"bg-gradient-to-r from-blue-500 to-cyan-500",children:[isSaving?jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"w-4 h-4 mr-2 animate-spin"}):jsxRuntimeExports.jsx(SafeIcon,{name:"Save",className:"w-4 h-4 mr-2"}),"Simpan Perubahan"]})]})]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-muted-foreground mt-2 flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Info",className:"w-4 h-4"}),'Klik pada cell untuk mengedit jumlah perencanaan. Perubahan akan disimpan setelah klik tombol "Simpan Perubahan".']})]}),jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:!rekapData||rekapData.data.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"AlertCircle",className:"w-12 h-12 mx-auto mb-4 opacity-50"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-medium",children:"Tidak ada data"}),jsxRuntimeExports.jsx("p",{className:"text-sm",children:'Gunakan "Generate Otomatis" untuk membuat rencana awal'})]}):jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"w-full text-sm",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{className:"border-b",children:[jsxRuntimeExports.jsx("th",{className:"text-left p-2 sticky left-0 bg-background z-10 min-w-[200px]",children:"Pangkalan"}),dayHeaders.map(dayInfo=>jsxRuntimeExports.jsxs("th",{className:`text-center p-1 min-w-[60px] ${dayInfo.isSunday?"bg-red-500/10 text-red-500":""} ${isCurrentMonth&&dayInfo.day===today?"bg-blue-500/20":""}`,children:[jsxRuntimeExports.jsx("div",{className:"text-xs",children:dayInfo.dayName}),jsxRuntimeExports.jsx("div",{children:dayInfo.day})]},dayInfo.day)),jsxRuntimeExports.jsx("th",{className:"text-center p-2 min-w-[70px] bg-blue-500/10 text-blue-600 font-semibold",children:"Total Normal"}),jsxRuntimeExports.jsx("th",{className:"text-center p-2 min-w-[70px] bg-amber-500/10 text-amber-600 font-semibold",children:"Total Fakultatif"}),jsxRuntimeExports.jsx("th",{className:"text-center p-2 min-w-[70px] bg-green-500/10 text-green-600 font-semibold",children:"Sisa Alokasi"}),jsxRuntimeExports.jsx("th",{className:"text-center p-2 min-w-[70px] bg-purple-500/10 text-purple-600 font-semibold",children:"Grand Total"})]})}),jsxRuntimeExports.jsx("tbody",{children:(computedRekapData?.data||[]).map(row=>jsxRuntimeExports.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[jsxRuntimeExports.jsxs("td",{className:"p-2 sticky left-0 bg-background z-10 font-medium",children:[jsxRuntimeExports.jsx("div",{className:"text-xs text-muted-foreground",children:row.id_registrasi}),jsxRuntimeExports.jsx("div",{children:row.nama_pangkalan})]}),dayHeaders.map(dayInfo=>{const originalValue=row.daily[dayInfo.day]||0,currentValue=getEditedValue(row.pangkalan_id,dayInfo.day,originalValue),isEdited=isCellEdited(row.pangkalan_id,dayInfo.day),editedCell=getEditedCell(row.pangkalan_id,dayInfo.day),hasFakultatif=editedCell&&editedCell.fakultatif>0,isSunday=dayInfo.isSunday,displayValue=isEdited&&editedCell?editedCell.fakultatif>0?`${editedCell.normal}+${editedCell.fakultatif}F`:editedCell.normal:currentValue===0?"-":currentValue;return jsxRuntimeExports.jsx("td",{className:`p-1 text-center ${isSunday?"bg-red-500/5":""} ${isCurrentMonth&&dayInfo.day===today?"bg-blue-500/10":""}`,children:jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>!isSunday&&openEditModal(row.pangkalan_id,row.nama_pangkalan,dayInfo.day,originalValue),disabled:isSunday,className:`min-w-14 h-8 px-1 rounded text-center text-xs transition-all ${hasFakultatif?"bg-amber-500/20 border border-amber-500 text-amber-700 font-semibold":isEdited?"bg-blue-500/20 border border-blue-500 text-blue-700 font-semibold":"bg-transparent hover:bg-muted border border-transparent"} ${isSunday?"cursor-not-allowed opacity-50":"cursor-pointer hover:shadow-sm"}`,children:displayValue})},dayInfo.day)}),jsxRuntimeExports.jsx("td",{className:"text-center p-2 font-semibold bg-blue-500/5 text-blue-600",children:row.total_normal}),jsxRuntimeExports.jsx("td",{className:"text-center p-2 font-semibold bg-amber-500/5 text-amber-600",children:row.total_fakultatif}),jsxRuntimeExports.jsx("td",{className:`text-center p-2 font-semibold ${row.sisa_alokasi>=0?"bg-green-500/5 text-green-600":"bg-red-500/10 text-red-600"}`,children:row.sisa_alokasi}),jsxRuntimeExports.jsx("td",{className:"text-center p-2 font-bold bg-purple-500/5 text-purple-600",children:row.grand_total})]},row.pangkalan_id))})]})})})]})})]}),jsxRuntimeExports.jsx(Dialog,{open:showEditModal,onOpenChange:setShowEditModal,children:jsxRuntimeExports.jsxs(DialogContent,{className:"max-w-md",children:[jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsxs(DialogTitle,{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Edit",className:"w-5 h-5 text-blue-500"}),"Input Perencanaan"]})}),editModalData&&jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 space-y-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Pangkalan"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:editModalData.pangkalanName})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Tanggal"}),jsxRuntimeExports.jsxs("span",{className:"font-medium",children:[editModalData.day," ",new Date(selectedMonth+"-01").toLocaleDateString("id-ID",{month:"long",year:"numeric"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm border-t border-border/50 pt-1 mt-1",children:[jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Total"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold text-green-600",children:[editModalData.normal+editModalData.fakultatif," tabung"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs(Label,{htmlFor:"edit-normal",className:"text-sm font-medium flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Normal"]}),jsxRuntimeExports.jsx(Input,{id:"edit-normal",type:"number",min:"0",value:editModalData.normal,onChange:e=>setEditModalData(prev=>prev?{...prev,normal:parseInt(e.target.value)||0}:null),className:"w-full text-lg font-semibold border-blue-200 focus:border-blue-500",autoFocus:!0}),jsxRuntimeExports.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Kuota reguler"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs(Label,{htmlFor:"edit-fakultatif",className:"text-sm font-medium flex items-center gap-1",children:[jsxRuntimeExports.jsx("span",{className:"w-2 h-2 bg-amber-500 rounded-full"}),"Fakultatif"]}),jsxRuntimeExports.jsx(Input,{id:"edit-fakultatif",type:"number",min:"0",value:editModalData.fakultatif,onChange:e=>setEditModalData(prev=>prev?{...prev,fakultatif:parseInt(e.target.value)||0}:null),className:"w-full text-lg font-semibold border-amber-200 focus:border-amber-500"}),jsxRuntimeExports.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Tambahan ekstra"})]})]})]}),jsxRuntimeExports.jsxs(DialogFooter,{className:"flex gap-2 sm:justify-between",children:[jsxRuntimeExports.jsx("div",{children:editModalData&&isCellEdited(editModalData.pangkalanId,editModalData.day)&&jsxRuntimeExports.jsxs(Button,{variant:"destructive",onClick:handleRemoveEdit,className:"bg-red-500 hover:bg-red-600",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Trash2",className:"w-4 h-4 mr-2"}),"Hapus Perubahan"]})}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:()=>setShowEditModal(!1),children:"Batal"}),jsxRuntimeExports.jsxs(Button,{onClick:handleModalSave,className:"bg-gradient-to-r from-blue-500 to-cyan-500",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Check",className:"w-4 h-4 mr-2"}),"Simpan"]})]})]})]})})]})}export{PerencanaanPage as default};
