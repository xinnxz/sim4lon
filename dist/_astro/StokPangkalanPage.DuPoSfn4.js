import{j as jsxRuntimeExports}from"./jsx-runtime.mvtouYz0.js";import{r as reactExports}from"./index.DcciWILN.js";import{C as Card,a as CardContent,b as CardHeader,c as CardTitle,d as CardDescription}from"./card.D0gylVsf.js";import{S as SafeIcon,B as Button}from"./SafeIcon.CAGsavDo.js";import{B as Badge}from"./badge.DZiJ6zSB.js";import{I as Input}from"./input.C9ryBhC0.js";import{D as Dialog,e as DialogTrigger,a as DialogContent,b as DialogHeader,c as DialogTitle,d as DialogDescription,f as DialogFooter}from"./dialog.CoJQQKDV.js";import{S as Select,a as SelectTrigger,b as SelectValue,c as SelectContent,d as SelectItem}from"./select.Dd50uIHU.js";import{lpgProductsApi,agenOrdersApi,authApi,pangkalanStockApi,lpgPricesApi,companyProfileApi}from"./api.Dr7hS9Y8.js";import{t as toast}from"./index.fAd_ikgp.js";import{u as utils,w as writeFileSync,E,a as autoTable}from"./jspdf.plugin.autotable.tHrVzh7j.js";import{D as DropdownMenu,a as DropdownMenuTrigger,b as DropdownMenuContent,c as DropdownMenuItem}from"./dropdown-menu.CyUKnKxT.js";import"./index.zVS-qTD4.js";import"./index.BpQ989z7.js";import"./index.PIAPtHoh.js";import"./index.ubNQCTBn.js";import"./index.YpXgcoRz.js";import"./index.Dovp0-D8.js";import"./index.DZiLsHox.js";import"./index.CdmyERTi.js";import"./x.DUlMVzh7.js";import"./index.DGt6JTY0.js";import"./index.BStXkqMp.js";import"./index.Drh0kMGk.js";import"./index.BFpcrWlj.js";import"./index.9MihlNbL.js";import"./index.BhA3i5Wo.js";import"./index.BaF2FVWY.js";import"./chevron-up.BBBXIirx.js";import"./check.TUgVKQyo.js";import"./index.DQDOfy24.js";import"./chevron-right.oaN48PMp.js";const formatCurrency=value=>new Intl.NumberFormat("id-ID").format(value),ProductManagementGrid=({products,editedPrices,stocks,isSaving,onAddProduct,onDeactivateProduct,onUpdatePrice})=>{const activeProducts=products.filter(p=>{const edited=editedPrices[p.lpgType];return p.isAdded&&(edited?.active??!1)}),inactiveProducts=products.filter(p=>{const edited=editedPrices[p.lpgType];return!p.isAdded||!(edited?.active??!1)});return jsxRuntimeExports.jsxs("div",{className:"space-y-8",children:[activeProducts.length>0&&jsxRuntimeExports.jsx("section",{className:"space-y-4",children:jsxRuntimeExports.jsx("div",{className:"grid gap-4 lg:grid-cols-2",children:activeProducts.map(product=>{const lpgType=product.lpgType,edited=editedPrices[lpgType],margin=(edited?.sell||0)-(edited?.cost||0),currentStock=stocks.find(s=>s.lpg_type===lpgType),productColor=product.color||"#3B82F6";return jsxRuntimeExports.jsxs("div",{className:"group relative bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden border border-slate-100",children:[jsxRuntimeExports.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5",style:{backgroundColor:productColor}}),jsxRuntimeExports.jsxs("div",{className:"p-5 pl-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg",style:{background:`linear-gradient(135deg, ${productColor}, ${productColor}CC)`},children:jsxRuntimeExports.jsx(SafeIcon,{name:"Flame",className:"h-7 w-7 text-white"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-bold text-lg text-slate-900",children:product.name}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm text-slate-500",children:[product.size_kg," kg"]}),currentStock&&jsxRuntimeExports.jsxs(Badge,{variant:"secondary",className:`text-xs ${currentStock.status==="KRITIS"?"bg-red-100 text-red-700":currentStock.status==="RENDAH"?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700"}`,children:["Stok: ",currentStock.qty]})]})]})]}),jsxRuntimeExports.jsx(Button,{size:"icon",variant:"ghost",onClick:()=>onDeactivateProduct(lpgType),disabled:isSaving,className:"h-8 w-8 opacity-0 group-hover:opacity-100 text-slate-400 hover:text-red-500 hover:bg-red-50 transition-all",children:jsxRuntimeExports.jsx(SafeIcon,{name:"X",className:"h-4 w-4"})})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"bg-slate-50 rounded-xl p-3",children:[jsxRuntimeExports.jsx("label",{className:"text-xs text-slate-500 block mb-1",children:"Harga Beli"}),jsxRuntimeExports.jsxs("div",{className:"flex items-baseline gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-slate-400",children:"Rp"}),jsxRuntimeExports.jsx(Input,{type:"number",value:edited?.cost||"",onChange:e=>onUpdatePrice(lpgType,"cost",Number(e.target.value)),className:"border-0 bg-transparent p-0 h-auto text-lg font-bold text-slate-900 focus-visible:ring-0 w-full"})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-blue-50 rounded-xl p-3",children:[jsxRuntimeExports.jsx("label",{className:"text-xs text-blue-600 block mb-1",children:"Harga Jual"}),jsxRuntimeExports.jsxs("div",{className:"flex items-baseline gap-1",children:[jsxRuntimeExports.jsx("span",{className:"text-xs text-blue-400",children:"Rp"}),jsxRuntimeExports.jsx(Input,{type:"number",value:edited?.sell||"",onChange:e=>onUpdatePrice(lpgType,"sell",Number(e.target.value)),className:"border-0 bg-transparent p-0 h-auto text-lg font-bold text-blue-700 focus-visible:ring-0 w-full"})]})]}),jsxRuntimeExports.jsxs("div",{className:`rounded-xl p-3 ${margin>=0?"bg-green-50":"bg-red-50"}`,children:[jsxRuntimeExports.jsx("label",{className:`text-xs block mb-1 ${margin>=0?"text-green-600":"text-red-600"}`,children:"Margin"}),jsxRuntimeExports.jsxs("div",{className:`text-lg font-bold ${margin>=0?"text-green-700":"text-red-700"}`,children:["Rp ",formatCurrency(margin)]})]})]})]})]},product.id)})})}),inactiveProducts.length>0&&jsxRuntimeExports.jsxs("section",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Plus",className:"h-5 w-5 text-slate-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-slate-900",children:"Tambah Produk"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500",children:"Klik produk untuk mengaktifkan"})]})]}),jsxRuntimeExports.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:inactiveProducts.map(product=>{const productColor=product.color||"#3B82F6";return jsxRuntimeExports.jsxs("button",{onClick:()=>onAddProduct({id:product.id,name:product.name,size_kg:product.size_kg,selling_price:product.selling_price,cost_price:product.cost_price}),disabled:isSaving,className:"group flex items-center gap-4 p-4 bg-white border-2 border-dashed border-slate-200 rounded-xl hover:border-blue-400 hover:bg-blue-50/50 hover:shadow-md transition-all duration-200 text-left disabled:opacity-50",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center opacity-50 group-hover:opacity-100 transition-all group-hover:shadow-lg",style:{background:`linear-gradient(135deg, ${productColor}40, ${productColor}20)`},children:jsxRuntimeExports.jsx(SafeIcon,{name:"Flame",className:"h-6 w-6",style:{color:productColor}})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-slate-600 group-hover:text-blue-600 transition-colors truncate",children:product.name}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-slate-400",children:[product.size_kg," kg"]})]}),jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-100 group-hover:bg-blue-500 flex items-center justify-center transition-all",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Plus",className:"h-4 w-4 text-slate-400 group-hover:text-white transition-colors"})})]},product.id)})})]}),products.length===0&&jsxRuntimeExports.jsxs("div",{className:"text-center py-16",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-100 flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Package",className:"h-8 w-8 text-slate-400"})}),jsxRuntimeExports.jsx("h3",{className:"font-medium text-slate-700 mb-1",children:"Tidak ada produk"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500",children:"Produk akan muncul di sini"})]})]})},LPG_CONFIG={gr220:{name:"Bright Gas 220gr",color:"#FFA500",gradient:"from-orange-400 to-amber-500"},"3kg":{name:"LPG 3 kg",color:"#22C55E",gradient:"from-green-500 to-emerald-600"},kg3:{name:"LPG 3 kg",color:"#22C55E",gradient:"from-green-500 to-emerald-600"},"5kg":{name:"LPG 5.5 kg",color:"#ff82c5",gradient:"from-pink-400 to-pink-600"},kg5:{name:"LPG 5.5 kg",color:"#ff82c5",gradient:"from-pink-400 to-pink-600"},"12kg":{name:"LPG 12 kg",color:"#3B82F6",gradient:"from-blue-500 to-indigo-600"},kg12:{name:"LPG 12 kg",color:"#3B82F6",gradient:"from-blue-500 to-indigo-600"},"50kg":{name:"LPG 50 kg",color:"#8B5CF6",gradient:"from-violet-500 to-purple-600"},kg50:{name:"LPG 50 kg",color:"#8B5CF6",gradient:"from-violet-500 to-purple-600"}},normalizeType=type=>{if(type.startsWith("kg"))return type;const match=type.match(/^(\d+\.?\d*)kg$/);return match?`kg${match[1]}`:type.match(/g?r?220g?r?/i)?"gr220":type};function StokPangkalanPage(){const[profile,setProfile]=reactExports.useState(null),[stocks,setStocks]=reactExports.useState([]),[movements,setMovements]=reactExports.useState([]),[totalStock,setTotalStock]=reactExports.useState(0),[isLoading,setIsLoading]=reactExports.useState(!0),[isLoadingHistory,setIsLoadingHistory]=reactExports.useState(!1),[activeTab,setActiveTab]=reactExports.useState("stock"),[isReceiveOpen,setIsReceiveOpen]=reactExports.useState(!1),[isOrderOpen,setIsOrderOpen]=reactExports.useState(!1),[receiveData,setReceiveData]=reactExports.useState({lpgType:"kg3",qty:0,note:"",movementType:"IN"}),[orderData,setOrderData]=reactExports.useState({lpgType:"kg3",qty:0,note:""}),[isSubmitting,setIsSubmitting]=reactExports.useState(!1),[companyProfile,setCompanyProfile]=reactExports.useState(null),[currentPage,setCurrentPage]=reactExports.useState(1),[filterType,setFilterType]=reactExports.useState("all"),itemsPerPage=10,[prices,setPrices]=reactExports.useState([]),[editedPrices,setEditedPrices]=reactExports.useState({}),[initialPrices,setInitialPrices]=reactExports.useState({}),[isLoadingPrices,setIsLoadingPrices]=reactExports.useState(!1),[isSaving,setIsSaving]=reactExports.useState(!1),[hasChanges,setHasChanges]=reactExports.useState(!1),[agenProducts,setAgenProducts]=reactExports.useState([]),[agenOrders,setAgenOrders]=reactExports.useState([]),[isLoadingOrders,setIsLoadingOrders]=reactExports.useState(!1),[orderStatusFilter,setOrderStatusFilter]=reactExports.useState("all"),[isCreateOrderOpen,setIsCreateOrderOpen]=reactExports.useState(!1),[isReceiveOrderOpen,setIsReceiveOrderOpen]=reactExports.useState(!1),[selectedOrder,setSelectedOrder]=reactExports.useState(null),[createOrderData,setCreateOrderData]=reactExports.useState({lpgType:"kg3",qty:0,note:""}),[receiveQty,setReceiveQty]=reactExports.useState(0),fetchData=async()=>{try{setIsLoading(!0);const[profileData,stockResponse]=await Promise.all([authApi.getProfile(),pangkalanStockApi.getStockLevels()]);setProfile(profileData),setStocks(stockResponse.stocks),setTotalStock(stockResponse.summary.total)}catch(error){console.error("Failed to fetch data:",error),toast.error("Gagal memuat data stok")}finally{setIsLoading(!1)}},fetchMovements=async()=>{try{setIsLoadingHistory(!0);const data=await pangkalanStockApi.getMovements({limit:100,lpgType:filterType!=="all"?filterType:void 0});setMovements(data),setCurrentPage(1)}catch(error){console.error("Failed to fetch movements:",error),toast.error("Gagal memuat riwayat stok")}finally{setIsLoadingHistory(!1)}},fetchPrices=async()=>{try{setIsLoadingPrices(!0);const data=await lpgPricesApi.getAll();setPrices(data);const edited={};data.forEach(p=>{edited[p.lpg_type]={cost:Number(p.cost_price),sell:Number(p.selling_price),active:p.is_active}}),setEditedPrices(edited),setInitialPrices(JSON.parse(JSON.stringify(edited))),setHasChanges(!1)}catch(error){console.error("Failed to fetch prices:",error),toast.error("Gagal memuat data harga")}finally{setIsLoadingPrices(!1)}};reactExports.useEffect(()=>{fetchData(),fetchPrices()},[]),reactExports.useEffect(()=>{activeTab==="history"?fetchMovements():activeTab==="products"&&(fetchPrices(),fetchAgenProducts())},[activeTab,filterType]);const fetchAgenProducts=async()=>{try{const data=await lpgProductsApi.getWithStock();setAgenProducts(data)}catch(error){console.error("Failed to fetch agen products:",error)}},fetchAgenOrders=async()=>{try{setIsLoadingOrders(!0);const data=await agenOrdersApi.getOrders(orderStatusFilter);setAgenOrders(data)}catch(error){console.error("Failed to fetch agen orders:",error),toast.error("Gagal memuat pesanan agen")}finally{setIsLoadingOrders(!1)}};reactExports.useEffect(()=>{fetchAgenOrders()},[]),reactExports.useEffect(()=>{(async()=>{try{const profileData=await companyProfileApi.get();setCompanyProfile(profileData)}catch(error){console.error("Failed to fetch company profile:",error)}})()},[]);const updatePrice=(lpgType,field,value)=>{setEditedPrices(prev=>({...prev,[lpgType]:{...prev[lpgType],[field]:value}})),setHasChanges(!0)},handleSavePrices=async()=>{try{setIsSaving(!0);const pricesToUpdate=Object.entries(editedPrices).map(([lpgType,data])=>({lpg_type:lpgType,cost_price:data.cost,selling_price:data.sell,is_active:data.active}));await lpgPricesApi.bulkUpdate(pricesToUpdate),toast.success("Harga berhasil disimpan!"),await fetchPrices()}catch(error){toast.error(error.message||"Gagal menyimpan harga")}finally{setIsSaving(!1)}},sizeKgToLpgType=sizeKg=>({.22:"gr220",3:"kg3",5.5:"kg5",12:"kg12",50:"kg50"})[sizeKg]??`kg${String(sizeKg).replace(".","")}`,handleAddProduct=async product=>{try{setIsSaving(!0);const lpgType=sizeKgToLpgType(product.size_kg);await lpgPricesApi.bulkUpdate([{lpg_type:lpgType,cost_price:Number(product.cost_price||0),selling_price:Number(product.selling_price||0),is_active:!0}]),toast.success(`${product.name} berhasil ditambahkan!`),await fetchPrices(),await fetchAgenProducts()}catch(error){toast.error(error.message||"Gagal menambahkan produk")}finally{setIsSaving(!1)}},handleDeactivateProduct=async lpgType=>{try{setIsSaving(!0);const existingPrice=prices.find(p=>p.lpg_type===lpgType);existingPrice&&(await lpgPricesApi.bulkUpdate([{lpg_type:lpgType,cost_price:Number(existingPrice.cost_price||0),selling_price:Number(existingPrice.selling_price||0),is_active:!1}]),toast.success("Produk berhasil dinonaktifkan"),await fetchPrices())}catch(error){toast.error(error.message||"Gagal menonaktifkan produk")}finally{setIsSaving(!1)}},getAllDisplayProducts=()=>[{lpgType:"gr220",name:"Bright Gas Can",size_kg:.22,color:"#FFA500"},{lpgType:"kg3",name:"LPG 3 kg",size_kg:3,color:"#22C55E"},{lpgType:"kg5",name:"LPG 5.5 kg",size_kg:5.5,color:"#ff82c5"},{lpgType:"kg12",name:"LPG 12 kg",size_kg:12,color:"#3B82F6"},{lpgType:"kg50",name:"LPG 50 kg",size_kg:50,color:"#8B5CF6"}].map(product=>{const priceData=prices.find(p=>p.lpg_type===product.lpgType);return{id:priceData?.id||product.lpgType,name:product.name,size_kg:product.size_kg,lpgType:product.lpgType,color:product.color,selling_price:Number(priceData?.selling_price||0),cost_price:Number(priceData?.cost_price||0),isFromAgen:!1,isAdded:!!priceData}}),activeLpgTypes=(()=>{const allTypes=[{value:"gr220",label:"Bright Gas 220gr"},{value:"kg3",label:"LPG 3 kg"},{value:"kg5",label:"LPG 5.5 kg"},{value:"kg12",label:"LPG 12 kg"},{value:"kg50",label:"LPG 50 kg"}];return prices.length===0?allTypes:allTypes.filter(type=>prices.find(p=>normalizeType(p.lpg_type)===normalizeType(type.value))?.is_active===!0)})(),formatDate=dateStr=>new Date(dateStr).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),totalPages=Math.ceil(movements.length/itemsPerPage),paginatedMovements=movements.slice((currentPage-1)*itemsPerPage,currentPage*itemsPerPage),getStockStatus=stock=>stock.status==="KRITIS"?{label:"Kritis",color:"bg-red-100 text-red-700 border-red-200"}:stock.status==="RENDAH"?{label:"Menipis",color:"bg-orange-100 text-orange-700 border-orange-200"}:{label:"Aman",color:"bg-green-100 text-green-700 border-green-200"},handleReceiveStock=async()=>{if(receiveData.qty<=0){toast.error("Jumlah harus lebih dari 0");return}if(receiveData.movementType==="OUT"){const currentStock=stocks.find(s=>s.lpg_type===receiveData.lpgType);if(!currentStock||currentStock.qty<receiveData.qty){toast.error(`Stok tidak cukup! Stok saat ini: ${currentStock?.qty||0} tabung`);return}}try{setIsSubmitting(!0),await pangkalanStockApi.receiveStock({lpg_type:receiveData.lpgType,qty:receiveData.movementType==="OUT"?-receiveData.qty:receiveData.qty,note:receiveData.note||`Koreksi stok ${receiveData.movementType==="IN"?"masuk":"keluar"} (manual)`});const action=receiveData.movementType==="IN"?"ditambahkan":"dikurangi";toast.success(`Berhasil ${action} ${receiveData.qty} tabung ${LPG_CONFIG[receiveData.lpgType]?.name}`),setIsReceiveOpen(!1),setReceiveData({lpgType:"kg3",qty:0,note:"",movementType:"IN"}),fetchData()}catch(error){toast.error(error.message||"Gagal mencatat koreksi stok")}finally{setIsSubmitting(!1)}},handleOrderToAgen=async()=>{if(orderData.qty<=0){toast.error("Jumlah harus lebih dari 0");return}if(!companyProfile?.phone){toast.error("Nomor telepon Agen belum terdaftar. Hubungi admin untuk menambahkan data.");return}let phoneNumber=companyProfile.phone.replace(/\D/g,"");phoneNumber.startsWith("0")?phoneNumber="62"+phoneNumber.substring(1):phoneNumber.startsWith("62")||(phoneNumber="62"+phoneNumber);const lpgName=LPG_CONFIG[orderData.lpgType]?.name||orderData.lpgType,message=`*ðŸ›¢ï¸ PESANAN LPG*

Dari: ${profile?.pangkalans?.name||"Pangkalan"}
Tipe: ${lpgName}
Jumlah: ${orderData.qty} tabung
${orderData.note?`Catatan: ${orderData.note}`:""}

Mohon konfirmasi ketersediaan dan estimasi pengiriman. Terima kasih.`,waUrl=`https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;window.open(waUrl,"_blank"),toast.success(`Membuka WhatsApp untuk menghubungi ${companyProfile.company_name}`),setIsOrderOpen(!1),setOrderData({lpgType:"3kg",qty:0,note:""})},handleExportExcel=()=>{try{toast.loading("Generating Excel...",{id:"excel-export"});const wb=utils.book_new(),now=new Date,pangkalanName=profile?.pangkalans?.name||profile?.name||"PANGKALAN",monthName=now.toLocaleDateString("id-ID",{month:"long",year:"numeric"}).toUpperCase(),stockData=[];stockData.push([`LAPORAN STOK LPG ${pangkalanName.toUpperCase()}`]),stockData.push([`Per Tanggal: ${now.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"})}`]),stockData.push([]),stockData.push(["NO","TIPE LPG","NAMA","STOK (TABUNG)","STATUS","TERAKHIR UPDATE"]);let rowNo=1;stocks.forEach(stock=>{const config=LPG_CONFIG[stock.lpg_type]||{name:stock.lpg_type.toUpperCase()};stockData.push([rowNo++,stock.lpg_type.toUpperCase(),config.name,stock.qty,stock.status,new Date(stock.updated_at).toLocaleDateString("id-ID")])}),stockData.push([]),stockData.push(["","","TOTAL STOK:",totalStock,"",""]);const wsStock=utils.aoa_to_sheet(stockData);if(wsStock["!cols"]=[{wch:5},{wch:12},{wch:20},{wch:15},{wch:15},{wch:18}],wsStock["!merges"]=[{s:{r:0,c:0},e:{r:0,c:5}},{s:{r:1,c:0},e:{r:1,c:5}}],utils.book_append_sheet(wb,wsStock,"Stok Saat Ini"),movements.length>0){const moveData=[];moveData.push([`RIWAYAT PERGERAKAN STOK ${pangkalanName.toUpperCase()}`]),moveData.push([]),moveData.push(["NO","TANGGAL","TIPE LPG","JENIS","QTY","CATATAN"]);let moveNo=1;movements.forEach(move=>{moveData.push([moveNo++,new Date(move.created_at).toLocaleDateString("id-ID"),move.lpg_type.toUpperCase(),move.movement_type==="IN"?"MASUK":move.movement_type==="OUT"?"KELUAR":move.movement_type,move.qty,move.note||"-"])});const wsMove=utils.aoa_to_sheet(moveData);wsMove["!cols"]=[{wch:5},{wch:15},{wch:12},{wch:12},{wch:8},{wch:25}],wsMove["!merges"]=[{s:{r:0,c:0},e:{r:0,c:5}}],utils.book_append_sheet(wb,wsMove,"Riwayat Pergerakan")}const fileName=`Stok_LPG_${pangkalanName.replace(/\s/g,"_")}_${monthName.replace(/\s/g,"_")}.xlsx`;writeFileSync(wb,fileName),toast.success("Excel berhasil di-download!",{id:"excel-export"})}catch(error){console.error("Excel export error:",error),toast.error("Gagal export Excel",{id:"excel-export"})}},handleExportPDF=()=>{try{toast.loading("Generating PDF...",{id:"pdf-export"});const doc=new E({orientation:"portrait"}),pageWidth=doc.internal.pageSize.getWidth(),margin=14,now=new Date,pangkalanName=profile?.pangkalans?.name||profile?.name||"PANGKALAN",monthName=now.toLocaleDateString("id-ID",{month:"long",year:"numeric"}).toUpperCase();doc.setFont("helvetica","italic"),doc.setFontSize(9),doc.setTextColor(150),doc.text("Sim4lon by Luthfi",pageWidth-margin,10,{align:"right"}),doc.setFont("helvetica","bold"),doc.setFontSize(16),doc.setTextColor(30,64,175),doc.text("LAPORAN STOK LPG",pageWidth/2,20,{align:"center"}),doc.setFont("helvetica","normal"),doc.setFontSize(12),doc.setTextColor(60),doc.text(pangkalanName.toUpperCase(),pageWidth/2,28,{align:"center"}),doc.setFontSize(10),doc.setTextColor(100),doc.text(`Per ${now.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"})}`,pageWidth/2,35,{align:"center"}),doc.setDrawColor(200),doc.setFillColor(248,250,252),doc.roundedRect(margin,42,pageWidth-2*margin,18,3,3,"F"),doc.setFontSize(11),doc.setTextColor(60),doc.text(`Total Tipe LPG: ${stocks.length}`,margin+10,52),doc.setFont("helvetica","bold"),doc.setTextColor(30,64,175),doc.text(`Total Stok: ${totalStock} Tabung`,pageWidth-margin-10,52,{align:"right"});const stockHeaders=["NO","TIPE LPG","NAMA PRODUK","STOK","STATUS"],stockTableData=[];let no=1;stocks.forEach(stock=>{const config=LPG_CONFIG[stock.lpg_type]||{name:stock.lpg_type.toUpperCase()};stockTableData.push([no++,stock.lpg_type.toUpperCase(),config.name,`${stock.qty} tabung`,stock.status])}),autoTable(doc,{startY:65,head:[stockHeaders],body:stockTableData,theme:"grid",styles:{fontSize:10,cellPadding:4},headStyles:{fillColor:[30,64,175],textColor:255,fontStyle:"bold",halign:"center"},columnStyles:{0:{halign:"center",cellWidth:15},1:{halign:"center",cellWidth:25},2:{cellWidth:60},3:{halign:"center",cellWidth:30},4:{halign:"center",cellWidth:25}},alternateRowStyles:{fillColor:[248,250,252]},didParseCell:data=>{if(data.column.index===4&&data.section==="body"){const val=String(data.cell.raw);val==="Rendah"?(data.cell.styles.textColor=[220,38,38],data.cell.styles.fontStyle="bold"):val==="Aman"&&(data.cell.styles.textColor=[22,163,74])}}});const pageCount=doc.getNumberOfPages();for(let i=1;i<=pageCount;i++)doc.setPage(i),doc.setFontSize(8),doc.setTextColor(150),doc.text(`Halaman ${i} dari ${pageCount} | Dicetak: ${new Date().toLocaleString("id-ID")}`,pageWidth/2,doc.internal.pageSize.getHeight()-10,{align:"center"});doc.save(`Stok_LPG_${pangkalanName.replace(/\s/g,"_")}_${monthName.replace(/\s/g,"_")}.pdf`),toast.success("PDF berhasil di-download!",{id:"pdf-export"})}catch(error){console.error("PDF export error:",error),toast.error("Gagal export PDF",{id:"pdf-export"})}};return isLoading?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center min-h-[500px]",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-blue-200 border-t-blue-600 mx-auto"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Package",className:"h-6 w-6 text-blue-600"})})]}),jsxRuntimeExports.jsx("p",{className:"text-slate-500 mt-4 font-medium",children:"Memuat data stok..."})]})}):jsxRuntimeExports.jsxs("div",{className:"space-y-8 pb-8",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-slate-900 tracking-tight",children:"Stok LPG"}),jsxRuntimeExports.jsxs("p",{className:"text-slate-500 mt-1 flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Package",className:"h-4 w-4"}),"Kelola ketersediaan stok LPG di pangkalan"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsxs(DropdownMenu,{children:[jsxRuntimeExports.jsx(DropdownMenuTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{variant:"outline",className:"rounded-xl border-green-200 text-green-600 hover:bg-green-50",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Download",className:"h-4 w-4 mr-2"}),"Export"]})}),jsxRuntimeExports.jsxs(DropdownMenuContent,{align:"end",children:[jsxRuntimeExports.jsxs(DropdownMenuItem,{onClick:handleExportExcel,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"FileSpreadsheet",className:"h-4 w-4 mr-2 text-green-600"}),"Export Excel"]}),jsxRuntimeExports.jsxs(DropdownMenuItem,{onClick:handleExportPDF,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"FileText",className:"h-4 w-4 mr-2 text-red-600"}),"Export PDF"]})]})]}),jsxRuntimeExports.jsxs(Dialog,{open:isOrderOpen,onOpenChange:setIsOrderOpen,children:[jsxRuntimeExports.jsx(DialogTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{variant:"outline",className:"rounded-xl border-blue-200 text-blue-600 hover:bg-blue-50 hover:text-blue-700 relative",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Truck",className:"h-4 w-4 mr-2"}),"Pesan ke Agen",agenOrders.filter(o=>o.status==="PENDING"||o.status==="DIKIRIM").length>0&&jsxRuntimeExports.jsx("span",{className:"absolute -top-2 -right-2 w-5 h-5 bg-orange-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow-lg animate-pulse",children:agenOrders.filter(o=>o.status==="PENDING"||o.status==="DIKIRIM").length})]})}),jsxRuntimeExports.jsxs(DialogContent,{className:"sm:max-w-md",children:[jsxRuntimeExports.jsxs(DialogHeader,{children:[jsxRuntimeExports.jsxs(DialogTitle,{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Truck",className:"h-5 w-5 text-blue-600"})}),"Pesan ke Agen"]}),jsxRuntimeExports.jsx(DialogDescription,{children:"Buat pesanan LPG baru dan kirim notifikasi ke agen"})]}),agenOrders.filter(o=>o.status==="PENDING").length>0&&jsxRuntimeExports.jsx("div",{className:"p-3 bg-orange-50 rounded-lg border border-orange-200",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Clock",className:"h-4 w-4 text-orange-600"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-orange-700",children:[jsxRuntimeExports.jsxs("span",{className:"font-medium",children:[agenOrders.filter(o=>o.status==="PENDING").length," pesanan"]})," menunggu konfirmasi"]})]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium",children:"Tipe LPG"}),jsxRuntimeExports.jsxs(Select,{value:orderData.lpgType,onValueChange:v=>setOrderData({...orderData,lpgType:v}),children:[jsxRuntimeExports.jsx(SelectTrigger,{children:jsxRuntimeExports.jsx(SelectValue,{})}),jsxRuntimeExports.jsx(SelectContent,{children:activeLpgTypes.map(type=>jsxRuntimeExports.jsx(SelectItem,{value:type.value,children:type.label},type.value))})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium",children:"Jumlah (tabung)"}),jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"Masukkan jumlah",value:orderData.qty||"",onChange:e=>setOrderData({...orderData,qty:parseInt(e.target.value)||0})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium",children:"Catatan (opsional)"}),jsxRuntimeExports.jsx(Input,{placeholder:"Catatan tambahan",value:orderData.note,onChange:e=>setOrderData({...orderData,note:e.target.value})})]}),companyProfile?jsxRuntimeExports.jsx("div",{className:"p-3 bg-green-50 rounded-lg border border-green-200",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Building2",className:"h-4 w-4 text-green-600 mt-0.5"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-green-800",children:companyProfile.company_name}),jsxRuntimeExports.jsx("p",{className:"text-xs text-green-600",children:companyProfile.phone||"No telepon belum diatur"})]})]})}):jsxRuntimeExports.jsx("div",{className:"p-3 bg-amber-50 rounded-lg border border-amber-200",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"AlertCircle",className:"h-4 w-4 text-amber-600 mt-0.5"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-amber-700",children:"Profil perusahaan belum diatur. Hubungi admin."})]})})]}),jsxRuntimeExports.jsxs(DialogFooter,{className:"flex-col sm:flex-row gap-2",children:[jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:()=>setIsOrderOpen(!1),children:"Batal"}),jsxRuntimeExports.jsxs(Button,{onClick:async()=>{try{setIsSubmitting(!0),await agenOrdersApi.createOrder({lpg_type:orderData.lpgType,qty:orderData.qty,note:orderData.note||void 0}),toast.success("Pesanan berhasil dibuat!"),await fetchAgenOrders(),companyProfile?.phone&&handleOrderToAgen(),setIsOrderOpen(!1)}catch(error){toast.error(error.message||"Gagal membuat pesanan")}finally{setIsSubmitting(!1)}},disabled:isSubmitting||orderData.qty<=0,className:"bg-blue-600 hover:bg-blue-700",children:[isSubmitting?jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"h-4 w-4 mr-2 animate-spin"}):jsxRuntimeExports.jsx(SafeIcon,{name:"Send",className:"h-4 w-4 mr-2"}),isSubmitting?"Menyimpan...":"Buat Pesanan"]})]})]})]}),jsxRuntimeExports.jsxs(Dialog,{open:isReceiveOpen,onOpenChange:setIsReceiveOpen,children:[jsxRuntimeExports.jsx(DialogTrigger,{asChild:!0}),jsxRuntimeExports.jsxs(DialogContent,{className:"sm:max-w-md",children:[jsxRuntimeExports.jsxs(DialogHeader,{children:[jsxRuntimeExports.jsxs(DialogTitle,{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center",children:jsxRuntimeExports.jsx(SafeIcon,{name:"PackagePlus",className:"h-5 w-5 text-green-600"})}),"Koreksi Stok Manual"]}),jsxRuntimeExports.jsx(DialogDescription,{children:"Catat penyesuaian stok (selisih opname atau sumber lain)"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium",children:"Jenis Koreksi"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>setReceiveData({...receiveData,movementType:"IN"}),className:`flex items-center justify-center gap-2 p-3 rounded-xl border-2 transition-all ${receiveData.movementType==="IN"?"border-green-500 bg-green-50 text-green-700":"border-slate-200 hover:border-slate-300"}`,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Plus",className:"h-4 w-4"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Tambah"})]}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>setReceiveData({...receiveData,movementType:"OUT"}),className:`flex items-center justify-center gap-2 p-3 rounded-xl border-2 transition-all ${receiveData.movementType==="OUT"?"border-red-500 bg-red-50 text-red-700":"border-slate-200 hover:border-slate-300"}`,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Minus",className:"h-4 w-4"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Kurangi"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium",children:"Tipe LPG"}),jsxRuntimeExports.jsxs(Select,{value:receiveData.lpgType,onValueChange:v=>setReceiveData({...receiveData,lpgType:v}),children:[jsxRuntimeExports.jsx(SelectTrigger,{children:jsxRuntimeExports.jsx(SelectValue,{})}),jsxRuntimeExports.jsx(SelectContent,{children:activeLpgTypes.map(type=>jsxRuntimeExports.jsx(SelectItem,{value:type.value,children:type.label},type.value))})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium",children:"Jumlah (tabung)"}),jsxRuntimeExports.jsx(Input,{type:"number",placeholder:"Masukkan jumlah",value:receiveData.qty||"",onChange:e=>setReceiveData({...receiveData,qty:parseInt(e.target.value)||0})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{className:"text-sm font-medium",children:"Catatan (opsional)"}),jsxRuntimeExports.jsx(Input,{placeholder:"Contoh: Pengiriman dari Agen XYZ",value:receiveData.note,onChange:e=>setReceiveData({...receiveData,note:e.target.value})})]})]}),jsxRuntimeExports.jsxs(DialogFooter,{children:[jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:()=>setIsReceiveOpen(!1),children:"Batal"}),jsxRuntimeExports.jsxs(Button,{onClick:handleReceiveStock,disabled:isSubmitting,className:"bg-green-600 hover:bg-green-700",children:[isSubmitting?jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"h-4 w-4 mr-2 animate-spin"}):jsxRuntimeExports.jsx(SafeIcon,{name:"Check",className:"h-4 w-4 mr-2"}),"Simpan"]})]})]})]})]})]}),jsxRuntimeExports.jsxs(Card,{className:"relative overflow-hidden bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-600 text-white shadow-lg shadow-blue-500/20",children:[jsxRuntimeExports.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full translate-y-1/2 -translate-x-1/2"}),jsxRuntimeExports.jsx(CardContent,{className:"p-6 relative",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("p",{className:"text-blue-100 text-sm mb-1 flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Package",className:"h-4 w-4"}),"Total Stok Tersedia"]}),jsxRuntimeExports.jsx("p",{className:"text-5xl font-bold tracking-tight",children:stocks.filter(s=>prices.find(p=>normalizeType(p.lpg_type)===normalizeType(s.lpg_type))?.is_active===!0).reduce((sum,s)=>sum+s.qty,0)}),jsxRuntimeExports.jsxs("p",{className:"text-blue-100 text-sm mt-2",children:["tabung dari ",stocks.filter(s=>prices.find(p=>normalizeType(p.lpg_type)===normalizeType(s.lpg_type))?.is_active===!0).length," tipe LPG aktif"]})]}),jsxRuntimeExports.jsx("div",{className:"w-20 h-20 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-sm",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Flame",className:"h-10 w-10"})})]})})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center bg-slate-100 rounded-xl p-1 gap-1 w-fit",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>setActiveTab("stock"),className:`flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-medium transition-all ${activeTab==="stock"?"bg-white shadow-sm text-blue-600":"text-slate-600 hover:text-slate-900"}`,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Package",className:"h-4 w-4"}),"Stok Saat Ini"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>setActiveTab("history"),className:`flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-medium transition-all ${activeTab==="history"?"bg-white shadow-sm text-blue-600":"text-slate-600 hover:text-slate-900"}`,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"History",className:"h-4 w-4"}),"Riwayat"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>setActiveTab("products"),className:`flex items-center gap-1.5 px-4 py-2 rounded-lg text-sm font-medium transition-all ${activeTab==="products"?"bg-white shadow-sm text-blue-600":"text-slate-600 hover:text-slate-900"}`,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Package",className:"h-4 w-4"}),"Kelola Produk"]})]}),activeTab==="stock"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"grid gap-4 grid-cols-2 lg:grid-cols-4",children:stocks.filter(stock=>prices.find(p=>normalizeType(p.lpg_type)===normalizeType(stock.lpg_type))?.is_active===!0).map(stock=>{const config=LPG_CONFIG[stock.lpg_type]||{name:stock.lpg_type,gradient:"from-slate-500 to-slate-600"},status=getStockStatus(stock);return jsxRuntimeExports.jsxs(Card,{className:"relative overflow-hidden bg-white shadow-lg border-0 hover:shadow-xl transition-all duration-300 hover:-translate-y-0.5",children:[jsxRuntimeExports.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-slate-100 rounded-full -translate-y-1/2 translate-x-1/2"}),jsxRuntimeExports.jsx(CardHeader,{className:"pb-2 relative",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-br ${config.gradient} flex items-center justify-center shadow-lg`,children:jsxRuntimeExports.jsx(SafeIcon,{name:"Flame",className:"h-6 w-6 text-white"})}),jsxRuntimeExports.jsx(Badge,{variant:"outline",className:status.color,children:status.label})]})}),jsxRuntimeExports.jsxs(CardContent,{className:"relative",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500 mb-1",children:config.name}),jsxRuntimeExports.jsxs("p",{className:"text-3xl font-bold text-slate-900",children:[stock.qty,jsxRuntimeExports.jsx("span",{className:"text-sm font-normal text-slate-400 ml-1",children:"tabung"})]}),jsxRuntimeExports.jsxs("div",{className:"mt-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-xs text-slate-400 mb-1",children:[jsxRuntimeExports.jsx("span",{children:"0"}),jsxRuntimeExports.jsxs("span",{children:["Kritis: ",stock.critical_level]}),jsxRuntimeExports.jsxs("span",{children:["Peringatan: ",stock.warning_level]})]}),jsxRuntimeExports.jsx("div",{className:"h-2 bg-slate-100 rounded-full overflow-hidden",children:jsxRuntimeExports.jsx("div",{className:`h-full rounded-full transition-all ${stock.status==="KRITIS"?"bg-red-500":stock.status==="RENDAH"?"bg-orange-500":"bg-green-500"}`,style:{width:`${Math.min(100,stock.qty/stock.warning_level*50)}%`}})})]})]})]},stock.id)})}),jsxRuntimeExports.jsxs(Card,{className:"bg-white shadow-lg rounded-2xl border-0 overflow-hidden",children:[jsxRuntimeExports.jsxs(CardHeader,{className:"border-b border-slate-100 bg-slate-50/50",children:[jsxRuntimeExports.jsxs(CardTitle,{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Zap",className:"h-4 w-4 text-purple-600"})}),"Aksi Cepat"]}),jsxRuntimeExports.jsx(CardDescription,{children:"Kelola stok dengan mudah"})]}),jsxRuntimeExports.jsx(CardContent,{className:"p-6",children:jsxRuntimeExports.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>setIsOrderOpen(!0),className:"flex items-center gap-4 p-4 rounded-xl border-2 border-dashed border-blue-200 bg-blue-50/50 hover:bg-blue-100 hover:border-blue-300 transition-all group",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-100 flex items-center justify-center group-hover:scale-110 transition-transform",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Truck",className:"h-6 w-6 text-blue-600"})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-slate-900",children:"Pesan ke Agen"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500",children:"Kirim pesanan LPG"})]})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>setIsReceiveOpen(!0),className:"flex items-center gap-4 p-4 rounded-xl border-2 border-dashed border-green-200 bg-green-50/50 hover:bg-green-100 hover:border-green-300 transition-all group",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center group-hover:scale-110 transition-transform",children:jsxRuntimeExports.jsx(SafeIcon,{name:"PackagePlus",className:"h-6 w-6 text-green-600"})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-slate-900",children:"Koreksi Stok"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500",children:"Penyesuaian manual (opname)"})]})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>toast.info("santai brader ðŸ˜­"),className:"flex items-center gap-4 p-4 rounded-xl border-2 border-dashed border-slate-200 bg-slate-50/50 hover:bg-slate-100 hover:border-slate-300 transition-all group",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-xl bg-slate-100 flex items-center justify-center group-hover:scale-110 transition-transform",children:jsxRuntimeExports.jsx(SafeIcon,{name:"ClipboardCheck",className:"h-6 w-6 text-slate-600"})}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-slate-900",children:"Stock Opname"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500",children:"Sesuaikan stok aktual"})]})]})]})})]}),jsxRuntimeExports.jsx(Card,{className:"bg-gradient-to-r from-green-50 to-emerald-50 border-green-200 shadow-lg rounded-2xl",children:jsxRuntimeExports.jsx(CardContent,{className:"p-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-4",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center flex-shrink-0",children:jsxRuntimeExports.jsx(SafeIcon,{name:"CheckCircle",className:"h-6 w-6 text-green-600"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-900 mb-1",children:"Stok Terintegrasi dengan Agen"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-slate-600 mb-3",children:["Stok otomatis bertambah saat pesanan dari agen berstatus ",jsxRuntimeExports.jsx("strong",{children:"SELESAI"})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Check",className:"h-4 w-4 text-green-500"}),jsxRuntimeExports.jsx("span",{children:"Stok masuk otomatis dari pesanan"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Check",className:"h-4 w-4 text-green-500"}),jsxRuntimeExports.jsx("span",{children:"Riwayat pergerakan tercatat"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Check",className:"h-4 w-4 text-green-500"}),jsxRuntimeExports.jsx("span",{children:"Sumber: ORDER (dari agen)"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-700",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Check",className:"h-4 w-4 text-green-500"}),jsxRuntimeExports.jsx("span",{children:"Koreksi manual tetap tersedia"})]})]})]})]})})})]}):activeTab==="history"?jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(Card,{className:"bg-white shadow-lg rounded-2xl border-0",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Filter",className:"h-4 w-4 text-slate-500"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Filter:"})]}),jsxRuntimeExports.jsxs(Select,{value:filterType,onValueChange:setFilterType,children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"w-[180px] rounded-xl",children:jsxRuntimeExports.jsx(SelectValue,{placeholder:"Semua Tipe"})}),jsxRuntimeExports.jsxs(SelectContent,{children:[jsxRuntimeExports.jsx(SelectItem,{value:"all",children:"Semua Tipe"}),jsxRuntimeExports.jsx(SelectItem,{value:"kg3",children:"LPG 3 kg"}),jsxRuntimeExports.jsx(SelectItem,{value:"kg5",children:"LPG 5.5 kg"}),jsxRuntimeExports.jsx(SelectItem,{value:"kg12",children:"LPG 12 kg"}),jsxRuntimeExports.jsx(SelectItem,{value:"kg50",children:"LPG 50 kg"})]})]}),jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",onClick:fetchMovements,className:"rounded-xl ml-auto",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"RefreshCw",className:"h-4 w-4 mr-2"}),"Refresh"]})]})})}),jsxRuntimeExports.jsx(Card,{className:"bg-white shadow-lg rounded-2xl border-0 overflow-hidden",children:jsxRuntimeExports.jsx(CardContent,{className:"p-0",children:isLoadingHistory?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-16",children:jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-200 border-t-blue-600"})}):movements.length===0?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-slate-500",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-100 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Inbox",className:"h-8 w-8 text-slate-300"})}),jsxRuntimeExports.jsx("p",{className:"font-medium",children:"Belum ada riwayat"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-400",children:"Pergerakan stok akan muncul di sini"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"w-full",children:[jsxRuntimeExports.jsx("thead",{className:"bg-slate-50 border-b",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"text-left p-4 text-xs font-semibold text-slate-600 uppercase tracking-wide",children:"Waktu"}),jsxRuntimeExports.jsx("th",{className:"text-left p-4 text-xs font-semibold text-slate-600 uppercase tracking-wide",children:"Tipe LPG"}),jsxRuntimeExports.jsx("th",{className:"text-left p-4 text-xs font-semibold text-slate-600 uppercase tracking-wide",children:"Jenis"}),jsxRuntimeExports.jsx("th",{className:"text-right p-4 text-xs font-semibold text-slate-600 uppercase tracking-wide",children:"Qty"}),jsxRuntimeExports.jsx("th",{className:"text-left p-4 text-xs font-semibold text-slate-600 uppercase tracking-wide",children:"Sumber"}),jsxRuntimeExports.jsx("th",{className:"text-left p-4 text-xs font-semibold text-slate-600 uppercase tracking-wide",children:"Catatan"})]})}),jsxRuntimeExports.jsx("tbody",{className:"divide-y divide-slate-100",children:paginatedMovements.map((mv,idx)=>{const config=LPG_CONFIG[mv.lpg_type]||{name:mv.lpg_type,color:"#666"},isIn=mv.movement_type==="MASUK"||mv.movement_type==="IN";return jsxRuntimeExports.jsxs("tr",{className:`hover:bg-slate-50 transition-colors ${idx%2===0?"bg-white":"bg-slate-50/50"}`,children:[jsxRuntimeExports.jsx("td",{className:"p-4 text-sm text-slate-600",children:formatDate(mv.movement_date)}),jsxRuntimeExports.jsx("td",{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:config.color}}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-slate-900",children:config.name})]})}),jsxRuntimeExports.jsx("td",{className:"p-4",children:jsxRuntimeExports.jsxs(Badge,{className:`${isIn?"bg-green-100 text-green-700":"bg-red-100 text-red-700"} border-0 rounded-full`,children:[jsxRuntimeExports.jsx(SafeIcon,{name:isIn?"ArrowDownCircle":"ArrowUpCircle",className:"h-3 w-3 mr-1"}),isIn?"MASUK":"KELUAR"]})}),jsxRuntimeExports.jsxs("td",{className:`p-4 text-right font-bold ${isIn?"text-green-600":"text-red-600"}`,children:[isIn?"+":"-",mv.qty]}),jsxRuntimeExports.jsx("td",{className:"p-4 text-sm text-slate-600",children:mv.source||"-"}),jsxRuntimeExports.jsx("td",{className:"p-4 text-sm text-slate-500 max-w-[200px] truncate",children:mv.note||"-"})]},mv.id)})})]})}),totalPages>1&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-slate-50",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-slate-600",children:["Menampilkan ",(currentPage-1)*itemsPerPage+1," - ",Math.min(currentPage*itemsPerPage,movements.length)," dari ",movements.length]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",onClick:()=>setCurrentPage(p=>Math.max(1,p-1)),disabled:currentPage===1,className:"rounded-lg",children:jsxRuntimeExports.jsx(SafeIcon,{name:"ChevronLeft",className:"h-4 w-4"})}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,totalPages)},(_,i)=>{let pageNum;return totalPages<=5||currentPage<=3?pageNum=i+1:currentPage>=totalPages-2?pageNum=totalPages-4+i:pageNum=currentPage-2+i,jsxRuntimeExports.jsx(Button,{variant:currentPage===pageNum?"default":"outline",size:"sm",onClick:()=>setCurrentPage(pageNum),className:`w-8 h-8 p-0 rounded-lg ${currentPage===pageNum?"bg-blue-600":""}`,children:pageNum},pageNum)})}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",onClick:()=>setCurrentPage(p=>Math.min(totalPages,p+1)),disabled:currentPage===totalPages,className:"rounded-lg",children:jsxRuntimeExports.jsx(SafeIcon,{name:"ChevronRight",className:"h-4 w-4"})})]})]})]})})})]}):activeTab==="products"?jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between bg-white rounded-2xl shadow-lg p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center shadow-lg",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Package",className:"h-5 w-5 text-white"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-bold text-slate-900",children:"Kelola Produk LPG"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500",children:"Produk dari Agen â€¢ Atur harga & ketersediaan"})]})]}),hasChanges?jsxRuntimeExports.jsx(Button,{onClick:handleSavePrices,disabled:isSaving,className:"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-xl shadow-lg shadow-green-500/25 animate-pulse",children:isSaving?jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"h-4 w-4 animate-spin"}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Save",className:"h-4 w-4 mr-2"}),"Simpan Perubahan"]})}):jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400 bg-slate-50 px-4 py-2 rounded-xl",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Check",className:"h-4 w-4 text-green-500"}),jsxRuntimeExports.jsx("span",{children:"Tersimpan"})]})]}),isLoadingPrices?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center py-16",children:jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-200 border-t-blue-600"})}):jsxRuntimeExports.jsx(ProductManagementGrid,{products:getAllDisplayProducts(),editedPrices,stocks,isSaving,onAddProduct:product=>handleAddProduct(product),onDeactivateProduct:handleDeactivateProduct,onUpdatePrice:updatePrice})]}):null]})}export{StokPangkalanPage as default};
