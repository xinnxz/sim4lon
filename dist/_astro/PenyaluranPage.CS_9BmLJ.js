import{j as jsxRuntimeExports}from"./jsx-runtime.mvtouYz0.js";import{r as reactExports}from"./index.DcciWILN.js";import{C as Card,a as CardContent,b as CardHeader,c as CardTitle}from"./card.D0gylVsf.js";import{S as SafeIcon,B as Button}from"./SafeIcon.CAGsavDo.js";import{S as Select,a as SelectTrigger,b as SelectValue,c as SelectContent,d as SelectItem}from"./select.Dd50uIHU.js";import{B as Badge}from"./badge.DZiJ6zSB.js";import{T as Tabs,a as TabsList,b as TabsTrigger,c as TabsContent}from"./tabs.BmAU3oNV.js";import{D as Dialog,a as DialogContent,b as DialogHeader,c as DialogTitle,d as DialogDescription}from"./dialog.CoJQQKDV.js";import{I as Input}from"./input.C9ryBhC0.js";import{L as Label}from"./label.BFF1cpbq.js";import{T as Textarea}from"./textarea.CmILhP_C.js";import{D as DropdownMenu,a as DropdownMenuTrigger,b as DropdownMenuContent,c as DropdownMenuItem}from"./dropdown-menu.CyUKnKxT.js";import{pangkalanApi,lpgProductsApi,penyaluranApi}from"./api.Dr7hS9Y8.js";import{t as toast}from"./index.fAd_ikgp.js";import{A as AnimatedNumber}from"./AnimatedNumber.DkDF6dXY.js";import{g as getAgenProfileFromAPI,e as exportPertaminaPDF,a as exportPertaminaExcel}from"./pertamina-export.CDr19N9R.js";import{P as PageHeader}from"./PageHeader.ChFr_oMu.js";import"./index.PIAPtHoh.js";import"./index.ubNQCTBn.js";import"./index.DGt6JTY0.js";import"./index.BpQ989z7.js";import"./index.BStXkqMp.js";import"./index.Drh0kMGk.js";import"./index.DZiLsHox.js";import"./index.Dovp0-D8.js";import"./index.YpXgcoRz.js";import"./index.BFpcrWlj.js";import"./index.9MihlNbL.js";import"./index.BhA3i5Wo.js";import"./index.BaF2FVWY.js";import"./chevron-up.BBBXIirx.js";import"./check.TUgVKQyo.js";import"./index.DQDOfy24.js";import"./index.CdmyERTi.js";import"./index.zVS-qTD4.js";import"./x.DUlMVzh7.js";import"./chevron-right.oaN48PMp.js";import"./jspdf.plugin.autotable.tHrVzh7j.js";import"./logo-pertamina.CveLq9KN.js";function PenyaluranPage(){const getInitialTab=()=>{if(typeof window<"u"){const hash=window.location.hash.replace("#","");if(["form","rekapitulasi"].includes(hash))return hash}return"rekapitulasi"},[activeTab,setActiveTab]=reactExports.useState(getInitialTab),handleTabChange=value=>{setActiveTab(value),typeof window<"u"&&window.history.replaceState(null,"",`#${value}`)},[selectedCategory,setSelectedCategory]=reactExports.useState("SUBSIDI"),[selectedMonth,setSelectedMonth]=reactExports.useState(()=>{const now=new Date;return`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,"0")}`}),[tipePembayaran,setTipePembayaran]=reactExports.useState("ALL"),[kondisi,setKondisi]=reactExports.useState("ALL"),[selectedLpgType,setSelectedLpgType]=reactExports.useState("kg3"),[rekapData,setRekapData]=reactExports.useState(null),[lpgProducts,setLpgProducts]=reactExports.useState([]),[isLoading,setIsLoading]=reactExports.useState(!1),[showFakultatifModal,setShowFakultatifModal]=reactExports.useState(!1),[pangkalanList,setPangkalanList]=reactExports.useState([]),[isSavingFakultatif,setIsSavingFakultatif]=reactExports.useState(!1),[fakultatifForm,setFakultatifForm]=reactExports.useState({pangkalan_id:"",tanggal:new Date().toISOString().split("T")[0],jumlah:"",catatan:""}),fetchLpgProducts=async()=>{try{const products=await lpgProductsApi.getAll();setLpgProducts(products.filter(p=>p.is_active))}catch(error){console.error("Error fetching LPG products:",error),setLpgProducts([])}},isSubsidi=selectedCategory==="SUBSIDI",lpgTypeOptions=reactExports.useMemo(()=>{const sizeToLpgType=size=>size<=.3?"gr220":Math.abs(size-3)<.1?"kg3":Math.abs(size-5.5)<.1||Math.abs(size-5)<.1?"kg5":Math.abs(size-12)<.1?"kg12":Math.abs(size-50)<.1?"kg50":`kg${Math.floor(size)}`;return lpgProducts.length>0?lpgProducts.filter(p=>selectedCategory==="SUBSIDI"?p.category==="SUBSIDI":p.category!=="SUBSIDI").map(p=>({value:sizeToLpgType(Number(p.size_kg)),label:p.name,description:p.category==="SUBSIDI"?"Subsidi":"Non-Subsidi"})):selectedCategory==="SUBSIDI"?[{value:"kg3",label:"LPG 3 KG",description:"Subsidi"}]:[]},[lpgProducts,selectedCategory]);reactExports.useEffect(()=>{lpgTypeOptions.length>0&&!lpgTypeOptions.find(o=>o.value===selectedLpgType)&&setSelectedLpgType(lpgTypeOptions[0].value)},[lpgTypeOptions]);const fetchRekapitulasi=async()=>{setIsLoading(!0);try{const data=await penyaluranApi.getRekapitulasi(selectedMonth,tipePembayaran!=="ALL"?tipePembayaran:void 0,selectedLpgType);setRekapData(data)}catch(error){console.error("Error fetching penyaluran rekapitulasi:",error);const[year,month]=selectedMonth.split("-").map(Number),daysInMonth=new Date(year,month,0).getDate();setRekapData({bulan:selectedMonth,days_in_month:daysInMonth,data:[]})}finally{setIsLoading(!1)}};reactExports.useEffect(()=>{fetchLpgProducts()},[]),reactExports.useEffect(()=>{showFakultatifModal&&pangkalanList.length===0&&pangkalanApi.getAll(1,100,void 0,!0).then(res=>{setPangkalanList(res.data)}).catch(err=>{console.error("Failed to fetch pangkalan:",err),toast.error("Gagal memuat daftar pangkalan")})},[showFakultatifModal]);const handleSaveFakultatif=async()=>{if(!fakultatifForm.pangkalan_id){toast.error("Pilih pangkalan terlebih dahulu");return}if(!fakultatifForm.jumlah||parseInt(fakultatifForm.jumlah)<=0){toast.error("Jumlah harus lebih dari 0");return}if(!fakultatifForm.catatan.trim()){toast.error("Catatan/alasan wajib diisi untuk penyaluran fakultatif");return}setIsSavingFakultatif(!0);try{await penyaluranApi.createFakultatif({pangkalan_id:fakultatifForm.pangkalan_id,tanggal:fakultatifForm.tanggal,lpg_type:selectedLpgType,jumlah:parseInt(fakultatifForm.jumlah),kondisi:"FAKULTATIF",catatan:fakultatifForm.catatan}),toast.success("Penyaluran fakultatif berhasil disimpan"),setShowFakultatifModal(!1),setFakultatifForm({pangkalan_id:"",tanggal:new Date().toISOString().split("T")[0],jumlah:"",catatan:""}),fetchRekapitulasi()}catch(error){toast.error(error.message||"Gagal menyimpan penyaluran fakultatif")}finally{setIsSavingFakultatif(!1)}};reactExports.useEffect(()=>{fetchRekapitulasi()},[selectedMonth,tipePembayaran,selectedLpgType]);const handleDownloadPDF=async()=>{if(!rekapData||rekapData.data.length===0){toast.error("Tidak ada data untuk di-download");return}try{toast.loading("Generating PDF...",{id:"pdf-export"});const exportData=rekapData.data.map(row=>({id_registrasi:row.id_registrasi,nama_pangkalan:row.nama_pangkalan,alokasi:row.alokasi,daily:row.daily,total_normal:row.total_normal,total_fakultatif:row.total_fakultatif,sisa_alokasi:row.sisa_alokasi,grand_total:row.grand_total})),agenProfile=await getAgenProfileFromAPI();await exportPertaminaPDF({bulan:selectedMonth,data:exportData,daysInMonth:rekapData.days_in_month,agenProfile,tipe:"penyaluran",lpgType:selectedLpgType,category:selectedCategory}),toast.success("PDF berhasil di-download!",{id:"pdf-export"})}catch(error){console.error("PDF export error:",error),toast.error("Gagal export PDF",{id:"pdf-export"})}},handleDownloadExcel=async()=>{if(!rekapData||rekapData.data.length===0){toast.error("Tidak ada data untuk di-download");return}try{toast.loading("Generating Excel...",{id:"excel-export"});const exportData=rekapData.data.map(row=>({id_registrasi:row.id_registrasi,nama_pangkalan:row.nama_pangkalan,alokasi:row.alokasi,daily:row.daily,total_normal:row.total_normal,total_fakultatif:row.total_fakultatif,sisa_alokasi:row.sisa_alokasi,grand_total:row.grand_total})),agenProfile=await getAgenProfileFromAPI();await exportPertaminaExcel({bulan:selectedMonth,data:exportData,daysInMonth:rekapData.days_in_month,agenProfile,tipe:"penyaluran",lpgType:selectedLpgType,category:selectedCategory}),toast.success("Excel berhasil di-download!",{id:"excel-export"})}catch(error){console.error("Excel export error:",error),toast.error("Gagal export Excel",{id:"excel-export"})}},tableScrollRef=reactExports.useRef(null);reactExports.useEffect(()=>{const container=tableScrollRef.current;if(!container)return;const handleWheel=e=>{if(e.deltaY===0)return;const atLeftEdge=container.scrollLeft<=0,atRightEdge=container.scrollLeft>=container.scrollWidth-container.clientWidth-1,scrollingUp=e.deltaY<0,scrollingDown=e.deltaY>0;atLeftEdge&&scrollingUp||atRightEdge&&scrollingDown||(e.preventDefault(),e.stopPropagation(),container.scrollLeft+=e.deltaY)};return container.addEventListener("wheel",handleWheel,{passive:!1}),()=>container.removeEventListener("wheel",handleWheel)},[]);const monthOptions=reactExports.useMemo(()=>{const options=[],now=new Date;for(let i=0;i<12;i++){const date=new Date(now.getFullYear(),now.getMonth()-i,1),value=`${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,"0")}`,label=date.toLocaleDateString("id-ID",{month:"long",year:"numeric"});options.push({value,label})}return options},[]),dayHeaders=reactExports.useMemo(()=>{if(!rekapData)return[];const[year,month]=selectedMonth.split("-").map(Number);return Array.from({length:rekapData.days_in_month},(_,i)=>{const day=i+1,date=new Date(year,month-1,day);return{day,dayName:["Min","Sen","Sel","Rab","Kam","Jum","Sab"][date.getDay()],isSunday:date.getDay()===0}})},[rekapData,selectedMonth]),summaryStats=reactExports.useMemo(()=>{if(!rekapData)return{totalPangkalan:0,totalAlokasi:0,totalRealisasi:0,sisaAlokasi:0,overAlokasi:0,nearLimit:0};const overAlokasi=rekapData.data.filter(r=>r.sisa_alokasi<0).length,nearLimit=rekapData.data.filter(r=>r.sisa_alokasi>=0&&r.sisa_alokasi<=r.alokasi*.2&&r.alokasi>0).length;return{totalPangkalan:rekapData.data.length,totalAlokasi:rekapData.data.reduce((sum,r)=>sum+r.alokasi,0),totalRealisasi:rekapData.data.reduce((sum,r)=>sum+r.grand_total,0),sisaAlokasi:rekapData.data.reduce((sum,r)=>sum+r.sisa_alokasi,0),overAlokasi,nearLimit}},[rekapData]),today=new Date().getDate(),currentMonth=`${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}`,isCurrentMonth=selectedMonth===currentMonth,isSunday=dayInfo=>dayInfo.isSunday;return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx(PageHeader,{title:"Penyaluran",subtitle:"Input dan rekapitulasi penyaluran harian"}),jsxRuntimeExports.jsxs(Tabs,{value:activeTab,onValueChange:handleTabChange,children:[jsxRuntimeExports.jsxs(TabsList,{className:"glass-card p-1 mb-4",children:[jsxRuntimeExports.jsxs(TabsTrigger,{value:"rekapitulasi",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-500 data-[state=active]:text-white",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Table",className:"w-4 h-4 mr-2"}),"Rekapitulasi"]}),jsxRuntimeExports.jsxs(TabsTrigger,{value:"form",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-green-500 data-[state=active]:to-emerald-500 data-[state=active]:text-white",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Edit",className:"w-4 h-4 mr-2"}),"Input Form"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 mb-3",children:[jsxRuntimeExports.jsxs(Button,{variant:selectedCategory==="SUBSIDI"?"default":"outline",className:selectedCategory==="SUBSIDI"?"bg-gradient-to-r from-blue-600 to-blue-500 text-white border-0 shadow-lg":"hover:bg-blue-50 dark:hover:bg-blue-900/20",onClick:()=>setSelectedCategory("SUBSIDI"),children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Shield",className:"w-4 h-4 mr-2"}),"LPG Subsidi"]}),jsxRuntimeExports.jsxs(Button,{variant:selectedCategory==="NON_SUBSIDI"?"default":"outline",className:selectedCategory==="NON_SUBSIDI"?"bg-gradient-to-r from-amber-500 to-orange-500 text-white border-0 shadow-lg":"hover:bg-amber-50 dark:hover:bg-amber-900/20",onClick:()=>setSelectedCategory("NON_SUBSIDI"),children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Flame",className:"w-4 h-4 mr-2"}),"LPG Non-Subsidi"]})]}),lpgTypeOptions.length>0?jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:lpgTypeOptions.map(opt=>jsxRuntimeExports.jsx(Button,{variant:selectedLpgType===opt.value?"default":"outline",size:"sm",className:selectedLpgType===opt.value?isSubsidi?"bg-gradient-to-r from-emerald-500 to-teal-500 text-white border-0":"bg-gradient-to-r from-amber-500 to-orange-500 text-white border-0":"hover:bg-muted",onClick:()=>setSelectedLpgType(opt.value),children:opt.label},opt.value))}):jsxRuntimeExports.jsxs("div",{className:"text-sm text-muted-foreground mb-4 p-3 bg-muted/50 rounded-lg",children:["Tidak ada produk LPG ",selectedCategory==="SUBSIDI"?"Subsidi":"Non-Subsidi"," yang aktif"]}),jsxRuntimeExports.jsx(Card,{className:"glass-card mb-6",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Bulan:"}),jsxRuntimeExports.jsxs(Select,{value:selectedMonth,onValueChange:setSelectedMonth,children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"w-44",children:jsxRuntimeExports.jsx(SelectValue,{})}),jsxRuntimeExports.jsx(SelectContent,{children:monthOptions.map(opt=>jsxRuntimeExports.jsx(SelectItem,{value:opt.value,children:opt.label},opt.value))})]})]}),selectedCategory==="SUBSIDI"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Kondisi:"}),jsxRuntimeExports.jsxs(Select,{value:kondisi,onValueChange:setKondisi,children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"w-32",children:jsxRuntimeExports.jsx(SelectValue,{})}),jsxRuntimeExports.jsxs(SelectContent,{children:[jsxRuntimeExports.jsx(SelectItem,{value:"ALL",children:"Semua"}),jsxRuntimeExports.jsx(SelectItem,{value:"NORMAL",children:"Normal"}),jsxRuntimeExports.jsx(SelectItem,{value:"FAKULTATIF",children:"Fakultatif"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Tipe:"}),jsxRuntimeExports.jsxs(Select,{value:tipePembayaran,onValueChange:setTipePembayaran,children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"w-28",children:jsxRuntimeExports.jsx(SelectValue,{})}),jsxRuntimeExports.jsxs(SelectContent,{children:[jsxRuntimeExports.jsx(SelectItem,{value:"ALL",children:"Semua"}),jsxRuntimeExports.jsx(SelectItem,{value:"CASHLESS",children:"Cashless"}),jsxRuntimeExports.jsx(SelectItem,{value:"CASH",children:"Cash"})]})]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 sm:ml-auto",children:[jsxRuntimeExports.jsxs(Button,{variant:"default",size:"sm",onClick:()=>setShowFakultatifModal(!0),className:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Plus",className:"w-4 h-4 mr-1"}),"Tambah Fakultatif"]}),jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",onClick:fetchRekapitulasi,disabled:isLoading,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"RefreshCw",className:`w-4 h-4 mr-1 ${isLoading?"animate-spin":""}`}),"Refresh"]}),jsxRuntimeExports.jsxs(DropdownMenu,{children:[jsxRuntimeExports.jsx(DropdownMenuTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Download",className:"w-4 h-4 mr-1"}),"Download",jsxRuntimeExports.jsx(SafeIcon,{name:"ChevronDown",className:"w-3 h-3 ml-1"})]})}),jsxRuntimeExports.jsxs(DropdownMenuContent,{align:"end",children:[jsxRuntimeExports.jsxs(DropdownMenuItem,{onClick:handleDownloadPDF,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"FileText",className:"w-4 h-4 mr-2"}),"Download PDF"]}),jsxRuntimeExports.jsxs(DropdownMenuItem,{onClick:handleDownloadExcel,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"FileSpreadsheet",className:"w-4 h-4 mr-2"}),"Download Excel"]})]})]})]})]})})}),jsxRuntimeExports.jsxs(TabsContent,{value:"rekapitulasi",children:[jsxRuntimeExports.jsxs("div",{className:`mb-6 ${isSubsidi?"grid gap-4 grid-cols-2 lg:grid-cols-5":"flex flex-wrap gap-4"}`,children:[jsxRuntimeExports.jsx(Card,{className:"glass-card",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"p-2 rounded-xl bg-blue-500/10",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Building2",className:"w-5 h-5 text-blue-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Pangkalan"}),jsxRuntimeExports.jsx("p",{className:"text-xl font-bold",children:jsxRuntimeExports.jsx(AnimatedNumber,{value:summaryStats.totalPangkalan,delay:100})})]})]})})}),isSubsidi&&jsxRuntimeExports.jsx(Card,{className:"glass-card",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"p-2 rounded-xl bg-green-500/10",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Target",className:"w-5 h-5 text-green-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Alokasi"}),jsxRuntimeExports.jsx("p",{className:"text-xl font-bold",children:jsxRuntimeExports.jsx(AnimatedNumber,{value:summaryStats.totalAlokasi,delay:200})})]})]})})}),jsxRuntimeExports.jsx(Card,{className:"glass-card",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"p-2 rounded-xl bg-purple-500/10",children:jsxRuntimeExports.jsx(SafeIcon,{name:"TrendingUp",className:"w-5 h-5 text-purple-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Penyaluran"}),jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-purple-600",children:jsxRuntimeExports.jsx(AnimatedNumber,{value:summaryStats.totalRealisasi,delay:300})})]})]})})}),isSubsidi&&jsxRuntimeExports.jsx(Card,{className:"glass-card",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"p-2 rounded-xl bg-orange-500/10",children:jsxRuntimeExports.jsx(SafeIcon,{name:"AlertCircle",className:"w-5 h-5 text-orange-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Sisa Alokasi"}),jsxRuntimeExports.jsx("p",{className:`text-xl font-bold ${summaryStats.sisaAlokasi<0?"text-red-500":"text-orange-600"}`,children:jsxRuntimeExports.jsx(AnimatedNumber,{value:summaryStats.sisaAlokasi,delay:400})})]})]})})}),isSubsidi&&jsxRuntimeExports.jsx(Card,{className:`glass-card ${summaryStats.overAlokasi>0?"border-red-500/50 bg-red-500/5":""}`,children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:`p-2 rounded-xl ${summaryStats.overAlokasi>0?"bg-red-500/20":"bg-green-500/10"}`,children:jsxRuntimeExports.jsx(SafeIcon,{name:summaryStats.overAlokasi>0?"AlertTriangle":"CheckCircle",className:`w-5 h-5 ${summaryStats.overAlokasi>0?"text-red-500":"text-green-500"}`})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Status Alokasi"}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:summaryStats.overAlokasi>0?jsxRuntimeExports.jsxs("span",{className:"text-sm font-bold text-red-500",children:["âš ï¸ ",summaryStats.overAlokasi," Over"]}):jsxRuntimeExports.jsx("span",{className:"text-sm font-bold text-green-500",children:"âœ… Aman"})})]})]})})})]}),jsxRuntimeExports.jsxs(Card,{className:"chart-card-premium",children:[jsxRuntimeExports.jsx(CardHeader,{className:"border-b border-border/50 pb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),jsxRuntimeExports.jsx(CardTitle,{className:"text-lg font-semibold",children:"Rekapitulasi Penyaluran"}),jsxRuntimeExports.jsx(Badge,{variant:"outline",className:"ml-auto bg-green-500/10 text-green-600 border-green-500/30",children:tipePembayaran==="ALL"?"Semua":tipePembayaran})]})}),jsxRuntimeExports.jsx(CardContent,{className:"p-0",children:jsxRuntimeExports.jsx("div",{ref:tableScrollRef,className:"overflow-x-auto scrollbar-thin-auto",style:{scrollBehavior:"auto"},children:jsxRuntimeExports.jsxs("table",{className:"w-full text-sm",children:[jsxRuntimeExports.jsx("thead",{className:"bg-muted/50 sticky top-0 z-20",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"sticky left-0 z-30 bg-muted px-3 py-3 text-left font-medium min-w-[120px] shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:"ID Registrasi"}),jsxRuntimeExports.jsx("th",{className:"sticky left-[120px] z-30 bg-muted px-3 py-3 text-left font-medium min-w-[180px] shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:"Nama Pangkalan"}),jsxRuntimeExports.jsx("th",{className:"px-3 py-3 text-center font-medium min-w-[60px]",children:"Status"}),isSubsidi&&jsxRuntimeExports.jsx("th",{className:"px-3 py-3 text-center font-medium min-w-[70px]",children:"Alokasi"}),dayHeaders.map(dayInfo=>{const weekClass=isSunday(dayInfo)?"bg-red-100 dark:bg-red-900/30":"",todayClass=isCurrentMonth&&dayInfo.day===today?"bg-primary/20 text-primary font-bold":"";return jsxRuntimeExports.jsxs("th",{className:`px-2 py-2 text-center font-medium min-w-[45px] ${weekClass} ${todayClass}`,children:[jsxRuntimeExports.jsx("div",{className:"text-xs",children:String(dayInfo.day).padStart(2,"0")}),jsxRuntimeExports.jsx("div",{className:`text-[10px] ${isSunday(dayInfo)?"text-red-500":"text-muted-foreground"}`,children:dayInfo.dayName})]},dayInfo.day)}),isSubsidi&&jsxRuntimeExports.jsx("th",{className:"px-3 py-3 text-center font-medium bg-green-500/10 min-w-[80px]",children:"Total Normal"}),isSubsidi&&jsxRuntimeExports.jsx("th",{className:"px-3 py-3 text-center font-medium bg-blue-500/10 min-w-[80px]",children:"Total Fakultatif"}),isSubsidi&&jsxRuntimeExports.jsx("th",{className:"px-3 py-3 text-center font-medium bg-orange-500/10 min-w-[80px]",children:"Sisa Alokasi"}),jsxRuntimeExports.jsx("th",{className:"px-3 py-3 text-center font-medium bg-purple-500/10 min-w-[80px]",children:isSubsidi?"Grand Total":"Total"})]})}),jsxRuntimeExports.jsx("tbody",{children:isLoading?jsxRuntimeExports.jsx("tr",{children:jsxRuntimeExports.jsxs("td",{colSpan:dayHeaders.length+8,className:"text-center py-8",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"w-6 h-6 animate-spin mx-auto mb-2"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Memuat data..."})]})}):rekapData?.data.length===0?jsxRuntimeExports.jsx("tr",{children:jsxRuntimeExports.jsx("td",{colSpan:dayHeaders.length+8,className:"text-center py-8 text-muted-foreground",children:"Tidak ada data"})}):rekapData?.data.map(row=>jsxRuntimeExports.jsxs("tr",{className:"border-b border-border/30 hover:bg-muted/30 transition-colors",children:[jsxRuntimeExports.jsx("td",{className:"sticky left-0 z-10 bg-background px-3 py-2 font-mono text-xs shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:row.id_registrasi}),jsxRuntimeExports.jsx("td",{className:"sticky left-[120px] z-10 bg-background px-3 py-2 font-medium shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:row.nama_pangkalan}),jsxRuntimeExports.jsx("td",{className:"px-3 py-2 text-center",children:jsxRuntimeExports.jsx(Badge,{variant:"outline",className:"bg-green-500/10 text-green-600 border-green-500/30 text-xs",children:row.status})}),isSubsidi&&jsxRuntimeExports.jsx("td",{className:"px-3 py-2 text-center font-medium",children:row.alokasi.toLocaleString()}),dayHeaders.map(dayInfo=>{const value=row.daily[dayInfo.day]||0,weekClass=isSunday(dayInfo)?"bg-red-50 dark:bg-red-900/20":"",todayClass=isCurrentMonth&&dayInfo.day===today?"bg-primary/10":"";return jsxRuntimeExports.jsx("td",{className:`px-2 py-2 text-center ${weekClass} ${todayClass}`,children:value===0?jsxRuntimeExports.jsx("span",{className:"text-muted-foreground/40",children:"-"}):jsxRuntimeExports.jsx("span",{className:"font-medium",children:value})},dayInfo.day)}),isSubsidi&&jsxRuntimeExports.jsx("td",{className:"px-3 py-2 text-center font-medium bg-green-500/5",children:row.total_normal.toLocaleString()}),isSubsidi&&jsxRuntimeExports.jsx("td",{className:"px-3 py-2 text-center font-medium bg-blue-500/5",children:row.total_fakultatif.toLocaleString()}),isSubsidi&&jsxRuntimeExports.jsxs("td",{className:`px-3 py-2 text-center font-bold ${row.sisa_alokasi<0?"bg-red-500/20 text-red-600 dark:text-red-400":"bg-orange-500/5"}`,children:[row.sisa_alokasi<0&&"âš ï¸ ",row.sisa_alokasi.toLocaleString()]}),jsxRuntimeExports.jsx("td",{className:"px-3 py-2 text-center font-bold bg-purple-500/5",children:row.grand_total.toLocaleString()})]},row.pangkalan_id))}),rekapData&&rekapData.data.length>0&&jsxRuntimeExports.jsx("tfoot",{className:"bg-muted/70 font-bold sticky bottom-0 z-20",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"sticky left-0 z-30 bg-muted px-3 py-3 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",colSpan:2,children:"Total"}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3"}),isSubsidi&&jsxRuntimeExports.jsx("td",{className:"px-3 py-3 text-center",children:rekapData.data.reduce((sum,r)=>sum+r.alokasi,0).toLocaleString()}),dayHeaders.map(dayInfo=>{const weekClass=isSunday(dayInfo)?"bg-red-100 dark:bg-red-900/30":"",todayClass=isCurrentMonth&&dayInfo.day===today?"bg-primary/20":"",total=rekapData.data.reduce((sum,r)=>sum+(r.daily[dayInfo.day]||0),0);return jsxRuntimeExports.jsx("td",{className:`px-2 py-3 text-center ${weekClass} ${todayClass}`,children:total===0?jsxRuntimeExports.jsx("span",{className:"text-muted-foreground/40",children:"-"}):total.toLocaleString()},dayInfo.day)}),isSubsidi&&jsxRuntimeExports.jsx("td",{className:"px-3 py-3 text-center bg-green-500/10",children:rekapData.data.reduce((sum,r)=>sum+r.total_normal,0).toLocaleString()}),isSubsidi&&jsxRuntimeExports.jsx("td",{className:"px-3 py-3 text-center bg-blue-500/10",children:rekapData.data.reduce((sum,r)=>sum+r.total_fakultatif,0).toLocaleString()}),isSubsidi&&jsxRuntimeExports.jsx("td",{className:"px-3 py-3 text-center bg-orange-500/10",children:rekapData.data.reduce((sum,r)=>sum+r.sisa_alokasi,0).toLocaleString()}),jsxRuntimeExports.jsx("td",{className:"px-3 py-3 text-center bg-purple-500/10",children:rekapData.data.reduce((sum,r)=>sum+r.grand_total,0).toLocaleString()})]})})]})})})]})]}),jsxRuntimeExports.jsx(TabsContent,{value:"form",children:jsxRuntimeExports.jsxs(Card,{className:"chart-card-premium",children:[jsxRuntimeExports.jsx(CardHeader,{className:"border-b border-border/50 pb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),jsxRuntimeExports.jsx(CardTitle,{className:"text-lg font-semibold",children:"Input Penyaluran"})]})}),jsxRuntimeExports.jsx(CardContent,{className:"p-6",children:jsxRuntimeExports.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Construction",className:"w-12 h-12 mx-auto mb-4 opacity-50"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-medium",children:"Fitur Input Form"}),jsxRuntimeExports.jsx("p",{className:"text-sm",children:"Coming soon - Kaleum nya lieur keneh. ðŸ˜­"})]})})]})})]}),jsxRuntimeExports.jsx(Dialog,{open:showFakultatifModal,onOpenChange:setShowFakultatifModal,children:jsxRuntimeExports.jsxs(DialogContent,{className:"max-w-md",children:[jsxRuntimeExports.jsxs(DialogHeader,{children:[jsxRuntimeExports.jsxs(DialogTitle,{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"AlertCircle",className:"w-5 h-5 text-amber-500"}),"Tambah Penyaluran Fakultatif"]}),jsxRuntimeExports.jsx(DialogDescription,{children:"Input penyaluran di luar kuota normal. Catatan wajib diisi sebagai alasan."})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs(Label,{htmlFor:"fak-pangkalan",children:["Pangkalan ",jsxRuntimeExports.jsx("span",{className:"text-destructive",children:"*"})]}),jsxRuntimeExports.jsxs(Select,{value:fakultatifForm.pangkalan_id,onValueChange:v=>setFakultatifForm({...fakultatifForm,pangkalan_id:v}),children:[jsxRuntimeExports.jsx(SelectTrigger,{id:"fak-pangkalan",children:jsxRuntimeExports.jsx(SelectValue,{placeholder:"Pilih pangkalan..."})}),jsxRuntimeExports.jsx(SelectContent,{children:pangkalanList.map(p=>jsxRuntimeExports.jsxs(SelectItem,{value:p.id,children:[p.code," - ",p.name]},p.id))})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Label,{children:"Jenis LPG"}),jsxRuntimeExports.jsx("div",{className:"px-3 py-2 rounded-md border bg-muted/50 text-sm",children:lpgTypeOptions.find(o=>o.value===selectedLpgType)?.label||selectedLpgType})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs(Label,{htmlFor:"fak-tanggal",children:["Tanggal ",jsxRuntimeExports.jsx("span",{className:"text-destructive",children:"*"})]}),jsxRuntimeExports.jsx(Input,{id:"fak-tanggal",type:"date",value:fakultatifForm.tanggal,onChange:e=>setFakultatifForm({...fakultatifForm,tanggal:e.target.value})})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs(Label,{htmlFor:"fak-jumlah",children:["Jumlah (Tabung) ",jsxRuntimeExports.jsx("span",{className:"text-destructive",children:"*"})]}),jsxRuntimeExports.jsx(Input,{id:"fak-jumlah",type:"number",min:"1",value:fakultatifForm.jumlah,onChange:e=>setFakultatifForm({...fakultatifForm,jumlah:e.target.value}),placeholder:"0"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs(Label,{htmlFor:"fak-catatan",children:["Catatan/Alasan ",jsxRuntimeExports.jsx("span",{className:"text-destructive",children:"*"})]}),jsxRuntimeExports.jsx(Textarea,{id:"fak-catatan",value:fakultatifForm.catatan,onChange:e=>setFakultatifForm({...fakultatifForm,catatan:e.target.value}),placeholder:"Contoh: Permintaan darurat untuk event...",rows:3}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Wajib diisi sebagai audit trail"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:()=>setShowFakultatifModal(!1),children:"Batal"}),jsxRuntimeExports.jsxs(Button,{onClick:handleSaveFakultatif,disabled:isSavingFakultatif||!fakultatifForm.pangkalan_id||!fakultatifForm.jumlah||!fakultatifForm.catatan.trim(),className:"bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600",children:[isSavingFakultatif?jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"w-4 h-4 mr-2 animate-spin"}):jsxRuntimeExports.jsx(SafeIcon,{name:"Check",className:"w-4 h-4 mr-2"}),"Simpan"]})]})]})})]})}export{PenyaluranPage as default};
