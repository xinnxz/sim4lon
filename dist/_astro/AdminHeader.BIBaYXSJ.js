import{S as SafeIcon,B as Button,_ as __vitePreload}from"./SafeIcon.CAGsavDo.js";import{j as jsxRuntimeExports}from"./jsx-runtime.mvtouYz0.js";import{r as reactExports}from"./index.DcciWILN.js";import{D as DropdownMenu,a as DropdownMenuTrigger,b as DropdownMenuContent,d as DropdownMenuLabel,e as DropdownMenuSeparator,c as DropdownMenuItem}from"./dropdown-menu.CyUKnKxT.js";import{A as Avatar,a as AvatarImage,b as AvatarFallback}from"./avatar.LDOJxY28.js";import{B as Badge}from"./badge.DZiJ6zSB.js";import{D as Dialog,a as DialogContent,b as DialogHeader,c as DialogTitle,d as DialogDescription}from"./dialog.CoJQQKDV.js";import{S as ScrollArea}from"./scroll-area.c5h9qjqr.js";import{notificationApi,agenPangkalanOrdersApi,authApi,removeToken}from"./api.Dr7hS9Y8.js";import{t as toast}from"./index.fAd_ikgp.js";import{C as ConfirmationModal}from"./ConfirmationModal.Ck8mepRg.js";import{c as clearCachedProfile}from"./AuthGuard.DKm2IuCP.js";import{u as useSidebar}from"./sidebar.OOywN5Va.js";import"./index.BpQ989z7.js";import"./index.PIAPtHoh.js";import"./index.ubNQCTBn.js";import"./index.YpXgcoRz.js";import"./index.Dovp0-D8.js";import"./index.BStXkqMp.js";import"./index.Drh0kMGk.js";import"./index.DZiLsHox.js";import"./index.BFpcrWlj.js";import"./index.9MihlNbL.js";import"./index.CdmyERTi.js";import"./index.DQDOfy24.js";import"./chevron-right.oaN48PMp.js";import"./check.TUgVKQyo.js";import"./index.zVS-qTD4.js";import"./x.DUlMVzh7.js";import"./index.DGt6JTY0.js";import"./input.C9ryBhC0.js";import"./separator.bhOikD5L.js";import"./skeleton.CCqcM_wt.js";import"./index.BaF2FVWY.js";import"./panel-left.C6TFiotF.js";function NotificationModal({open,onOpenChange}){const[notifications,setNotifications]=reactExports.useState([]),[isLoading,setIsLoading]=reactExports.useState(!0),[processingId,setProcessingId]=reactExports.useState(null);reactExports.useEffect(()=>{open&&fetchNotifications()},[open]);const fetchNotifications=async()=>{try{setIsLoading(!0);const response=await notificationApi.getNotifications(20);setNotifications(response.notifications)}catch(error){console.error("Failed to fetch notifications:",error)}finally{setIsLoading(!1)}},handleNotificationClick=notification=>{notification.link&&(window.location.href=notification.link)},handleAcceptOrder=async(e,notification)=>{if(e.stopPropagation(),!!notification.orderId)try{setProcessingId(notification.id),await agenPangkalanOrdersApi.confirm(notification.orderId),toast.success("Pesanan berhasil dikonfirmasi!"),setNotifications(prev=>prev.filter(n=>n.id!==notification.id))}catch(error){toast.error(error.message||"Gagal mengkonfirmasi pesanan")}finally{setProcessingId(null)}},handleRejectOrder=async(e,notification)=>{if(e.stopPropagation(),!!notification.orderId)try{setProcessingId(notification.id),await agenPangkalanOrdersApi.cancel(notification.orderId),toast.success("Pesanan ditolak"),setNotifications(prev=>prev.filter(n=>n.id!==notification.id))}catch(error){toast.error(error.message||"Gagal menolak pesanan")}finally{setProcessingId(null)}},getPriorityConfig=priority=>{switch(priority){case"critical":return{badge:"bg-rose-500/10 text-rose-600 dark:text-rose-400 border-rose-500/20",icon:"bg-rose-500/10 dark:bg-rose-500/15",iconColor:"text-rose-600 dark:text-rose-400",label:"Kritis!",dot:"bg-rose-500"};case"high":return{badge:"bg-amber-500/10 text-amber-600 dark:text-amber-400 border-amber-500/20",icon:"bg-amber-500/10 dark:bg-amber-500/15",iconColor:"text-amber-600 dark:text-amber-400",label:"Penting",dot:"bg-amber-500"};case"medium":return{badge:"bg-primary/10 text-primary border-primary/20",icon:"bg-primary/10 dark:bg-primary/15",iconColor:"text-primary",label:"Info",dot:"bg-primary"};default:return{badge:"bg-muted text-muted-foreground border-border",icon:"bg-muted",iconColor:"text-muted-foreground",label:"",dot:"bg-muted-foreground"}}};return jsxRuntimeExports.jsx(Dialog,{open,onOpenChange,children:jsxRuntimeExports.jsxs(DialogContent,{className:"sm:max-w-md p-0 overflow-hidden",children:[jsxRuntimeExports.jsx("div",{className:"bg-gradient-to-r from-primary/5 to-primary/10 dark:from-primary/10 dark:to-primary/5 px-6 py-5 border-b border-border/50",children:jsxRuntimeExports.jsx(DialogHeader,{children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"h-10 w-10 rounded-xl bg-gradient-to-br from-primary to-primary/80 flex items-center justify-center shadow-lg shadow-primary/20",children:jsxRuntimeExports.jsx(SafeIcon,{name:"Bell",className:"h-5 w-5 text-white"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(DialogTitle,{className:"text-lg font-bold",children:"Notifikasi"}),jsxRuntimeExports.jsx(DialogDescription,{className:"text-sm",children:isLoading?"Memuat...":notifications.length>0?`${notifications.length} notifikasi aktif`:"Tidak ada notifikasi"})]})]})})}),jsxRuntimeExports.jsx(ScrollArea,{className:"h-[400px]",children:jsxRuntimeExports.jsx("div",{className:"px-4 py-3 space-y-1",children:isLoading?jsxRuntimeExports.jsx("div",{className:"space-y-3",children:[1,2,3].map(i=>jsxRuntimeExports.jsxs("div",{className:"flex gap-3 p-3 animate-pulse",children:[jsxRuntimeExports.jsx("div",{className:"h-10 w-10 rounded-xl bg-muted"}),jsxRuntimeExports.jsxs("div",{className:"flex-1 space-y-2",children:[jsxRuntimeExports.jsx("div",{className:"h-4 bg-muted rounded w-3/4"}),jsxRuntimeExports.jsx("div",{className:"h-3 bg-muted rounded w-1/2"})]})]},i))}):notifications.length===0?jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[jsxRuntimeExports.jsx("div",{className:"h-16 w-16 rounded-full bg-muted/50 flex items-center justify-center mb-4",children:jsxRuntimeExports.jsx(SafeIcon,{name:"BellOff",className:"h-8 w-8 text-muted-foreground/50"})}),jsxRuntimeExports.jsx("p",{className:"font-medium text-foreground",children:"Tidak ada notifikasi"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Semua sudah dibaca!"})]}):notifications.map((notification,index)=>{const config=getPriorityConfig(notification.priority),isAgenOrder=notification.type==="agen_order",isProcessing=processingId===notification.id;return jsxRuntimeExports.jsxs("div",{onClick:()=>!isAgenOrder&&handleNotificationClick(notification),className:`flex gap-3 p-3 rounded-xl ${isAgenOrder?"":"cursor-pointer hover:bg-muted/50 active:bg-muted"} transition-all duration-200 group`,children:[jsxRuntimeExports.jsxs("div",{className:"relative flex-shrink-0",children:[jsxRuntimeExports.jsx("div",{className:`h-10 w-10 rounded-xl ${config.icon} flex items-center justify-center transition-colors`,children:jsxRuntimeExports.jsx(SafeIcon,{name:notification.icon,className:`h-5 w-5 ${config.iconColor}`})}),(notification.priority==="critical"||notification.priority==="high")&&jsxRuntimeExports.jsx("div",{className:`absolute -top-0.5 -right-0.5 h-2.5 w-2.5 rounded-full ${config.dot} ring-2 ring-background`})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-2 mb-0.5",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold text-foreground truncate group-hover:text-primary transition-colors",children:notification.title}),(notification.priority==="critical"||notification.priority==="high")&&jsxRuntimeExports.jsx(Badge,{variant:"outline",className:`shrink-0 text-[10px] px-1.5 py-0 ${config.badge}`,children:config.label})]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mb-1",children:notification.message}),jsxRuntimeExports.jsxs("p",{className:"text-[10px] text-muted-foreground/60 flex items-center gap-1",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Clock",className:"h-3 w-3"}),notification.time]}),isAgenOrder&&notification.orderId&&jsxRuntimeExports.jsxs("div",{className:"flex gap-2 mt-2",children:[jsxRuntimeExports.jsxs(Button,{size:"sm",variant:"default",className:"h-7 text-xs gap-1 bg-emerald-600 hover:bg-emerald-700",onClick:e=>handleAcceptOrder(e,notification),disabled:isProcessing,children:[isProcessing?jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"h-3 w-3 animate-spin"}):jsxRuntimeExports.jsx(SafeIcon,{name:"Check",className:"h-3 w-3"}),"Terima"]}),jsxRuntimeExports.jsxs(Button,{size:"sm",variant:"outline",className:"h-7 text-xs gap-1 text-rose-600 border-rose-300 hover:bg-rose-50 hover:text-rose-700",onClick:e=>handleRejectOrder(e,notification),disabled:isProcessing,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"X",className:"h-3 w-3"}),"Tolak"]})]})]}),!isAgenOrder&&jsxRuntimeExports.jsx("div",{className:"flex items-center opacity-0 group-hover:opacity-100 transition-opacity",children:jsxRuntimeExports.jsx(SafeIcon,{name:"ChevronRight",className:"h-4 w-4 text-muted-foreground"})})]},notification.id)})})}),jsxRuntimeExports.jsx("div",{className:"p-4 border-t border-border/50 bg-muted/30",children:jsxRuntimeExports.jsx(Button,{variant:"outline",className:"w-full gap-2 hover:bg-primary hover:text-white hover:border-primary transition-all duration-200",asChild:!0,children:jsxRuntimeExports.jsxs("a",{href:"/riwayat-aktivitas",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"History",className:"h-4 w-4"}),"Lihat Semua Aktivitas",jsxRuntimeExports.jsx(SafeIcon,{name:"ArrowRight",className:"h-4 w-4 ml-auto"})]})})})]})})}const API_BASE_URL="http://localhost:3000",getAvatarUrl=url=>{if(url)return url.startsWith("http")?url:`${API_BASE_URL}/api${url}`},PROFILE_CACHE_KEY="sim4lon_profile_cache",NOTIF_READ_KEY="sim4lon_last_notif_read";function MobileMenuButton(){try{const{toggleSidebar,openMobile}=useSidebar();return jsxRuntimeExports.jsx("button",{onClick:toggleSidebar,className:`md:hidden relative w-10 h-10 flex items-center justify-center rounded-xl \r
                   bg-gradient-to-br from-primary/10 to-primary/5 \r
                   hover:from-primary/20 hover:to-primary/10 \r
                   active:scale-95 transition-all duration-300 \r
                   border border-primary/20 shadow-sm`,"aria-label":"Toggle menu",children:jsxRuntimeExports.jsxs("div",{className:"w-5 h-4 flex flex-col justify-between",children:[jsxRuntimeExports.jsx("span",{className:`block h-0.5 bg-primary rounded-full transform transition-all duration-300 origin-left
                       ${openMobile?"rotate-45 translate-x-0.5 w-[22px]":"w-5"}`}),jsxRuntimeExports.jsx("span",{className:`block h-0.5 bg-primary rounded-full transition-all duration-300
                       ${openMobile?"opacity-0 translate-x-3":"w-4 opacity-100"}`}),jsxRuntimeExports.jsx("span",{className:`block h-0.5 bg-primary rounded-full transform transition-all duration-300 origin-left
                       ${openMobile?"-rotate-45 translate-x-0.5 w-[22px]":"w-5"}`})]})})}catch{return null}}function AdminHeader({userName:initialUserName="",userRole:initialUserRole="",notificationCount:initialCount=0}){const[showNotifications,setShowNotifications]=reactExports.useState(!1),[showLogoutConfirm,setShowLogoutConfirm]=reactExports.useState(!1),[isLoading,setIsLoading]=reactExports.useState(!0),[userName,setUserName]=reactExports.useState(()=>{if(typeof window<"u")try{const cached=localStorage.getItem(PROFILE_CACHE_KEY);if(cached)return JSON.parse(cached).name||initialUserName}catch{}return initialUserName}),[userRole,setUserRole]=reactExports.useState(()=>{if(typeof window<"u")try{const cached=localStorage.getItem(PROFILE_CACHE_KEY);if(cached)return JSON.parse(cached).role==="ADMIN"?"Administrator":"Operator"}catch{}return initialUserRole}),[avatarUrl,setAvatarUrl]=reactExports.useState(()=>{if(typeof window<"u")try{const cached=localStorage.getItem(PROFILE_CACHE_KEY);if(cached){const profile=JSON.parse(cached);return getAvatarUrl(profile.avatar_url)}}catch{}}),[notificationCount,setNotificationCount]=reactExports.useState(initialCount);reactExports.useEffect(()=>{(async()=>{try{const profile=await authApi.getProfile();setUserName(profile.name),setUserRole(profile.role==="ADMIN"?"Administrator":"Operator"),setAvatarUrl(getAvatarUrl(profile.avatar_url)),typeof window<"u"&&localStorage.setItem(PROFILE_CACHE_KEY,JSON.stringify(profile));const{notificationApi:notificationApi2}=await __vitePreload(async()=>{const{notificationApi:notificationApi3}=await import("./api.Dr7hS9Y8.js");return{notificationApi:notificationApi3}},[]),notifData=await notificationApi2.getNotifications(20),lastReadTime=localStorage.getItem(NOTIF_READ_KEY);if(lastReadTime){const lastRead=new Date(lastReadTime),unreadCount=notifData.notifications.filter(n=>new Date(n.time)>lastRead).length;setNotificationCount(unreadCount)}else setNotificationCount(notifData.unread_count)}catch(err){console.error("Failed to fetch data:",err)}finally{setIsLoading(!1)}})()},[]);const handleLogout=()=>{clearCachedProfile(),removeToken(),window.location.href="/login"},handleNotificationOpen=()=>{setShowNotifications(!0),notificationCount>0&&(setNotificationCount(0),typeof window<"u"&&localStorage.setItem(NOTIF_READ_KEY,new Date().toISOString()))},handleNotificationClose=open=>{setShowNotifications(open)};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-50 w-full border-b border-border bg-gradient-to-r from-background to-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 shadow-lg transition-all duration-300",id:"ijli",children:jsxRuntimeExports.jsxs("div",{className:"w-full flex h-16 items-center justify-between px-4 sm:px-6 lg:px-8",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[jsxRuntimeExports.jsx(MobileMenuButton,{}),jsxRuntimeExports.jsx("img",{src:"/logo-pertamina.png",alt:"Pertamina",className:"h-8 sm:h-10 object-contain dark:hidden transition-all duration-300"}),jsxRuntimeExports.jsx("img",{src:"/logo-pertamina-darkmode.png",alt:"Pertamina",className:"h-8 sm:h-10 object-contain hidden dark:block transition-all duration-300"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs(Button,{variant:"ghost",size:"icon",className:"relative h-10 w-10 rounded-xl hover:bg-muted/50 transition-all duration-200",onClick:handleNotificationOpen,"aria-label":"Notifikasi",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Bell",className:"h-5 w-5 text-muted-foreground"}),notificationCount>0&&jsxRuntimeExports.jsx(Badge,{variant:"destructive",className:"absolute -right-0.5 -top-0.5 h-5 w-5 rounded-full p-0 text-[10px] flex items-center justify-center font-bold shadow-lg",children:notificationCount>99?"99+":notificationCount})]}),jsxRuntimeExports.jsxs(DropdownMenu,{children:[jsxRuntimeExports.jsx(DropdownMenuTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{variant:"ghost",className:"flex items-center gap-3 px-3 py-2 h-auto rounded-xl hover:bg-muted/50 transition-all duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-primary to-primary/60 rounded-full opacity-75"}),jsxRuntimeExports.jsxs(Avatar,{className:"h-9 w-9 relative border-2 border-background",children:[jsxRuntimeExports.jsx(AvatarImage,{src:avatarUrl,alt:userName||"User"}),jsxRuntimeExports.jsx(AvatarFallback,{className:"bg-gradient-to-br from-primary to-primary/80 text-primary-foreground font-bold text-sm",children:userName?userName.split(" ").map(n=>n[0]).join("").toUpperCase().slice(0,2):".."})]})]}),jsxRuntimeExports.jsxs("div",{className:"hidden md:block text-left",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold text-foreground",children:userName||jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Loading..."})}),jsxRuntimeExports.jsx("p",{className:"text-[11px] text-muted-foreground font-medium",children:userRole||""})]}),jsxRuntimeExports.jsx(SafeIcon,{name:"ChevronDown",className:"h-4 w-4 hidden md:block text-muted-foreground"})]})}),jsxRuntimeExports.jsxs(DropdownMenuContent,{align:"end",className:"w-56 p-2",children:[jsxRuntimeExports.jsx(DropdownMenuLabel,{className:"font-normal px-2 py-2",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col space-y-1",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold",children:userName}),jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:userRole})]})}),jsxRuntimeExports.jsx(DropdownMenuSeparator,{}),jsxRuntimeExports.jsx(DropdownMenuItem,{asChild:!0,className:"rounded-lg cursor-pointer",children:jsxRuntimeExports.jsxs("a",{href:"/profil-admin",className:"flex items-center gap-2 px-2 py-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"User",className:"h-4 w-4 text-muted-foreground"}),jsxRuntimeExports.jsx("span",{children:"Profil Saya"})]})}),jsxRuntimeExports.jsx(DropdownMenuSeparator,{}),jsxRuntimeExports.jsxs(DropdownMenuItem,{onClick:()=>setShowLogoutConfirm(!0),className:"rounded-lg cursor-pointer text-destructive focus:text-destructive focus:bg-destructive/10",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"LogOut",className:"mr-2 h-4 w-4"}),jsxRuntimeExports.jsx("span",{children:"Keluar"})]})]})]})]})]})}),jsxRuntimeExports.jsx(NotificationModal,{open:showNotifications,onOpenChange:handleNotificationClose}),jsxRuntimeExports.jsx(ConfirmationModal,{open:showLogoutConfirm,onOpenChange:setShowLogoutConfirm,title:"Konfirmasi Keluar",description:"Apakah Anda yakin ingin keluar dari sistem?",confirmText:"Ya, Keluar",cancelText:"Batal",icon:"LogOut",iconColor:"text-primary",isDangerous:!1,onConfirm:handleLogout})]})}export{AdminHeader as default};
