const API_BASE_URL="http://localhost:3000/api",TOKEN_KEY="sim4lon_token";function getToken(){return typeof window>"u"?null:localStorage.getItem(TOKEN_KEY)}function setToken(token){typeof window>"u"||localStorage.setItem(TOKEN_KEY,token)}function removeToken(){typeof window>"u"||localStorage.removeItem(TOKEN_KEY)}function isAuthenticated(){return!!getToken()}async function apiRequest(endpoint,options={}){const token=getToken(),headers={"Content-Type":"application/json",...options.headers};token&&(headers.Authorization=`Bearer ${token}`);const response=await fetch(`${API_BASE_URL}${endpoint}`,{...options,headers}),data=await response.json();if(!response.ok)throw response.status===401&&(removeToken(),typeof window<"u"&&!window.location.pathname.includes("/login")&&(window.location.href="/login")),new Error(data.message||"Request failed");return data}const authApi={async login(data){const response=await apiRequest("/auth/login",{method:"POST",body:JSON.stringify(data)});return setToken(response.access_token),response},async getProfile(){return apiRequest("/auth/profile")},async updateProfile(data){return apiRequest("/auth/profile",{method:"PUT",body:JSON.stringify(data)})},async changePassword(data){return apiRequest("/auth/change-password",{method:"PUT",body:JSON.stringify(data)})},logout(){removeToken(),typeof window<"u"&&(window.location.href="/login")}},uploadApi={async uploadAvatar(file){const token=getToken(),formData=new FormData;formData.append("file",file);const response=await fetch(`${API_BASE_URL}/upload/avatar`,{method:"POST",headers:{Authorization:`Bearer ${token}`},body:formData}),data=await response.json();if(!response.ok)throw new Error(data.message||"Upload gagal");return data}},notificationApi={async getNotifications(limit=10){return apiRequest(`/notifications?limit=${limit}`)},async markAllAsRead(){return apiRequest("/notifications/mark-all-read",{method:"POST"})}},agenPangkalanOrdersApi={async getAll(status){const params=status&&status!=="all"?`?status=${status}`:"";return apiRequest(`/agen-orders/agen/all${params}`)},async getStats(){return apiRequest("/agen-orders/agen/stats")},async confirm(id){return apiRequest(`/agen-orders/agen/${id}/confirm`,{method:"PATCH"})},async complete(id,qtyReceived){return apiRequest(`/agen-orders/agen/${id}/complete`,{method:"PATCH",body:JSON.stringify({qty_received:qtyReceived})})},async cancel(id){return apiRequest(`/agen-orders/agen/${id}/cancel`,{method:"PATCH"})}},activityApi={async getAll(page=1,limit=20,type){const params=new URLSearchParams;return params.append("page",page.toString()),params.append("limit",limit.toString()),type&&type!=="all"&&params.append("type",type),apiRequest(`/activities?${params.toString()}`)},async getRecent(limit=10){return apiRequest(`/activities/recent?limit=${limit}`)},async getByType(type,limit=20){return apiRequest(`/activities/by-type?type=${type}&limit=${limit}`)}},companyProfileApi={async get(){return apiRequest("/company-profile")},async update(data){return apiRequest("/company-profile",{method:"PUT",body:JSON.stringify(data)})}},reportsApi={async getSalesReport(startDate,endDate){const params=new URLSearchParams;return startDate&&params.append("startDate",startDate),endDate&&params.append("endDate",endDate),apiRequest(`/reports/sales?${params.toString()}`)},async getPaymentsReport(startDate,endDate){const params=new URLSearchParams;return startDate&&params.append("startDate",startDate),endDate&&params.append("endDate",endDate),apiRequest(`/reports/payments?${params.toString()}`)},async getStockMovementReport(startDate,endDate,productId){const params=new URLSearchParams;return startDate&&params.append("startDate",startDate),endDate&&params.append("endDate",endDate),productId&&params.append("productId",productId),apiRequest(`/reports/stock-movement?${params.toString()}`)},async getPangkalanReport(startDate,endDate){const params=new URLSearchParams;return startDate&&params.append("startDate",startDate),endDate&&params.append("endDate",endDate),apiRequest(`/reports/pangkalan?${params.toString()}`)},async getSubsidiConsumers(pangkalanId,startDate,endDate){const params=new URLSearchParams;return startDate&&params.append("startDate",startDate),endDate&&params.append("endDate",endDate),apiRequest(`/reports/pangkalan/${pangkalanId}/consumers?${params.toString()}`)}},pangkalanApi={async getAll(page=1,limit=10,search,isActive){const params=new URLSearchParams;return params.append("page",page.toString()),params.append("limit",limit.toString()),search&&params.append("search",search),isActive!==void 0&&params.append("is_active",isActive.toString()),apiRequest(`/pangkalans?${params.toString()}`)},async getById(id){return apiRequest(`/pangkalans/${id}`)},async create(data){return apiRequest("/pangkalans",{method:"POST",body:JSON.stringify(data)})},async update(id,data){return apiRequest(`/pangkalans/${id}`,{method:"PUT",body:JSON.stringify(data)})},async delete(id){return apiRequest(`/pangkalans/${id}`,{method:"DELETE"})}},driversApi={async getAll(page=1,limit=10,search,isActive){const params=new URLSearchParams;return params.append("page",page.toString()),params.append("limit",limit.toString()),search&&params.append("search",search),isActive!==void 0&&params.append("is_active",isActive.toString()),apiRequest(`/drivers?${params.toString()}`)},async getById(id){return apiRequest(`/drivers/${id}`)},async create(data){return apiRequest("/drivers",{method:"POST",body:JSON.stringify(data)})},async update(id,data){return apiRequest(`/drivers/${id}`,{method:"PUT",body:JSON.stringify(data)})},async delete(id){return apiRequest(`/drivers/${id}`,{method:"DELETE"})}},lpgProductsApi={async getAll(includeInactive=!1){return apiRequest(`/lpg-products${includeInactive?"?includeInactive=true":""}`)},async getWithStock(){return apiRequest("/lpg-products/with-stock")},async getOne(id){return apiRequest(`/lpg-products/${id}`)},async create(data){return apiRequest("/lpg-products",{method:"POST",body:JSON.stringify(data)})},async update(id,data){return apiRequest(`/lpg-products/${id}`,{method:"PUT",body:JSON.stringify(data)})},async delete(id){return apiRequest(`/lpg-products/${id}`,{method:"DELETE"})},async addPrice(productId,data){return apiRequest(`/lpg-products/${productId}/prices`,{method:"POST",body:JSON.stringify(data)})},async updatePrice(priceId,data){return apiRequest(`/lpg-products/prices/${priceId}`,{method:"PUT",body:JSON.stringify(data)})},async deletePrice(priceId){return apiRequest(`/lpg-products/prices/${priceId}`,{method:"DELETE"})}},usersApi={async getAll(page=1,limit=10,search,excludeRoles){const params=new URLSearchParams;return params.append("page",page.toString()),params.append("limit",limit.toString()),search&&params.append("search",search),excludeRoles&&excludeRoles.length>0&&params.append("exclude_roles",excludeRoles.join(",")),apiRequest(`/users?${params.toString()}`)},async getById(id){return apiRequest(`/users/${id}`)},async create(data){return apiRequest("/users",{method:"POST",body:JSON.stringify(data)})},async update(id,data){return apiRequest(`/users/${id}`,{method:"PUT",body:JSON.stringify(data)})},async delete(id){return apiRequest(`/users/${id}`,{method:"DELETE"})},async resetPassword(id){return apiRequest(`/users/${id}/reset-password`,{method:"POST"})}},dashboardApi={async getStats(){return apiRequest("/dashboard/stats")},async getSalesChart(){return apiRequest("/dashboard/sales")},async getStockChart(){return apiRequest("/dashboard/stock")},async getProfitChart(){return apiRequest("/dashboard/profit")},async getTopPangkalan(){return apiRequest("/dashboard/top-pangkalan")},async getStockConsumption(){return apiRequest("/dashboard/stock-consumption")},async getRecentActivities(){return apiRequest("/dashboard/activities")}},ordersApi={async getAll(page=1,limit=10,status,pangkalanId,driverId,sortBy="created_at",sortOrder="desc"){const params=new URLSearchParams({page:page.toString(),limit:limit.toString()});return status&&params.append("status",status),pangkalanId&&params.append("pangkalan_id",pangkalanId),driverId&&params.append("driver_id",driverId),params.append("sort_by",sortBy),params.append("sort_order",sortOrder),apiRequest(`/orders?${params.toString()}`)},async getById(id){return apiRequest(`/orders/${id}`)},async create(dto){return apiRequest("/orders",{method:"POST",body:JSON.stringify(dto)})},async updateStatus(id,dto){return apiRequest(`/orders/${id}/status`,{method:"PATCH",body:JSON.stringify(dto)})},async update(id,dto){return apiRequest(`/orders/${id}`,{method:"PUT",body:JSON.stringify(dto)})},async delete(id){return apiRequest(`/orders/${id}`,{method:"DELETE"})},async getStats(todayOnly=!1){return apiRequest(`/orders/stats${todayOnly?"?today=true":""}`)}},paymentApi={async createRecord(dto){return apiRequest("/payments/records",{method:"POST",body:JSON.stringify(dto)})},async getRecords(page=1,limit=10,orderId,method){const params=new URLSearchParams({page:page.toString(),limit:limit.toString()});return orderId&&params.append("order_id",orderId),method&&params.append("method",method),apiRequest(`/payments/records?${params.toString()}`)},async getRecordById(id){return apiRequest(`/payments/records/${id}`)},async getOrderPayment(orderId){return apiRequest(`/payments/orders/${orderId}`)},async updateOrderPayment(orderId,dto){return apiRequest(`/payments/orders/${orderId}`,{method:"PUT",body:JSON.stringify(dto)})}},consumersApi={async getAll(page=1,limit=10,search){const params=new URLSearchParams({page:page.toString(),limit:limit.toString()});return search&&params.append("search",search),apiRequest(`/consumers?${params.toString()}`)},async getById(id){return apiRequest(`/consumers/${id}`)},async getStats(){return apiRequest("/consumers/stats")},async create(data){return apiRequest("/consumers",{method:"POST",body:JSON.stringify(data)})},async update(id,data){return apiRequest(`/consumers/${id}`,{method:"PUT",body:JSON.stringify(data)})},async delete(id){return apiRequest(`/consumers/${id}`,{method:"DELETE"})}},consumerOrdersApi={async getAll(page=1,limit=10,options){const params=new URLSearchParams({page:page.toString(),limit:limit.toString()});return options?.startDate&&params.append("startDate",options.startDate),options?.endDate&&params.append("endDate",options.endDate),options?.paymentStatus&&params.append("paymentStatus",options.paymentStatus),options?.consumerId&&params.append("consumerId",options.consumerId),apiRequest(`/consumer-orders?${params.toString()}`)},async getById(id){return apiRequest(`/consumer-orders/${id}`)},async getStats(todayOnly=!1){return apiRequest(`/consumer-orders/stats${todayOnly?"?today=true":""}`)},async getRecent(limit=5){return apiRequest(`/consumer-orders/recent?limit=${limit}`)},async create(data){return apiRequest("/consumer-orders",{method:"POST",body:JSON.stringify(data)})},async update(id,data){return apiRequest(`/consumer-orders/${id}`,{method:"PUT",body:JSON.stringify(data)})},async delete(id){return apiRequest(`/consumer-orders/${id}`,{method:"DELETE"})},async getChartData(){return apiRequest("/consumer-orders/chart-data")}},pangkalanStockApi={async getStockLevels(){return apiRequest("/pangkalan-stocks")},async getMovements(options){const params=new URLSearchParams;return options?.startDate&&params.append("startDate",options.startDate),options?.endDate&&params.append("endDate",options.endDate),options?.limit&&params.append("limit",options.limit.toString()),options?.lpgType&&params.append("lpgType",options.lpgType),apiRequest(`/pangkalan-stocks/movements?${params.toString()}`)},async receiveStock(data){return apiRequest("/pangkalan-stocks/receive",{method:"POST",body:JSON.stringify(data)})},async adjustStock(data){return apiRequest("/pangkalan-stocks/adjust",{method:"POST",body:JSON.stringify(data)})}},agenOrdersApi={async getOrders(status){const params=status&&status!=="all"?`?status=${status}`:"";return apiRequest(`/agen-orders${params}`)},async getStats(){return apiRequest("/agen-orders/stats")},async getOrder(id){return apiRequest(`/agen-orders/${id}`)},async createOrder(data){return apiRequest("/agen-orders",{method:"POST",body:JSON.stringify(data)})},async receiveOrder(id,data){return apiRequest(`/agen-orders/${id}/receive`,{method:"PATCH",body:JSON.stringify(data)})},async cancelOrder(id){return apiRequest(`/agen-orders/${id}/cancel`,{method:"PATCH"})}},expensesApi={async getAll(startDate,endDate){const params=new URLSearchParams;startDate&&params.append("startDate",startDate),endDate&&params.append("endDate",endDate);const queryString=params.toString();return apiRequest(`/expenses${queryString?`?${queryString}`:""}`)},async getById(id){return apiRequest(`/expenses/${id}`)},async create(data){return apiRequest("/expenses",{method:"POST",body:JSON.stringify(data)})},async update(id,data){return apiRequest(`/expenses/${id}`,{method:"PUT",body:JSON.stringify(data)})},async delete(id){return apiRequest(`/expenses/${id}`,{method:"DELETE"})},async getSummary(startDate,endDate){return apiRequest(`/expenses/summary?startDate=${startDate}&endDate=${endDate}`)}},lpgPricesApi={async getAll(){return apiRequest("/lpg-prices")},async update(id,data){return apiRequest(`/lpg-prices/${id}`,{method:"PUT",body:JSON.stringify(data)})},async bulkUpdate(prices){return apiRequest("/lpg-prices/bulk",{method:"POST",body:JSON.stringify({prices})})}},perencanaanApi={async getAll(params){const urlParams=new URLSearchParams;return params?.pangkalan_id&&urlParams.append("pangkalan_id",params.pangkalan_id),params?.bulan&&urlParams.append("bulan",params.bulan),params?.tanggal_awal&&urlParams.append("tanggal_awal",params.tanggal_awal),params?.tanggal_akhir&&urlParams.append("tanggal_akhir",params.tanggal_akhir),params?.kondisi&&urlParams.append("kondisi",params.kondisi),apiRequest(`/perencanaan?${urlParams.toString()}`)},async getRekapitulasi(bulan,kondisi,lpgType){const params=new URLSearchParams({bulan});return kondisi&&params.append("kondisi",kondisi),lpgType&&params.append("lpg_type",lpgType),apiRequest(`/perencanaan/rekapitulasi?${params.toString()}`)},async create(data){return apiRequest("/perencanaan",{method:"POST",body:JSON.stringify(data)})},async bulkUpdate(data){return apiRequest("/perencanaan/bulk",{method:"POST",body:JSON.stringify(data)})},async update(id,data){return apiRequest(`/perencanaan/${id}`,{method:"PUT",body:JSON.stringify(data)})},async delete(id){return apiRequest(`/perencanaan/${id}`,{method:"DELETE"})},async autoGenerate(data){return apiRequest("/perencanaan/auto-generate",{method:"POST",body:JSON.stringify(data)})}},penyaluranApi={async getAll(params){const urlParams=new URLSearchParams;return params?.pangkalan_id&&urlParams.append("pangkalan_id",params.pangkalan_id),params?.bulan&&urlParams.append("bulan",params.bulan),params?.tanggal_awal&&urlParams.append("tanggal_awal",params.tanggal_awal),params?.tanggal_akhir&&urlParams.append("tanggal_akhir",params.tanggal_akhir),params?.tipe_pembayaran&&urlParams.append("tipe_pembayaran",params.tipe_pembayaran),apiRequest(`/penyaluran?${urlParams.toString()}`)},async getRekapitulasi(bulan,tipePembayaran,lpgType){const params=new URLSearchParams({bulan});return tipePembayaran&&params.append("tipe_pembayaran",tipePembayaran),lpgType&&params.append("lpg_type",lpgType),apiRequest(`/penyaluran/rekapitulasi?${params.toString()}`)},async create(data){return apiRequest("/penyaluran",{method:"POST",body:JSON.stringify(data)})},async bulkUpdate(data){return apiRequest("/penyaluran/bulk",{method:"POST",body:JSON.stringify(data)})},async update(id,data){return apiRequest(`/penyaluran/${id}`,{method:"PUT",body:JSON.stringify(data)})},async delete(id){return apiRequest(`/penyaluran/${id}`,{method:"DELETE"})},async createFakultatif(data){return apiRequest("/penyaluran",{method:"POST",body:JSON.stringify({...data,tipe_pembayaran:"CASHLESS"})})}},penerimaanApi={async getAll(params){const urlParams=new URLSearchParams;return params?.bulan&&urlParams.append("bulan",params.bulan),params?.tanggal_awal&&urlParams.append("tanggal_awal",params.tanggal_awal),params?.tanggal_akhir&&urlParams.append("tanggal_akhir",params.tanggal_akhir),params?.sumber&&urlParams.append("sumber",params.sumber),params?.page&&urlParams.append("page",params.page.toString()),params?.limit&&urlParams.append("limit",params.limit.toString()),apiRequest(`/penerimaan?${urlParams.toString()}`)},async create(data){return apiRequest("/penerimaan",{method:"POST",body:JSON.stringify(data)})},async delete(id){return apiRequest(`/penerimaan/${id}`,{method:"DELETE"})},async getInOutAgen(bulan){return apiRequest(`/penerimaan/in-out-agen?bulan=${bulan}`)}};export{activityApi,agenOrdersApi,agenPangkalanOrdersApi,authApi,companyProfileApi,consumerOrdersApi,consumersApi,dashboardApi,driversApi,expensesApi,getToken,isAuthenticated,lpgPricesApi,lpgProductsApi,notificationApi,ordersApi,pangkalanApi,pangkalanStockApi,paymentApi,penerimaanApi,penyaluranApi,perencanaanApi,removeToken,reportsApi,setToken,uploadApi,usersApi};
