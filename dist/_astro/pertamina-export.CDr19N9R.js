import{_ as __vitePreload}from"./SafeIcon.CAGsavDo.js";import{E,a as autoTable,u as utils,w as writeFileSync}from"./jspdf.plugin.autotable.tHrVzh7j.js";import{p as pertaminaLogo}from"./logo-pertamina.CveLq9KN.js";const PERTAMINA_INFO={name:"PT. Pertamina (Persero)",address:"JL.Medan Merdeka Timur No. 1A Jakarta 10110",phone:"Telp: 021 3815111 FAX: 021 3633585"},loadImageAsBase64=url=>new Promise((resolve,reject)=>{const img=new Image;img.crossOrigin="Anonymous",img.onload=()=>{const canvas=document.createElement("canvas");canvas.width=img.width,canvas.height=img.height;const ctx=canvas.getContext("2d");ctx?(ctx.drawImage(img,0,0),resolve(canvas.toDataURL("image/png"))):reject(new Error("Cannot get canvas context"))},img.onerror=()=>reject(new Error("Failed to load image")),img.src=url}),downloadFile=(blob,filename)=>{const url=window.URL.createObjectURL(blob),a=document.createElement("a");a.style.display="none",a.href=url,a.download=filename,document.body.appendChild(a),a.click(),setTimeout(()=>{document.body.removeChild(a),window.URL.revokeObjectURL(url)},1500)},formatMonthLabel=bulan=>{const[year,month]=bulan.split("-").map(Number);return new Date(year,month-1,1).toLocaleDateString("id-ID",{month:"long",year:"numeric"}).toUpperCase()},exportPertaminaPDF=async options=>{const{bulan,data,daysInMonth,agenProfile,tipe}=options,doc=new E({orientation:"landscape",unit:"mm",format:"a4"}),pageWidth=doc.internal.pageSize.getWidth(),pageHeight=doc.internal.pageSize.getHeight(),margin=10;try{const logoData=pertaminaLogo,logoUrl=typeof logoData=="string"?logoData:logoData.src,logoBase64=await loadImageAsBase64(logoUrl);doc.addImage(logoBase64,"PNG",pageWidth-75,8,55,13)}catch(error){console.warn("[PDF Export] Could not load Pertamina logo:",error)}doc.setFontSize(11),doc.setFont("helvetica","bold"),doc.text(PERTAMINA_INFO.name,margin,15),doc.setFontSize(8),doc.setFont("helvetica","normal"),doc.text(PERTAMINA_INFO.address,margin,20),doc.text(PERTAMINA_INFO.phone,margin,25);const monthLabel=formatMonthLabel(bulan),getLpgDisplayName=lpgType=>lpgType?{kg3:"LPG 3 Kg",kg5:"LPG 5.5 Kg",kg12:"LPG 12 Kg",kg50:"LPG 50 Kg",gr220:"Bright Gas 220 gr"}[lpgType]||lpgType.toUpperCase():"",lpgInfo=options.lpgType?` - ${getLpgDisplayName(options.lpgType)}`:"",categoryInfo=options.category?options.category==="SUBSIDI"?" (SUBSIDI)":" (NON-SUBSIDI)":"",titleText=tipe==="perencanaan"?`LAPORAN PERENCANAAN PENYALURAN AGEN LPG KE SUB PENYALUR PERIODE ${monthLabel}${lpgInfo}${categoryInfo}`:`LAPORAN PENYALURAN AGEN LPG KE SUB PENYALUR PERIODE ${monthLabel}${lpgInfo}${categoryInfo}`;doc.setFontSize(9),doc.setFont("helvetica","bold"),doc.text(titleText,pageWidth/2,38,{align:"center"});let yPos=48;doc.setFontSize(8),doc.setFont("helvetica","normal"),[{label:"Nama Agen",value:agenProfile.nama_agen},{label:"Alamat Agen",value:agenProfile.alamat_agen},{label:"Email",value:agenProfile.email},{label:"No. Siid To",value:agenProfile.no_siid},{label:"Wilayah",value:agenProfile.wilayah}].forEach(field=>{doc.text(`${field.label}`,margin,yPos),doc.text(":",margin+25,yPos),doc.text(field.value,margin+28,yPos),yPos+=4}),yPos=72;const getDayName=date=>["Min","Sen","Sel","Rab","Kam","Jum","Sab"][date.getDay()],isSunday=date=>date.getDay()===0,[year,month]=bulan.split("-").map(Number),isSubsidi=options.category!=="NON_SUBSIDI",headers=isSubsidi?["Id","Nama pangkalan","Alokasi"]:["Id","Nama pangkalan"],sundayColumns=[],dateColStart=isSubsidi?3:2;for(let d=1;d<=daysInMonth;d++){const date=new Date(year,month-1,d),dayName=getDayName(date);headers.push(`${String(d).padStart(2,"0")}
${dayName}`),isSunday(date)&&sundayColumns.push(dateColStart+d-1)}isSubsidi?headers.push(`Total
Normal`,`Total
Fakultatif`,`Sisa
Alokasi`,`Grand
Total`):headers.push("Total");const tableData=data.map(row=>{const rowData=isSubsidi?[row.id_registrasi,row.nama_pangkalan,row.alokasi]:[row.id_registrasi,row.nama_pangkalan];for(let d=1;d<=daysInMonth;d++){const val=row.daily[d]||0;rowData.push(val)}return isSubsidi?rowData.push(row.total_normal,row.total_fakultatif,row.sisa_alokasi,row.grand_total):rowData.push(row.grand_total),rowData}),totals=isSubsidi?["","TOTAL",data.reduce((sum,r)=>sum+r.alokasi,0)]:["","TOTAL"];for(let d=1;d<=daysInMonth;d++){const dayTotal=data.reduce((sum,r)=>sum+(r.daily[d]||0),0);totals.push(dayTotal)}isSubsidi?totals.push(data.reduce((sum,r)=>sum+r.total_normal,0),data.reduce((sum,r)=>sum+r.total_fakultatif,0),data.reduce((sum,r)=>sum+r.sisa_alokasi,0),data.reduce((sum,r)=>sum+r.grand_total,0)):totals.push(data.reduce((sum,r)=>sum+r.grand_total,0)),tableData.push(totals);const colWidths=isSubsidi?{0:{cellWidth:13},1:{cellWidth:28,halign:"left"},2:{cellWidth:10}}:{0:{cellWidth:15},1:{cellWidth:35,halign:"left"}};for(let i=dateColStart;i<dateColStart+daysInMonth;i++)colWidths[i]={cellWidth:isSubsidi?5.5:6};const summaryStart=dateColStart+daysInMonth;isSubsidi?(colWidths[summaryStart]={cellWidth:12},colWidths[summaryStart+1]={cellWidth:12},colWidths[summaryStart+2]={cellWidth:12},colWidths[summaryStart+3]={cellWidth:12}):colWidths[summaryStart]={cellWidth:15},autoTable(doc,{startY:yPos,head:[headers],body:tableData,theme:"grid",styles:{fontSize:6,cellPadding:1,lineColor:[0,0,0],lineWidth:.1,halign:"center",valign:"middle",textColor:[0,0,0]},headStyles:{fillColor:[128,0,0],textColor:255,fontSize:6,fontStyle:"bold",halign:"center"},columnStyles:colWidths,alternateRowStyles:{fillColor:[255,255,255]},didParseCell:data2=>{data2.section==="body"&&data2.row.index===tableData.length-1&&(data2.cell.styles.fontStyle="bold",data2.cell.styles.fillColor=[240,240,240]),data2.section==="body"&&sundayColumns.includes(data2.column.index)&&(data2.cell.styles.fillColor=[255,230,230]),data2.section==="head"&&sundayColumns.includes(data2.column.index)&&(data2.cell.styles.fillColor=[180,0,0]),data2.section==="head"&&data2.column.index>=3&&data2.column.index<3+daysInMonth&&(data2.cell.styles.fontSize=5)},margin:{left:margin,right:margin}});let disclaimerY=(doc.lastAutoTable?.finalY||yPos+50)+8;disclaimerY>pageHeight-50&&(doc.addPage(),disclaimerY=20),doc.setFontSize(6),doc.setFont("helvetica","italic"),doc.text("Data tersebut diinput ke sistem sales LPG oleh agen LPG sebenar - benarnya dalam keadaan sehat lahir batin, apabila dikemudian hari data yang disampaikan terbukti tidak benar, maka agen LPG bersedia dikenakan sanksi sesuai peraturan dan hukum yang berlaku.Laporan ini dibuat oleh sistem",margin,disclaimerY,{maxWidth:pageWidth-margin*2});const signatureY=disclaimerY+12;doc.setFontSize(8),doc.setFont("helvetica","bold"),doc.text("Mengetahui",margin,signatureY),doc.text("PT.Pertamina(Persero)",margin,signatureY+4),doc.text("Penerima",pageWidth/2+20,signatureY),doc.text("Agen",pageWidth/2+20,signatureY+4);const lineY=signatureY+25;doc.setFontSize(7),doc.setFont("helvetica","normal"),doc.text("Nama :",margin,lineY),doc.line(margin+15,lineY,margin+60,lineY),doc.text("Jabatan :",margin,lineY+8),doc.line(margin+15,lineY+8,margin+60,lineY+8),doc.text("Nama :",pageWidth/2+20,lineY),doc.line(pageWidth/2+35,lineY,pageWidth/2+85,lineY),doc.text("Jabatan :",pageWidth/2+20,lineY+8),doc.line(pageWidth/2+35,lineY+8,pageWidth/2+85,lineY+8);const pageCount=doc.getNumberOfPages();for(let i=1;i<=pageCount;i++)doc.setPage(i),doc.setFontSize(7),doc.setFont("helvetica","normal"),doc.text(`Page ${i} of ${pageCount}`,pageWidth-margin-20,pageHeight-8);const filename=tipe==="perencanaan"?`Laporan_Perencanaan_${bulan}.pdf`:`Laporan_Penyaluran_${bulan}.pdf`,pdfBlob=doc.output("blob");downloadFile(pdfBlob,filename)},getAgenProfileFromAPI=async()=>{try{const{companyProfileApi}=await __vitePreload(async()=>{const{companyProfileApi:companyProfileApi2}=await import("./api.Dr7hS9Y8.js");return{companyProfileApi:companyProfileApi2}},[]),profile=await companyProfileApi.get();return{nama_agen:profile.company_name||"PT. MITRA SURYA NATASYA",alamat_agen:profile.address||"CHOBA RT.002 RW.006 DESA MAYAK",email:profile.email||"mitrasuryaanatasya@gmail.com",no_siid:profile.sppbe_number||"997904",wilayah:profile.region||"JAWA BARAT, KABUPATEN CIANJUR"}}catch(error){return console.warn("[PDF Export] Could not load profile from API, using fallback:",error),getDefaultAgenProfile()}},getDefaultAgenProfile=()=>{if(typeof window<"u"){const stored=localStorage.getItem("agen_profile");if(stored)try{return JSON.parse(stored)}catch{}}return{nama_agen:"PT. MITRA SURYA NATASYA",alamat_agen:"CHOBA RT.002 RW.006 DESA MAYAK",email:"mitrasuryaanatasya@gmail.com",no_siid:"997904",wilayah:"JAWA BARAT, KABUPATEN CIANJUR"}},formatMonthLabelExcel=bulan=>{const[year,month]=bulan.split("-").map(Number);return new Date(year,month-1,1).toLocaleDateString("id-ID",{month:"long",year:"numeric"}).toUpperCase()},exportPertaminaExcel=async options=>{const{bulan,data,daysInMonth,agenProfile,tipe}=options,[year,month]=bulan.split("-").map(Number),getDayName=date=>["Min","Sen","Sel","Rab","Kam","Jum","Sab"][date.getDay()],getLpgDisplayName=lpgType=>lpgType?{kg3:"LPG 3 Kg",kg5:"LPG 5.5 Kg",kg12:"LPG 12 Kg",kg50:"LPG 50 Kg",gr220:"Bright Gas 220 gr"}[lpgType]||lpgType.toUpperCase():"",wb=utils.book_new(),wsData=[],monthLabel=formatMonthLabelExcel(bulan),lpgInfo=options.lpgType?` - ${getLpgDisplayName(options.lpgType)}`:"",categoryInfo=options.category?options.category==="SUBSIDI"?" (SUBSIDI)":" (NON-SUBSIDI)":"",titleText=tipe==="perencanaan"?`LAPORAN PERENCANAAN PENYALURAN AGEN LPG KE SUB PENYALUR PERIODE ${monthLabel}${lpgInfo}${categoryInfo}`:`LAPORAN PENYALURAN AGEN LPG KE SUB PENYALUR PERIODE ${monthLabel}${lpgInfo}${categoryInfo}`;wsData.push([PERTAMINA_INFO.name]),wsData.push([PERTAMINA_INFO.address]),wsData.push([PERTAMINA_INFO.phone]),wsData.push([]),wsData.push([titleText]),wsData.push([]),(options.lpgType||options.category)&&(wsData.push(["Jenis LPG",":",getLpgDisplayName(options.lpgType)||"-"]),wsData.push(["Kategori",":",options.category==="SUBSIDI"?"Subsidi":options.category==="NON_SUBSIDI"?"Non-Subsidi":"-"])),wsData.push(["Nama Agen",":",agenProfile.nama_agen]),wsData.push(["Alamat Agen",":",agenProfile.alamat_agen]),wsData.push(["Email",":",agenProfile.email]),wsData.push(["No. Siid To",":",agenProfile.no_siid]),wsData.push(["Wilayah",":",agenProfile.wilayah]),wsData.push([]);const isSubsidi=options.category!=="NON_SUBSIDI",headers=isSubsidi?["Id","Nama Pangkalan","Alokasi"]:["Id","Nama Pangkalan"],dayHeaders=isSubsidi?["","",""]:["",""];for(let d=1;d<=daysInMonth;d++){const date=new Date(year,month-1,d);headers.push(String(d).padStart(2,"0")),dayHeaders.push(getDayName(date))}isSubsidi?(headers.push("Total Normal","Total Fakultatif","Sisa Alokasi","Grand Total"),dayHeaders.push("","","","")):(headers.push("Total"),dayHeaders.push("")),wsData.push(headers),wsData.push(dayHeaders),data.forEach(row=>{const rowData=isSubsidi?[row.id_registrasi,row.nama_pangkalan,row.alokasi]:[row.id_registrasi,row.nama_pangkalan];for(let d=1;d<=daysInMonth;d++)rowData.push(row.daily[d]||0);isSubsidi?rowData.push(row.total_normal,row.total_fakultatif,row.sisa_alokasi,row.grand_total):rowData.push(row.grand_total),wsData.push(rowData)});const totals=isSubsidi?["","TOTAL",data.reduce((sum,r)=>sum+r.alokasi,0)]:["","TOTAL"];for(let d=1;d<=daysInMonth;d++)totals.push(data.reduce((sum,r)=>sum+(r.daily[d]||0),0));isSubsidi?totals.push(data.reduce((sum,r)=>sum+r.total_normal,0),data.reduce((sum,r)=>sum+r.total_fakultatif,0),data.reduce((sum,r)=>sum+r.sisa_alokasi,0),data.reduce((sum,r)=>sum+r.grand_total,0)):totals.push(data.reduce((sum,r)=>sum+r.grand_total,0)),wsData.push(totals);const ws=utils.aoa_to_sheet(wsData),colWidths=isSubsidi?[{wch:12},{wch:25},{wch:8}]:[{wch:15},{wch:30}];for(let d=1;d<=daysInMonth;d++)colWidths.push({wch:isSubsidi?5:6});isSubsidi?colWidths.push({wch:10},{wch:12},{wch:10},{wch:10}):colWidths.push({wch:12}),ws["!cols"]=colWidths;const tableStartRow=12,totalRows=wsData.length,totalCols=headers.length;for(let r=tableStartRow;r<totalRows;r++)for(let c=0;c<totalCols;c++){const cellAddr=utils.encode_cell({r,c});ws[cellAddr]&&(ws[cellAddr].s||(ws[cellAddr].s={}),ws[cellAddr].s.border={top:{style:"thin",color:{rgb:"000000"}},bottom:{style:"thin",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}},c===1?ws[cellAddr].s.alignment={horizontal:"left",vertical:"center"}:ws[cellAddr].s.alignment={horizontal:"center",vertical:"center"})}const sheetName=tipe==="perencanaan"?"Perencanaan":"Penyaluran";utils.book_append_sheet(wb,ws,sheetName);const filename=tipe==="perencanaan"?`Laporan_Perencanaan_${bulan}.xlsx`:`Laporan_Penyaluran_${bulan}.xlsx`;writeFileSync(wb,filename)};export{exportPertaminaExcel as a,exportPertaminaPDF as e,getAgenProfileFromAPI as g};
