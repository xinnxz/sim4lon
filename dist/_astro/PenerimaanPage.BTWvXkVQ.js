import{j as jsxRuntimeExports}from"./jsx-runtime.mvtouYz0.js";import{r as reactExports}from"./index.DcciWILN.js";import{C as Card,a as CardContent,b as CardHeader,c as CardTitle}from"./card.D0gylVsf.js";import{B as Button,S as SafeIcon}from"./SafeIcon.CAGsavDo.js";import{I as Input}from"./input.C9ryBhC0.js";import{L as Label}from"./label.BFF1cpbq.js";import{S as Select,a as SelectTrigger,b as SelectValue,c as SelectContent,d as SelectItem}from"./select.Dd50uIHU.js";import{D as Dialog,a as DialogContent,b as DialogHeader,c as DialogTitle,d as DialogDescription}from"./dialog.CoJQQKDV.js";import{B as Badge}from"./badge.DZiJ6zSB.js";import{D as DropdownMenu,a as DropdownMenuTrigger,b as DropdownMenuContent,c as DropdownMenuItem}from"./dropdown-menu.CyUKnKxT.js";import{penerimaanApi,lpgProductsApi}from"./api.Dr7hS9Y8.js";import{t as toast}from"./index.fAd_ikgp.js";import{c as createFooterRow,e as exportToExcel}from"./export-utils.uYz9d_v0.js";import{E,a as autoTable}from"./jspdf.plugin.autotable.tHrVzh7j.js";import{p as pertaminaLogo}from"./logo-pertamina.CveLq9KN.js";import{g as getAgenProfileFromAPI}from"./pertamina-export.CDr19N9R.js";import{P as PageHeader}from"./PageHeader.ChFr_oMu.js";import"./index.PIAPtHoh.js";import"./index.ubNQCTBn.js";import"./index.DGt6JTY0.js";import"./index.BpQ989z7.js";import"./index.BStXkqMp.js";import"./index.Drh0kMGk.js";import"./index.DZiLsHox.js";import"./index.Dovp0-D8.js";import"./index.YpXgcoRz.js";import"./index.BFpcrWlj.js";import"./index.9MihlNbL.js";import"./index.BhA3i5Wo.js";import"./index.BaF2FVWY.js";import"./chevron-up.BBBXIirx.js";import"./check.TUgVKQyo.js";import"./index.zVS-qTD4.js";import"./index.CdmyERTi.js";import"./x.DUlMVzh7.js";import"./index.DQDOfy24.js";import"./chevron-right.oaN48PMp.js";const loadImageAsBase64=url=>new Promise((resolve,reject)=>{const img=new Image;img.crossOrigin="Anonymous",img.onload=()=>{const canvas=document.createElement("canvas");canvas.width=img.width,canvas.height=img.height;const ctx=canvas.getContext("2d");ctx?(ctx.drawImage(img,0,0),resolve(canvas.toDataURL("image/png"))):reject(new Error("Cannot get canvas context"))},img.onerror=()=>reject(new Error("Failed to load image")),img.src=url});function PenerimaanPage(){const[selectedMonth,setSelectedMonth]=reactExports.useState(()=>{const now=new Date;return`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,"0")}`}),[data,setData]=reactExports.useState(null),[isLoading,setIsLoading]=reactExports.useState(!1),[page,setPage]=reactExports.useState(1),[sortField,setSortField]=reactExports.useState("tanggal"),[sortOrder,setSortOrder]=reactExports.useState("desc"),[showAddModal,setShowAddModal]=reactExports.useState(!1),[products,setProducts]=reactExports.useState([]),[isSaving,setIsSaving]=reactExports.useState(!1),[headerData,setHeaderData]=reactExports.useState({no_so:"",no_lo:"",tanggal:new Date().toISOString().split("T")[0]}),[items,setItems]=reactExports.useState([{id:crypto.randomUUID(),lpg_product_id:"",qty_pcs:""}]),totals=reactExports.useMemo(()=>{let totalPcs=0,totalKg=0;return items.forEach(item=>{if(item.lpg_product_id&&item.qty_pcs){const product=products.find(p=>p.id===item.lpg_product_id),pcs=parseInt(item.qty_pcs)||0;totalPcs+=pcs,totalKg+=product?pcs*Number(product.size_kg):0}}),{totalPcs,totalKg}},[items,products]),fetchData=async()=>{setIsLoading(!0);try{const result=await penerimaanApi.getAll({bulan:selectedMonth,page,limit:25});setData(result)}catch{toast.error("Gagal memuat data penerimaan")}finally{setIsLoading(!1)}},fetchProducts=async()=>{try{const prods=await lpgProductsApi.getAll();setProducts(prods)}catch(error){console.error("Failed to fetch products:",error)}};reactExports.useEffect(()=>{fetchData()},[selectedMonth,page]),reactExports.useEffect(()=>{showAddModal&&products.length===0&&fetchProducts()},[showAddModal]);const monthOptions=reactExports.useMemo(()=>{const options=[],now=new Date;for(let i=0;i<12;i++){const date=new Date(now.getFullYear(),now.getMonth()-i,1),value=`${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,"0")}`,label=date.toLocaleDateString("id-ID",{month:"long",year:"numeric"});options.push({value,label})}return options},[]),sortedData=reactExports.useMemo(()=>data?.data?[...data.data].sort((a,b)=>{let aVal=a[sortField],bVal=b[sortField];return sortField==="tanggal"&&(aVal=new Date(aVal).getTime(),bVal=new Date(bVal).getTime()),(sortField==="qty_pcs"||sortField==="qty_kg")&&(aVal=Number(aVal)||0,bVal=Number(bVal)||0),typeof aVal=="string"&&(aVal=aVal.toLowerCase(),bVal=bVal.toLowerCase()),aVal<bVal?sortOrder==="asc"?-1:1:aVal>bVal?sortOrder==="asc"?1:-1:0}):[],[data?.data,sortField,sortOrder]),handleSort=field=>{sortField===field?setSortOrder(prev=>prev==="asc"?"desc":"asc"):(setSortField(field),setSortOrder("asc"))},SortIcon=({field})=>jsxRuntimeExports.jsx("span",{className:"ml-1 inline-flex",children:sortField===field?sortOrder==="asc"?jsxRuntimeExports.jsx(SafeIcon,{name:"ChevronUp",className:"w-4 h-4"}):jsxRuntimeExports.jsx(SafeIcon,{name:"ChevronDown",className:"w-4 h-4"}):jsxRuntimeExports.jsx(SafeIcon,{name:"ChevronsUpDown",className:"w-4 h-4 opacity-30"})}),formatDate=dateString=>new Date(dateString).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}),resetForm=()=>{setHeaderData({no_so:"",no_lo:"",tanggal:new Date().toISOString().split("T")[0]}),setItems([{id:crypto.randomUUID(),lpg_product_id:"",qty_pcs:""}])},addItem=()=>{setItems([...items,{id:crypto.randomUUID(),lpg_product_id:"",qty_pcs:""}])},removeItem=id=>{if(items.length===1){toast.error("Minimal harus ada 1 item");return}setItems(items.filter(item=>item.id!==id))},updateItem=(id,field,value)=>{setItems(items.map(item=>item.id===id?{...item,[field]:value}:item))},getAvailableProducts=currentItemId=>{const selectedIds=items.filter(item=>item.id!==currentItemId&&item.lpg_product_id).map(item=>item.lpg_product_id);return products.filter(p=>!selectedIds.includes(p.id))},handleSubmit=async()=>{if(!headerData.no_so||headerData.no_so.length!==10){toast.error("No. SO harus 10 digit");return}if(!headerData.no_lo||headerData.no_lo.length!==10){toast.error("No. LO harus 10 digit");return}const validItems=items.filter(item=>item.lpg_product_id&&parseInt(item.qty_pcs)>0);if(validItems.length===0){toast.error("Tambahkan minimal 1 item dengan jumlah valid");return}setIsSaving(!0);try{for(const item of validItems){const product=products.find(p=>p.id===item.lpg_product_id),qtyPcs=parseInt(item.qty_pcs),qtyKg=product?qtyPcs*Number(product.size_kg):0,sizeKg=product?Number(product.size_kg):3,namaMaterial=`REFILL/ISI LPG @${sizeKg<1?`${Math.round(sizeKg*1e3)}GR`:`${sizeKg}KG`} (NET)`;await penerimaanApi.create({no_so:headerData.no_so,no_lo:headerData.no_lo,nama_material:namaMaterial,qty_pcs:qtyPcs,qty_kg:qtyKg,tanggal:headerData.tanggal,sumber:"SPBE",lpg_product_id:item.lpg_product_id})}toast.success(`${validItems.length} penerimaan berhasil dicatat (Total: ${totals.totalPcs} tabung)`),setShowAddModal(!1),resetForm(),fetchData()}catch(error){toast.error(error.message||"Gagal menyimpan penerimaan")}finally{setIsSaving(!1)}},exportColumns=[{header:"Tanggal",key:"tanggal_formatted",width:12,align:"center"},{header:"No SO",key:"no_so",width:15,align:"left"},{header:"No LO",key:"no_lo",width:15,align:"left"},{header:"Nama Material",key:"nama_material",width:20,align:"left"},{header:"Qty Tabung",key:"qty_pcs",width:12,align:"center"},{header:"Qty Kg",key:"qty_kg",width:12,align:"center"}],handleDownloadPDF=async()=>{if(!data||data.data.length===0){toast.error("Tidak ada data untuk di-download");return}try{toast.loading("Generating PDF...",{id:"pdf-export"});const doc=new E({orientation:"portrait"}),pageWidth=doc.internal.pageSize.getWidth(),pageHeight=doc.internal.pageSize.getHeight(),margin=14,agenProfile=await getAgenProfileFromAPI();doc.setFont("helvetica","bold"),doc.setFontSize(10),doc.text("PT. Pertamina (Persero)",margin,15),doc.setFontSize(8),doc.text("Jl.Medan Merdeka Timur No. 1A Jakarta 10110",margin,20),doc.text("Telp: 021 3815111 FAX: 021 3633585",margin,25);try{const logoData=pertaminaLogo,logoUrl=typeof logoData=="string"?logoData:logoData.src,logoBase64=await loadImageAsBase64(logoUrl);doc.addImage(logoBase64,"PNG",pageWidth-55,10,40,10)}catch(logoError){console.warn("[PDF Export] Could not load Pertamina logo:",logoError)}const[year,month]=selectedMonth.split("-"),monthName=new Date(parseInt(year),parseInt(month)-1,1).toLocaleDateString("id-ID",{month:"long"}).toUpperCase();doc.setFontSize(11),doc.setFont("helvetica","bold"),doc.text("REKAPITULASI SURAT PENGANTAR PENGIRIMAN PRODUK",pageWidth/2,40,{align:"center"}),doc.text(`PSO PERIODE BULAN ${monthName} ${year}`,pageWidth/2,46,{align:"center"});let yPos=58;doc.setFontSize(8),doc.setFont("helvetica","normal"),[{label:"SP(P)BE",value:"-"},{label:"Kode Plant",value:"-"},{label:"Nama Agen",value:agenProfile.nama_agen},{label:"Alamat Agen",value:agenProfile.alamat_agen},{label:"Email",value:agenProfile.email},{label:"No. Sold To",value:agenProfile.no_siid},{label:"Wilayah",value:agenProfile.wilayah}].forEach(field=>{doc.text(`${field.label}`,margin,yPos),doc.text(":",margin+25,yPos),doc.text(field.value,margin+28,yPos),yPos+=4}),yPos+=5;const headers=["NO","Tanggal","No SO","No LO","Nama Material","Qty Pcs","Qty Kg"],totalPcs=sortedData.reduce((sum,item)=>sum+item.qty_pcs,0),totalKg=sortedData.reduce((sum,item)=>sum+Number(item.qty_kg),0),tableData=sortedData.map((item,index)=>[String(index+1),formatDate(item.tanggal),item.no_so,item.no_lo,item.nama_material,item.qty_pcs.toLocaleString(),Number(item.qty_kg).toLocaleString()]);tableData.push(["Total","","","","",totalPcs.toLocaleString(),totalKg.toLocaleString()]),autoTable(doc,{startY:yPos,head:[headers],body:tableData,theme:"grid",styles:{fontSize:7,cellPadding:2,halign:"center",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[255,255,255],textColor:[0,0,0],fontStyle:"bold",lineColor:[0,0,0],lineWidth:.2},columnStyles:{0:{cellWidth:12},1:{cellWidth:22},4:{halign:"left",cellWidth:45},5:{cellWidth:18},6:{cellWidth:18}},alternateRowStyles:{fillColor:[255,255,255]}});const signY=(doc.lastAutoTable?.finalY||yPos+50)+15;signY+50>pageHeight?(doc.addPage(),yPos=20):yPos=signY,doc.setFontSize(8),doc.setFont("helvetica","normal");const col1X=margin,col2X=pageWidth/2-20,col3X=pageWidth-60;doc.text("Pengirim",col1X,yPos),doc.text("SP(P)BE :",col1X,yPos+40),doc.text("Nama :",col1X,yPos+46),doc.text("Jabatan :",col1X,yPos+52),doc.text("Mengetahui",col2X,yPos),doc.text("PT.Pertamina(Persero)",col2X,yPos+6),doc.text("Nama :",col2X,yPos+46),doc.text("Jabatan :",col2X,yPos+52),doc.text("Penerima",col3X,yPos),doc.text("Agen :",col3X,yPos+40),doc.text("Nama :",col3X,yPos+46),doc.text("Jabatan :",col3X,yPos+52),doc.save(`Laporan_Penerimaan_${selectedMonth}.pdf`),toast.success("PDF berhasil di-download!",{id:"pdf-export"})}catch(error){console.error("PDF export error:",error),toast.error("Gagal export PDF",{id:"pdf-export"})}},handleDownloadExcel=()=>{if(!data||data.data.length===0){toast.error("Tidak ada data untuk di-download");return}try{toast.loading("Generating Excel...",{id:"excel-export"});const exportData=sortedData.map(item=>({...item,tanggal_formatted:formatDate(item.tanggal),qty_pcs:item.qty_pcs,qty_kg:Number(item.qty_kg)})),totalPcs=sortedData.reduce((sum,item)=>sum+item.qty_pcs,0),totalKg=sortedData.reduce((sum,item)=>sum+Number(item.qty_kg),0),summary=[{label:"Total Entries",value:data.data.length},{label:"Total Tabung",value:totalPcs},{label:"Total Kg",value:totalKg}],footerRow=createFooterRow("TOTAL",{qty_pcs:totalPcs,qty_kg:totalKg},"tanggal_formatted"),[year,month]=selectedMonth.split("-"),monthLabel=new Date(parseInt(year),parseInt(month)-1,1).toLocaleDateString("id-ID",{month:"long",year:"numeric"});exportToExcel(exportData,exportColumns,summary,{title:"Laporan Penerimaan LPG",period:monthLabel,filename:`Laporan_Penerimaan_${selectedMonth}`},[footerRow]),toast.success("Excel berhasil di-download!",{id:"excel-export"})}catch(error){console.error("Excel export error:",error),toast.error("Gagal export Excel",{id:"excel-export"})}};return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx(PageHeader,{title:"Penerimaan",subtitle:"Catat dan kelola penerimaan stok LPG dari SPBE"}),jsxRuntimeExports.jsx(Card,{className:"glass-card",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Bulan:"}),jsxRuntimeExports.jsxs(Select,{value:selectedMonth,onValueChange:setSelectedMonth,children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"w-48",children:jsxRuntimeExports.jsx(SelectValue,{})}),jsxRuntimeExports.jsx(SelectContent,{children:monthOptions.map(opt=>jsxRuntimeExports.jsx(SelectItem,{value:opt.value,children:opt.label},opt.value))})]})]}),jsxRuntimeExports.jsxs(Button,{variant:"outline",onClick:fetchData,disabled:isLoading,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"RefreshCw",className:`w-4 h-4 mr-2 ${isLoading?"animate-spin":""}`}),"Refresh"]}),jsxRuntimeExports.jsx("div",{className:"flex-1"}),jsxRuntimeExports.jsxs(Button,{onClick:()=>setShowAddModal(!0),className:"gap-2 bg-gradient-to-r from-primary to-primary/80",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Plus",className:"w-4 h-4"}),"Tambah Penerimaan"]}),jsxRuntimeExports.jsxs(DropdownMenu,{children:[jsxRuntimeExports.jsx(DropdownMenuTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{variant:"outline",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Download",className:"w-4 h-4 mr-2"}),"Download",jsxRuntimeExports.jsx(SafeIcon,{name:"ChevronDown",className:"w-3 h-3 ml-1"})]})}),jsxRuntimeExports.jsxs(DropdownMenuContent,{align:"end",children:[jsxRuntimeExports.jsxs(DropdownMenuItem,{onClick:handleDownloadPDF,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"FileText",className:"w-4 h-4 mr-2"}),"Download PDF"]}),jsxRuntimeExports.jsxs(DropdownMenuItem,{onClick:handleDownloadExcel,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"FileSpreadsheet",className:"w-4 h-4 mr-2"}),"Download Excel"]})]})]})]})})}),jsxRuntimeExports.jsxs(Card,{className:"chart-card-premium",children:[jsxRuntimeExports.jsx(CardHeader,{className:"border-b border-border/50 pb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500 animate-pulse"}),jsxRuntimeExports.jsx(CardTitle,{className:"text-lg font-semibold",children:"Rekapitulasi Penerimaan"}),jsxRuntimeExports.jsxs(Badge,{variant:"outline",className:"ml-auto",children:[data?.meta.total||0," Entries"]})]})}),jsxRuntimeExports.jsxs(CardContent,{className:"p-0",children:[jsxRuntimeExports.jsx("div",{className:"overflow-x-auto",children:jsxRuntimeExports.jsxs("table",{className:"w-full text-sm",children:[jsxRuntimeExports.jsx("thead",{className:"bg-muted/50",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left font-medium cursor-pointer hover:bg-muted/80 transition-colors",onClick:()=>handleSort("tanggal"),children:jsxRuntimeExports.jsxs("span",{className:"flex items-center",children:["Tanggal",jsxRuntimeExports.jsx(SortIcon,{field:"tanggal"})]})}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left font-medium cursor-pointer hover:bg-muted/80 transition-colors",onClick:()=>handleSort("no_so"),children:jsxRuntimeExports.jsxs("span",{className:"flex items-center",children:["No SO",jsxRuntimeExports.jsx(SortIcon,{field:"no_so"})]})}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left font-medium cursor-pointer hover:bg-muted/80 transition-colors",onClick:()=>handleSort("no_lo"),children:jsxRuntimeExports.jsxs("span",{className:"flex items-center",children:["No LO",jsxRuntimeExports.jsx(SortIcon,{field:"no_lo"})]})}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-left font-medium cursor-pointer hover:bg-muted/80 transition-colors",onClick:()=>handleSort("nama_material"),children:jsxRuntimeExports.jsxs("span",{className:"flex items-center",children:["Nama Material",jsxRuntimeExports.jsx(SortIcon,{field:"nama_material"})]})}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-center font-medium cursor-pointer hover:bg-muted/80 transition-colors",onClick:()=>handleSort("qty_pcs"),children:jsxRuntimeExports.jsxs("span",{className:"flex items-center justify-center",children:["Qty Tabung",jsxRuntimeExports.jsx(SortIcon,{field:"qty_pcs"})]})}),jsxRuntimeExports.jsx("th",{className:"px-4 py-3 text-center font-medium cursor-pointer hover:bg-muted/80 transition-colors",onClick:()=>handleSort("qty_kg"),children:jsxRuntimeExports.jsxs("span",{className:"flex items-center justify-center",children:["Qty Kg",jsxRuntimeExports.jsx(SortIcon,{field:"qty_kg"})]})})]})}),jsxRuntimeExports.jsx("tbody",{children:isLoading?jsxRuntimeExports.jsx("tr",{children:jsxRuntimeExports.jsxs("td",{colSpan:6,className:"text-center py-8",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"w-6 h-6 animate-spin mx-auto mb-2"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Memuat data..."})]})}):data?.data.length===0?jsxRuntimeExports.jsx("tr",{children:jsxRuntimeExports.jsx("td",{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"Tidak ada data penerimaan untuk bulan ini"})}):sortedData.map(item=>jsxRuntimeExports.jsxs("tr",{className:"border-b border-border/30 hover:bg-muted/30 transition-colors",children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3",children:formatDate(item.tanggal)}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 font-mono text-xs",children:item.no_so}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 font-mono text-xs",children:item.no_lo}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3",children:jsxRuntimeExports.jsx("span",{className:"text-blue-600 font-medium",children:item.nama_material})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-center font-bold",children:item.qty_pcs.toLocaleString()}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-center text-muted-foreground",children:Number(item.qty_kg).toLocaleString()})]},item.id))})]})}),data&&data.meta.totalPages>1&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-border/50",children:[jsxRuntimeExports.jsxs("span",{className:"text-sm text-muted-foreground",children:["Halaman ",page," dari ",data.meta.totalPages]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",onClick:()=>setPage(p=>Math.max(1,p-1)),disabled:page===1,children:jsxRuntimeExports.jsx(SafeIcon,{name:"ChevronLeft",className:"w-4 h-4"})}),jsxRuntimeExports.jsxs("span",{className:"text-sm px-2",children:[page," / ",data.meta.totalPages]}),jsxRuntimeExports.jsx(Button,{variant:"outline",size:"sm",onClick:()=>setPage(p=>Math.min(data.meta.totalPages,p+1)),disabled:page===data.meta.totalPages,children:jsxRuntimeExports.jsx(SafeIcon,{name:"ChevronRight",className:"w-4 h-4"})})]})]})]})]}),jsxRuntimeExports.jsx(Dialog,{open:showAddModal,onOpenChange:setShowAddModal,children:jsxRuntimeExports.jsxs(DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[jsxRuntimeExports.jsxs(DialogHeader,{children:[jsxRuntimeExports.jsxs(DialogTitle,{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"PackagePlus",className:"h-5 w-5 text-primary"}),"Tambah Penerimaan LPG"]}),jsxRuntimeExports.jsx(DialogDescription,{children:"Catat penerimaan LPG dari SPBE. Bisa tambah beberapa produk sekaligus dengan SO/LO yang sama."})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-5 py-4",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 rounded-xl bg-muted/50 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-muted-foreground",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"FileText",className:"h-4 w-4"}),"Dokumen Penerimaan"]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsxs(Label,{htmlFor:"no_so",className:"text-xs font-semibold",children:["No. SO (10 digit) ",jsxRuntimeExports.jsx("span",{className:"text-destructive",children:"*"})]}),jsxRuntimeExports.jsx(Input,{id:"no_so",value:headerData.no_so,onChange:e=>{const val=e.target.value.replace(/\D/g,"").slice(0,10);setHeaderData({...headerData,no_so:val})},maxLength:10,className:`h-10 font-mono tracking-wider ${headerData.no_so&&headerData.no_so.length===10?"border-green-500":""}`}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:[headerData.no_so.length,"/10 digit"]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsxs(Label,{htmlFor:"no_lo",className:"text-xs font-semibold",children:["No. LO (10 digit) ",jsxRuntimeExports.jsx("span",{className:"text-destructive",children:"*"})]}),jsxRuntimeExports.jsx(Input,{id:"no_lo",value:headerData.no_lo,onChange:e=>{const val=e.target.value.replace(/\D/g,"").slice(0,10);setHeaderData({...headerData,no_lo:val})},maxLength:10,className:`h-10 font-mono tracking-wider ${headerData.no_lo&&headerData.no_lo.length===10?"border-green-500":""}`}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-muted-foreground",children:[headerData.no_lo.length,"/10 digit"]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsxs(Label,{htmlFor:"tanggal",className:"text-xs font-semibold",children:["Tanggal ",jsxRuntimeExports.jsx("span",{className:"text-destructive",children:"*"})]}),jsxRuntimeExports.jsx(Input,{id:"tanggal",type:"date",value:headerData.tanggal,onChange:e=>setHeaderData({...headerData,tanggal:e.target.value}),className:"h-10"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx(Label,{className:"text-sm font-semibold",children:"Daftar Produk"}),jsxRuntimeExports.jsxs(Button,{type:"button",variant:"outline",size:"sm",onClick:addItem,disabled:items.length>=products.length,className:"gap-1",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Plus",className:"h-3 w-3"}),"Tambah Produk"]})]}),items.map((item,index)=>{const product=products.find(p=>p.id===item.lpg_product_id),qtyPcs=parseInt(item.qty_pcs)||0,qtyKg=product?qtyPcs*Number(product.size_kg):0;return jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl border bg-card",children:[jsxRuntimeExports.jsxs("span",{className:"text-xs font-bold text-muted-foreground w-6",children:[index+1,"."]}),jsxRuntimeExports.jsx("div",{className:"flex-1 min-w-[180px]",children:jsxRuntimeExports.jsxs(Select,{value:item.lpg_product_id,onValueChange:v=>updateItem(item.id,"lpg_product_id",v),children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"h-10",children:jsxRuntimeExports.jsx(SelectValue,{placeholder:"Pilih produk"})}),jsxRuntimeExports.jsx(SelectContent,{children:getAvailableProducts(item.id).map(p=>jsxRuntimeExports.jsxs(SelectItem,{value:p.id,children:[p.name," (",p.size_kg," kg)"]},p.id))})]})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 w-32",children:[jsxRuntimeExports.jsx(Input,{type:"number",min:"1",value:item.qty_pcs,onChange:e=>updateItem(item.id,"qty_pcs",e.target.value),placeholder:"0",className:"h-10 text-center font-bold"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-muted-foreground",children:"tbg"})]}),jsxRuntimeExports.jsx("div",{className:"w-24 text-right",children:qtyKg>0&&jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-green-600",children:[qtyKg," kg"]})}),jsxRuntimeExports.jsx(Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>removeItem(item.id),className:"h-8 w-8 text-muted-foreground hover:text-destructive",children:jsxRuntimeExports.jsx(SafeIcon,{name:"X",className:"h-4 w-4"})})]},item.id)})]}),totals.totalPcs>0&&jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl bg-green-50 dark:bg-green-950/30 border border-green-200 dark:border-green-800",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Package",className:"h-5 w-5 text-green-600"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-green-700 dark:text-green-400",children:"Total Penerimaan"})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsxs("div",{className:"text-2xl font-bold text-green-700 dark:text-green-400",children:[totals.totalPcs.toLocaleString()," tabung"]}),jsxRuntimeExports.jsxs("div",{className:"text-sm text-green-600",children:[totals.totalKg.toLocaleString()," kg"]})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:()=>{setShowAddModal(!1),resetForm()},children:"Batal"}),jsxRuntimeExports.jsxs(Button,{onClick:handleSubmit,disabled:isSaving||!headerData.no_so||!headerData.no_lo||totals.totalPcs===0,className:"gap-2 bg-gradient-to-r from-primary to-primary/80",children:[isSaving?jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"h-4 w-4 animate-spin"}):jsxRuntimeExports.jsx(SafeIcon,{name:"Check",className:"h-4 w-4"}),"Simpan ",items.filter(i=>i.lpg_product_id&&i.qty_pcs).length>1?`(${items.filter(i=>i.lpg_product_id&&i.qty_pcs).length} item)`:""]})]})]})})]})}export{PenerimaanPage as default};
