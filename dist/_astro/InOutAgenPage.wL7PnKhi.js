import{j as jsxRuntimeExports}from"./jsx-runtime.mvtouYz0.js";import{r as reactExports}from"./index.DcciWILN.js";import{C as Card,a as CardContent,b as CardHeader,c as CardTitle}from"./card.D0gylVsf.js";import{S as SafeIcon,B as Button}from"./SafeIcon.CAGsavDo.js";import{S as Select,a as SelectTrigger,b as SelectValue,c as SelectContent,d as SelectItem}from"./select.Dd50uIHU.js";import{B as Badge}from"./badge.DZiJ6zSB.js";import{D as DropdownMenu,a as DropdownMenuTrigger,b as DropdownMenuContent,c as DropdownMenuItem}from"./dropdown-menu.CyUKnKxT.js";import{T as Tilt3DCard}from"./Tilt3DCard.A2Rmx9L7.js";import{penerimaanApi}from"./api.Dr7hS9Y8.js";import{t as toast}from"./index.fAd_ikgp.js";import{A as AnimatedNumber}from"./AnimatedNumber.DkDF6dXY.js";import{E,a as autoTable,u as utils,w as writeFileSync}from"./jspdf.plugin.autotable.tHrVzh7j.js";import{p as pertaminaLogo}from"./logo-pertamina.CveLq9KN.js";import{g as getAgenProfileFromAPI}from"./pertamina-export.CDr19N9R.js";import{P as PageHeader}from"./PageHeader.ChFr_oMu.js";import"./index.PIAPtHoh.js";import"./index.ubNQCTBn.js";import"./index.DGt6JTY0.js";import"./index.BpQ989z7.js";import"./index.BStXkqMp.js";import"./index.Drh0kMGk.js";import"./index.DZiLsHox.js";import"./index.Dovp0-D8.js";import"./index.YpXgcoRz.js";import"./index.BFpcrWlj.js";import"./index.9MihlNbL.js";import"./index.BhA3i5Wo.js";import"./index.BaF2FVWY.js";import"./chevron-up.BBBXIirx.js";import"./check.TUgVKQyo.js";import"./index.CdmyERTi.js";import"./index.DQDOfy24.js";import"./chevron-right.oaN48PMp.js";const loadImageAsBase64=url=>new Promise((resolve,reject)=>{const img=new Image;img.crossOrigin="Anonymous",img.onload=()=>{const canvas=document.createElement("canvas");canvas.width=img.width,canvas.height=img.height;const ctx=canvas.getContext("2d");ctx?(ctx.drawImage(img,0,0),resolve(canvas.toDataURL("image/png"))):reject(new Error("Cannot get canvas context"))},img.onerror=()=>reject(new Error("Failed to load image")),img.src=url});function InOutAgenPage(){const[selectedMonth,setSelectedMonth]=reactExports.useState(()=>{const now=new Date;return`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,"0")}`}),[data,setData]=reactExports.useState(null),[isLoading,setIsLoading]=reactExports.useState(!1),fetchData=async()=>{setIsLoading(!0);try{const result=await penerimaanApi.getInOutAgen(selectedMonth);setData(result)}catch{toast.error("Gagal memuat data In/Out Agen")}finally{setIsLoading(!1)}};reactExports.useEffect(()=>{fetchData()},[selectedMonth]);const monthOptions=reactExports.useMemo(()=>{const options=[],now=new Date;for(let i=0;i<12;i++){const date=new Date(now.getFullYear(),now.getMonth()-i,1),value=`${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,"0")}`,label=date.toLocaleDateString("id-ID",{month:"long",year:"numeric"});options.push({value,label})}return options},[]),dayHeaders=reactExports.useMemo(()=>data?Array.from({length:data.days_in_month},(_,i)=>i+1):[],[data]),today=new Date().getDate(),currentMonth=`${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}`,isCurrentMonth=selectedMonth===currentMonth,ROWS=[{key:"stok_awal",label:"Stok Awal",color:"blue"},{key:"penerimaan",label:"Penerimaan",color:"green"},{key:"penyaluran",label:"Penyaluran",color:"orange"},{key:"stok_akhir",label:"Stok Akhir",color:"purple"}],getMonthLabel=()=>{const[year,month]=selectedMonth.split("-");return new Date(parseInt(year),parseInt(month)-1,1).toLocaleDateString("id-ID",{month:"long",year:"numeric"})},handleDownloadPDF=async()=>{if(!data){toast.error("Tidak ada data untuk di-download");return}try{toast.loading("Generating PDF...",{id:"pdf-export"});const doc=new E({orientation:"landscape"}),pageWidth=doc.internal.pageSize.getWidth(),margin=14,agenProfile=await getAgenProfileFromAPI();doc.setFont("helvetica","bold"),doc.setFontSize(10),doc.text("PT. Pertamina (Persero)",margin,12),doc.setFontSize(8),doc.text("Jl.Medan Merdeka Timur No. 1A Jakarta 10110",margin,17),doc.text("Telp: 021 3815111 FAX: 021 3633585",margin,22);try{const logoData=pertaminaLogo,logoUrl=typeof logoData=="string"?logoData:logoData.src,logoBase64=await loadImageAsBase64(logoUrl);doc.addImage(logoBase64,"PNG",pageWidth-70,8,55,13)}catch(logoError){console.warn("[PDF Export] Could not load Pertamina logo:",logoError)}const[year,month]=selectedMonth.split("-"),monthName=new Date(parseInt(year),parseInt(month)-1,1).toLocaleDateString("id-ID",{month:"long"}).toUpperCase();doc.setFontSize(11),doc.setFont("helvetica","bold"),doc.text(`LAPORAN IN OUT AGEN PERIODE ${monthName} ${year}`,pageWidth/2,35,{align:"center"});let yPos=45;doc.setFontSize(8),doc.setFont("helvetica","normal"),[{label:"Nama Agen",value:agenProfile.nama_agen},{label:"Alamat Agen",value:agenProfile.alamat_agen},{label:"Email",value:agenProfile.email},{label:"No. Sold To",value:agenProfile.no_siid},{label:"Wilayah",value:agenProfile.wilayah}].forEach(field=>{doc.text(`${field.label}`,margin,yPos),doc.text(":",margin+25,yPos),doc.text(field.value,margin+28,yPos),yPos+=4}),yPos+=5;const getDayName=date=>["Min","Sen","Sel","Rab","Kam","Jum","Sab"][date.getDay()],headers=["Field",...dayHeaders.map(d=>{const date=new Date(parseInt(year),parseInt(month)-1,d),dayName=getDayName(date);return`${String(d).padStart(2,"0")}
${dayName}`})],tableData=ROWS.map(row=>{const rowData=[row.label];return dayHeaders.forEach(day=>{const dayData=data.daily[day],value=dayData?dayData[row.key]:0;rowData.push(value.toLocaleString())}),rowData});autoTable(doc,{startY:yPos,head:[headers],body:tableData,theme:"grid",styles:{fontSize:6,cellPadding:1.5,halign:"center",lineColor:[0,0,0],lineWidth:.1},headStyles:{fillColor:[128,0,0],textColor:255,fontStyle:"bold",fontSize:6},columnStyles:{0:{halign:"left",cellWidth:22}},alternateRowStyles:{fillColor:[255,255,255]}}),doc.save(`Laporan_InOut_Agen_${selectedMonth}.pdf`),toast.success("PDF berhasil di-download!",{id:"pdf-export"})}catch(error){console.error("PDF export error:",error),toast.error("Gagal export PDF",{id:"pdf-export"})}},handleDownloadExcel=()=>{if(!data){toast.error("Tidak ada data untuk di-download");return}try{toast.loading("Generating Excel...",{id:"excel-export"});const wb=utils.book_new(),wsData=[];wsData.push([`Laporan In Out Agen - ${getMonthLabel()}`]),wsData.push([]),wsData.push(["Ringkasan"]),wsData.push(["Stok Awal Bulan",data.stok_awal_bulan||0]),wsData.push(["Total Penerimaan",data.total_penerimaan||0]),wsData.push(["Total Penyaluran",data.total_penyaluran||0]),wsData.push(["Stok Akhir Bulan",data.stok_akhir_bulan||0]),wsData.push([]);const headers=["Field",...dayHeaders.map(d=>String(d).padStart(2,"0"))];wsData.push(headers),ROWS.forEach(row=>{const rowData=[row.label];dayHeaders.forEach(day=>{const dayData=data.daily[day],value=dayData?dayData[row.key]:0;rowData.push(value)}),wsData.push(rowData)});const ws=utils.aoa_to_sheet(wsData);ws["!cols"]=[{wch:15},...dayHeaders.map(()=>({wch:6}))],utils.book_append_sheet(wb,ws,"In Out Agen"),writeFileSync(wb,`Laporan_InOut_Agen_${selectedMonth}.xlsx`),toast.success("Excel berhasil di-download!",{id:"excel-export"})}catch(error){console.error("Excel export error:",error),toast.error("Gagal export Excel",{id:"excel-export"})}};return jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx(PageHeader,{title:"In / Out Agen",subtitle:"Rekapitulasi stok harian (Stok Awal, Penerimaan, Penyaluran, Stok Akhir)"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[jsxRuntimeExports.jsx(Tilt3DCard,{children:jsxRuntimeExports.jsx(Card,{className:"glass-card h-full",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"p-2 rounded-xl bg-blue-500/10",children:jsxRuntimeExports.jsx(SafeIcon,{name:"PackagePlus",className:"w-5 h-5 text-blue-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Stok Awal Bulan"}),jsxRuntimeExports.jsx("p",{className:"text-xl font-bold",children:jsxRuntimeExports.jsx(AnimatedNumber,{value:data?.stok_awal_bulan||0,delay:100})})]})]})})})}),jsxRuntimeExports.jsx(Tilt3DCard,{children:jsxRuntimeExports.jsx(Card,{className:"glass-card h-full",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"p-2 rounded-xl bg-green-500/10",children:jsxRuntimeExports.jsx(SafeIcon,{name:"ArrowDownCircle",className:"w-5 h-5 text-green-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Penerimaan"}),jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-green-600",children:jsxRuntimeExports.jsx(AnimatedNumber,{value:data?.total_penerimaan||0,delay:200})})]})]})})})}),jsxRuntimeExports.jsx(Tilt3DCard,{children:jsxRuntimeExports.jsx(Card,{className:"glass-card h-full",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"p-2 rounded-xl bg-orange-500/10",children:jsxRuntimeExports.jsx(SafeIcon,{name:"ArrowUpCircle",className:"w-5 h-5 text-orange-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Penyaluran"}),jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-orange-600",children:jsxRuntimeExports.jsx(AnimatedNumber,{value:data?.total_penyaluran||0,delay:300})})]})]})})})}),jsxRuntimeExports.jsx(Tilt3DCard,{children:jsxRuntimeExports.jsx(Card,{className:"glass-card h-full",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"p-2 rounded-xl bg-purple-500/10",children:jsxRuntimeExports.jsx(SafeIcon,{name:"PackageOpen",className:"w-5 h-5 text-purple-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-muted-foreground",children:"Stok Akhir Bulan"}),jsxRuntimeExports.jsx("p",{className:"text-xl font-bold text-purple-600",children:jsxRuntimeExports.jsx(AnimatedNumber,{value:data?.stok_akhir_bulan||0,delay:400})})]})]})})})})]}),jsxRuntimeExports.jsx(Card,{className:"glass-card",children:jsxRuntimeExports.jsx(CardContent,{className:"p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-muted-foreground",children:"Bulan:"}),jsxRuntimeExports.jsxs(Select,{value:selectedMonth,onValueChange:setSelectedMonth,children:[jsxRuntimeExports.jsx(SelectTrigger,{className:"w-44",children:jsxRuntimeExports.jsx(SelectValue,{})}),jsxRuntimeExports.jsx(SelectContent,{children:monthOptions.map(opt=>jsxRuntimeExports.jsx(SelectItem,{value:opt.value,children:opt.label},opt.value))})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 sm:ml-auto",children:[jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",onClick:fetchData,disabled:isLoading,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"RefreshCw",className:`w-4 h-4 mr-1 ${isLoading?"animate-spin":""}`}),"Refresh"]}),jsxRuntimeExports.jsxs(DropdownMenu,{children:[jsxRuntimeExports.jsx(DropdownMenuTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"sm",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Download",className:"w-4 h-4 mr-1"}),"Download",jsxRuntimeExports.jsx(SafeIcon,{name:"ChevronDown",className:"w-3 h-3 ml-1"})]})}),jsxRuntimeExports.jsxs(DropdownMenuContent,{align:"end",children:[jsxRuntimeExports.jsxs(DropdownMenuItem,{onClick:handleDownloadPDF,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"FileText",className:"w-4 h-4 mr-2"}),"Download PDF"]}),jsxRuntimeExports.jsxs(DropdownMenuItem,{onClick:handleDownloadExcel,children:[jsxRuntimeExports.jsx(SafeIcon,{name:"FileSpreadsheet",className:"w-4 h-4 mr-2"}),"Download Excel"]})]})]})]})]})})}),jsxRuntimeExports.jsxs(Card,{className:"chart-card-premium",children:[jsxRuntimeExports.jsx(CardHeader,{className:"border-b border-border/50 pb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500 animate-pulse"}),jsxRuntimeExports.jsx(CardTitle,{className:"text-lg font-semibold",children:"In Out Agen"}),jsxRuntimeExports.jsxs(Badge,{variant:"outline",className:"ml-auto",children:[data?.days_in_month||0," Hari"]})]})}),jsxRuntimeExports.jsx(CardContent,{className:"p-0",children:jsxRuntimeExports.jsx("div",{className:"overflow-x-auto cursor-grab active:cursor-grabbing",onWheel:e=>{Math.abs(e.deltaY)>Math.abs(e.deltaX)&&(e.preventDefault(),e.currentTarget.scrollLeft+=e.deltaY)},children:jsxRuntimeExports.jsxs("table",{className:"w-full text-sm",children:[jsxRuntimeExports.jsx("thead",{className:"bg-muted/50 sticky top-0 z-20",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"sticky left-0 z-30 bg-muted px-4 py-3 text-left font-medium min-w-[120px] shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:"Field"}),dayHeaders.map(day=>{const todayClass=isCurrentMonth&&day===today?"bg-primary/20 text-primary font-bold":"";return jsxRuntimeExports.jsx("th",{className:`px-2 py-3 text-center font-medium min-w-[50px] ${todayClass}`,children:String(day).padStart(2,"0")},day)})]})}),jsxRuntimeExports.jsx("tbody",{children:isLoading?jsxRuntimeExports.jsx("tr",{children:jsxRuntimeExports.jsxs("td",{colSpan:dayHeaders.length+1,className:"text-center py-8",children:[jsxRuntimeExports.jsx(SafeIcon,{name:"Loader2",className:"w-6 h-6 animate-spin mx-auto mb-2"}),jsxRuntimeExports.jsx("span",{className:"text-muted-foreground",children:"Memuat data..."})]})}):ROWS.map(row=>{const bgClasses={blue:"bg-blue-50",green:"bg-green-50",orange:"bg-orange-50",purple:"bg-purple-50"},dotColors={blue:"bg-blue-500",green:"bg-green-500",orange:"bg-orange-500",purple:"bg-purple-500"};return jsxRuntimeExports.jsxs("tr",{className:"border-b border-border/30 hover:bg-muted/30 transition-colors",children:[jsxRuntimeExports.jsx("td",{className:`sticky left-0 z-10 px-4 py-3 font-medium shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] ${bgClasses[row.color]}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:`w-2 h-2 rounded-full ${dotColors[row.color]}`}),row.label]})}),dayHeaders.map(day=>{const dayData=data?.daily[day],value=dayData?dayData[row.key]:0,todayClass=isCurrentMonth&&day===today?"bg-primary/10 font-bold":"";return jsxRuntimeExports.jsx("td",{className:`px-2 py-3 text-center ${todayClass} ${value===0&&row.key!=="stok_akhir"?"text-muted-foreground":""}`,children:value.toLocaleString()},day)})]},row.key)})})]})})})]})]})}export{InOutAgenPage as default};
