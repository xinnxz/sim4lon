import{E,a as autoTable,u as utils,b as writeSync}from"./jspdf.plugin.autotable.tHrVzh7j.js";import{p as pertaminaLogo}from"./logo-pertamina.CveLq9KN.js";const loadImageAsBase64=url=>new Promise((resolve,reject)=>{const img=new Image;img.crossOrigin="Anonymous",img.onload=()=>{const canvas=document.createElement("canvas");canvas.width=img.width,canvas.height=img.height;const ctx=canvas.getContext("2d");ctx?(ctx.drawImage(img,0,0),resolve(canvas.toDataURL("image/png"))):reject(new Error("Cannot get canvas context"))},img.onerror=()=>reject(new Error("Failed to load image")),img.src=url}),downloadFile=(blob,filename)=>{const url=window.URL.createObjectURL(blob),a=document.createElement("a");a.style.display="none",a.href=url,a.download=filename,document.body.appendChild(a),a.click(),setTimeout(()=>{document.body.removeChild(a),window.URL.revokeObjectURL(url)},1500)},exportToPDF=async(data,columns,summary,options,footerRows)=>{const doc=new E;try{const logoData=pertaminaLogo,logoUrl=typeof logoData=="string"?logoData:logoData.src,logoBase64=await loadImageAsBase64(logoUrl),logoWidth=40,logoHeight=15,pageWidth=doc.internal.pageSize.getWidth();doc.addImage(logoBase64,"PNG",pageWidth-75,8,55,13)}catch(error){console.warn("[PDF Export] Could not load Pertamina logo:",error)}doc.setFontSize(18),doc.setFont("helvetica","bold"),doc.text(options.title,14,20),doc.setFontSize(10),doc.setFont("helvetica","normal"),doc.text(`Periode: ${options.period}`,14,28),doc.text(`Dicetak: ${new Date().toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}`,14,34);let yPos=45;doc.setFontSize(12),doc.setFont("helvetica","bold"),doc.text("Ringkasan",14,yPos),yPos+=8,doc.setFontSize(10),doc.setFont("helvetica","normal"),summary.forEach((item,index)=>{const xOffset=index%2===0?14:110;index%2===0&&index>0&&(yPos+=7),doc.text(`${item.label}: ${item.value}`,xOffset,yPos)}),yPos+=15;const tableData=data.map(row=>columns.map(col=>{const value=row[col.key];return value==null?"-":typeof value=="number"?value.toLocaleString("id-ID"):String(value)})),footerData=footerRows?.map(row=>columns.map(col=>{const value=row[col.key];return value==null?"":typeof value=="number"?value.toLocaleString("id-ID"):String(value)}))||[],allBodyData=[...tableData,...footerData],footerStartIndex=tableData.length;autoTable(doc,{startY:yPos,head:[columns.map(col=>col.header)],body:allBodyData,theme:"grid",headStyles:{fillColor:[34,139,34],textColor:255,fontStyle:"bold"},styles:{fontSize:9,cellPadding:3},alternateRowStyles:{fillColor:[245,245,245]},columnStyles:columns.reduce((acc,col,index)=>(col.align&&(acc[index]={halign:col.align}),acc),{}),didParseCell:data2=>{data2.section==="body"&&data2.row.index>=footerStartIndex&&(data2.cell.styles.fontStyle="bold",data2.cell.styles.fillColor=[255,255,255])}});const pageCount=doc.getNumberOfPages();for(let i=1;i<=pageCount;i++)doc.setPage(i),doc.setFontSize(8),doc.setTextColor(150),doc.text(`SIM4LON - Halaman ${i} dari ${pageCount}`,doc.internal.pageSize.width/2,doc.internal.pageSize.height-10,{align:"center"});const pdfFilename=options.filename.endsWith(".pdf")?options.filename:`${options.filename}.pdf`,pdfBlob=doc.output("blob");downloadFile(pdfBlob,pdfFilename)},exportToExcel=(data,columns,summary,options,footerRows)=>{const wb=utils.book_new(),summaryData=[[options.title],[`Periode: ${options.period}`],[`Dicetak: ${new Date().toLocaleDateString("id-ID")}`],[],["RINGKASAN"],...summary.map(item=>[item.label,String(item.value)])],summarySheet=utils.aoa_to_sheet(summaryData);utils.book_append_sheet(wb,summarySheet,"Ringkasan");const headers=columns.map(col=>col.header),rows=data.map(row=>columns.map(col=>row[col.key]??"-")),footerRowsData=footerRows?.map(row=>columns.map(col=>row[col.key]??""))||[],allData=[headers,...rows];footerRowsData.length>0&&(allData.push(columns.map(()=>"")),allData.push(...footerRowsData));const dataSheet=utils.aoa_to_sheet(allData);dataSheet["!cols"]=columns.map(col=>({wch:col.width||15}));const totalRows=allData.length,totalCols=columns.length;for(let r=0;r<totalRows;r++)for(let c=0;c<totalCols;c++){const cellAddr=utils.encode_cell({r,c});if(!dataSheet[cellAddr])continue;dataSheet[cellAddr].s||(dataSheet[cellAddr].s={}),dataSheet[cellAddr].s.border={top:{style:"thin",color:{rgb:"000000"}},bottom:{style:"thin",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}};const colAlign=columns[c]?.align||"center";dataSheet[cellAddr].s.alignment={horizontal:colAlign,vertical:"center"}}utils.book_append_sheet(wb,dataSheet,"Data");const xlsxFilename=options.filename.endsWith(".xlsx")?options.filename:`${options.filename}.xlsx`,wbout=writeSync(wb,{bookType:"xlsx",type:"array"}),blob=new Blob([wbout],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});downloadFile(blob,xlsxFilename)},formatCurrencyExport=value=>`Rp ${Math.round(value).toLocaleString("id-ID")}`,formatDateExport=dateString=>new Date(dateString).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),createFooterRow=(label,totals,firstColumnKey="date")=>({[firstColumnKey]:label,...totals});export{exportToPDF as a,formatDateExport as b,createFooterRow as c,exportToExcel as e,formatCurrencyExport as f};
