@startuml AD_03_UpdateStatusPesanan
!theme plain
skinparam backgroundColor #f0f8ff
skinparam ActivityBackgroundColor #87CEEB
skinparam ActivityBorderColor #1565c0
skinparam PartitionBackgroundColor #e3f2fd
skinparam PartitionBorderColor #1565c0

title **AD-03: Update Status Pesanan**\nSistem SIM4LON

|User|
start
:Buka detail pesanan;
:Pilih status baru;
:Klik "Update Status";

|Sistem|
:Ambil status saat ini;
:Validasi transisi status;

if (Transisi valid?) then (ya)
    
    if (Status = SIAP_KIRIM?) then (ya)
        |User|
        :Pilih Driver (opsional);
        
        |Sistem|
        if (Driver dipilih?) then (ya)
            :Assign driver ke pesanan;
        endif
    endif
    
    if (Status = SELESAI?) then (ya)
        |Sistem|
        :Update stok pangkalan\n(auto sync);
        :Buat stock movement\ndi pangkalan;
    endif
    
    :Update status pesanan;
    :Buat timeline track\ndengan deskripsi;
    :Log aktivitas\n"order_status_updated";
    
    |User|
    :Tampilkan pesan sukses;
    :Refresh halaman detail;
    stop
    
else (tidak)
    |User|
    :Tampilkan error\n"Transisi status tidak valid";
    
    note right
    Alur status yang valid:
    DRAFT → MENUNGGU_PEMBAYARAN
    MENUNGGU_PEMBAYARAN → DIPROSES
    DIPROSES → SIAP_KIRIM
    SIAP_KIRIM → DIKIRIM
    DIKIRIM → SELESAI
    (Semua bisa → BATAL)
    end note
    
    stop
endif

@enduml
