@startuml AD_04_CatatPembayaran
!theme plain
skinparam backgroundColor #f0f8ff
skinparam ActivityBackgroundColor #87CEEB
skinparam ActivityBorderColor #1565c0
skinparam PartitionBackgroundColor #e3f2fd
skinparam PartitionBorderColor #1565c0

title **AD-04: Catat Pembayaran**\nSistem SIM4LON

|User|
start
:Buka detail pesanan;
:Klik "Catat Pembayaran";

|Sistem|
:Tampilkan form pembayaran;
:Tampilkan sisa tagihan;

|User|
:Pilih metode pembayaran\n(TUNAI/TRANSFER);
:Masukkan jumlah bayar;
:Upload bukti transfer\n(jika transfer);
:Tambah catatan (opsional);
:Klik "Simpan";

|Sistem|
:Validasi input;

if (Input valid?) then (ya)
    if (Jumlah >= Sisa tagihan?) then (ya)
        :Set is_paid = true;
        :Set payment_status = "PAID";
    else (tidak)
        :Set is_paid = false;
        :Set is_dp = true;
        :Set payment_status = "PARTIAL";
    endif
    
    :Simpan payment record;
    :Update order_payment_details;
    :Log aktivitas\n"payment_recorded";
    
    if (Pembayaran lunas AND status = MENUNGGU_PEMBAYARAN?) then (ya)
        :Auto update status\nke DIPROSES;
        :Buat timeline track;
    endif
    
    |User|
    :Tampilkan pesan sukses;
    :Refresh halaman;
    stop
else (tidak)
    |User|
    :Tampilkan pesan error;
    stop
endif

@enduml
